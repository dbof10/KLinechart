/**
     * @license
     * KLineChart v9.8.8
     * Copyright (c) 2019 lihu.
     * Licensed under Apache License 2.0 https://www.apache.org/licenses/LICENSE-2.0
     */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).klinecharts={})}(this,(function(t){"use strict";var e=function(t,i){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},e(t,i)};function i(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}var n=function(){return n=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var o in e=arguments[i])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},n.apply(this,arguments)};function o(t,e,i,n){return new(i||(i=Promise))((function(o,r){function a(t){try{l(n.next(t))}catch(t){r(t)}}function s(t){try{l(n.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,s)}l((n=n.apply(t,e||[])).next())}))}function r(t,e){var i,n,o,r={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=s(0),a.throw=s(1),a.return=s(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){return function(s){if(i)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(r=0)),r;)try{if(i=1,n&&(o=2&s[0]?n.return:s[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,s[1])).done)return o;switch(n=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return r.label++,{value:s[1],done:!1};case 5:r.label++,n=s[1],s=[0];continue;case 7:s=r.ops.pop(),r.trys.pop();continue;default:if(!(o=r.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){r=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){r.label=s[1];break}if(6===s[0]&&r.label<o[1]){r.label=o[1],o=s;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(s);break}o[2]&&r.ops.pop(),r.trys.pop();continue}s=e.call(t,r)}catch(t){s=[6,t],n=0}finally{i=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}}function a(t){var e="function"==typeof Symbol&&Symbol.iterator,i=e&&t[e],n=0;if(i)return i.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function s(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var n,o,r=i.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=r.next()).done;)a.push(n.value)}catch(t){o={error:t}}finally{try{n&&!n.done&&(i=r.return)&&i.call(r)}finally{if(o)throw o.error}}return a}function l(t,e,i){if(i||2===arguments.length)for(var n,o=0,r=e.length;o<r;o++)!n&&o in e||(n||(n=Array.prototype.slice.call(e,0,o)),n[o]=e[o]);return t.concat(n||Array.prototype.slice.call(e))}"function"==typeof SuppressedError&&SuppressedError;var c,u,h,d,p,g,v,f,y,m="rgb(6, 122, 180)",x="rgb(210, 56, 48)";t.LineType=void 0,(c=t.LineType||(t.LineType={})).Dashed="dashed",c.Solid="solid",t.PolygonType=void 0,(u=t.PolygonType||(t.PolygonType={})).Stroke="stroke",u.Fill="fill",u.StrokeFill="stroke_fill",t.TooltipShowRule=void 0,(h=t.TooltipShowRule||(t.TooltipShowRule={})).Always="always",h.FollowCross="follow_cross",h.None="none",t.TooltipShowType=void 0,(d=t.TooltipShowType||(t.TooltipShowType={})).Standard="standard",d.Rect="rect",t.TooltipIconPosition=void 0,(p=t.TooltipIconPosition||(t.TooltipIconPosition={})).Left="left",p.Middle="middle",p.Right="right",function(t){t.Fixed="fixed",t.Pointer="pointer"}(g||(g={})),t.CandleType=void 0,(v=t.CandleType||(t.CandleType={})).CandleSolid="candle_solid",v.Renko="renko",v.CandleStroke="candle_stroke",v.Ohlc="ohlc",v.Area="area",t.YAxisPosition=void 0,(f=t.YAxisPosition||(t.YAxisPosition={})).Left="left",f.Right="right",t.YAxisType=void 0,(y=t.YAxisType||(t.YAxisType={})).Normal="normal",y.Percentage="percentage",y.Log="log";var _="#888888",S="#FFFFFF",w="#1677FF",b="#76808F",T="#DDDDDD";function C(t){return"rgba(22, 119, 255, ".concat(t,")")}function P(){function e(){return{show:!0,size:1,color:"#EDEDED",style:t.LineType.Dashed,dashedValue:[2,2]}}return{show:!1,horizontal:e(),vertical:e()}}function I(){return{show:!0,size:"auto",axisLine:{show:!0,color:T,size:1},tickText:{show:!0,color:b,size:12,family:"Helvetica Neue",weight:"normal",marginStart:4,marginEnd:4},tickLine:{show:!0,size:1,length:3,color:T}}}function D(){function e(){return{show:!0,line:{show:!0,style:t.LineType.Dashed,dashedValue:[4,2],size:1,color:b},text:{show:!0,style:t.PolygonType.Fill,color:S,size:12,family:"Helvetica Neue",weight:"normal",borderStyle:t.LineType.Solid,borderDashedValue:[2,2],borderSize:1,borderColor:b,borderRadius:2,paddingLeft:4,paddingRight:4,paddingTop:4,paddingBottom:4,backgroundColor:b}}}return{show:!0,horizontal:e(),vertical:e()}}function E(){var e=C(.35),i=C(.25);function n(){return{style:t.PolygonType.Fill,color:S,size:12,family:"Helvetica Neue",weight:"normal",borderStyle:t.LineType.Solid,borderDashedValue:[2,2],borderSize:1,borderRadius:2,borderColor:w,paddingLeft:4,paddingRight:4,paddingTop:4,paddingBottom:4,backgroundColor:w}}return{point:{color:w,borderColor:e,borderSize:1,radius:5,activeColor:w,activeBorderColor:e,activeBorderSize:3,activeRadius:5},line:{style:t.LineType.Solid,smooth:!1,color:w,size:1,dashedValue:[2,2]},rect:{style:t.PolygonType.Fill,color:i,borderColor:w,borderSize:1,borderRadius:0,borderStyle:t.LineType.Solid,borderDashedValue:[2,2]},polygon:{style:t.PolygonType.Fill,color:w,borderColor:w,borderSize:1,borderStyle:t.LineType.Solid,borderDashedValue:[2,2]},circle:{style:t.PolygonType.Fill,color:i,borderColor:w,borderSize:1,borderStyle:t.LineType.Solid,borderDashedValue:[2,2]},arc:{style:t.LineType.Solid,color:w,size:1,dashedValue:[2,2]},text:n(),rectText:n()}}function M(t,e){if(L(t)||L(e))for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var n=t[i],o=e[i];L(o)&&L(n)?M(n,o):R(e[i])&&(t[i]=k(e[i]))}}function k(t){if(!L(t))return t;var e;for(var i in e=A(t)?[]:{},t)if(Object.prototype.hasOwnProperty.call(t,i)){var n=t[i];L(n)?e[i]=k(n):e[i]=n}return e}function A(t){return"[object Array]"===Object.prototype.toString.call(t)}function F(t){return"function"==typeof t}function L(t){return"object"==typeof t&&R(t)}function B(t){return"number"==typeof t&&!isNaN(t)}function R(t){return null!=t}function V(t){return"boolean"==typeof t}function O(t){return"string"==typeof t}var N,W,z=/\\(\\)?/g,Y=RegExp("[^.[\\]]+|\\[(?:([^\"'][^[]*)|([\"'])((?:(?!\\2)[^\\\\]|\\\\.)*?)\\2)\\]|(?=(?:\\.|\\[\\])(?:\\.|\\[\\]|$))","g");function H(t,e,i){if(R(t)){var n=[];e.replace(Y,(function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];var o=t;return R(e[1])?o=e[2].replace(z,"$1"):R(e[0])&&(o=e[0].trim()),n.push(o),""}));for(var o=t,r=0,a=n.length;R(o)&&r<a;)o=null==o?void 0:o[n[r++]];return R(o)?o:null!=i?i:"--"}return null!=i?i:"--"}function X(t,e,i){var n={};return t.formatToParts(new Date(e)).forEach((function(t){var e=t.type,i=t.value;switch(e){case"year":n.YYYY=i;break;case"month":n.MM=i;break;case"day":n.DD=i;break;case"hour":n.HH="24"===i?"00":i;break;case"minute":n.mm=i;break;case"second":n.ss=i}})),i.replace(/YYYY|MM|DD|HH|mm|ss/g,(function(t){return n[t]}))}function U(t,e){var i=+t;return B(i)?i.toFixed(null!=e?e:2):"".concat(t)}function G(t){var e=+t;if(B(e)){var i=Math.abs(e);if(i>1e9)return"".concat(+(e/1e9).toFixed(1),"B");if(i>1e6)return"".concat(+(e/1e6).toFixed(1),"M");if(i>1e3)return"".concat(+(e/1e3).toFixed(1),"K")}return"".concat(t)}function j(t,e){var i="".concat(t);if(0===e.length)return i;if(i.includes(".")){var n=i.split(".");return"".concat(n[0].replace(/(\d)(?=(\d{3})+$)/g,(function(t){return"".concat(t).concat(e)})),".").concat(n[1])}return i.replace(/(\d)(?=(\d{3})+$)/g,(function(t){return"".concat(t).concat(e)}))}function K(t,e){var i="".concat(t);if(new RegExp("\\.0{"+e+",}[1-9][0-9]*$").test(i)){var n=i.split("."),o=n[n.length-1],r=o.match(/0*/);if(R(r)){var a=r[0].length;return n[n.length-1]=o.replace(/0*/,"0{".concat(a,"}")),n.join(".")}}return i}function Z(t){var e,i,n;return null!==(n=null===(i=null===(e=t.ownerDocument)||void 0===e?void 0:e.defaultView)||void 0===i?void 0:i.devicePixelRatio)&&void 0!==n?n:1}function q(t,e,i){return"".concat(null!=e?e:"normal"," ").concat(null!=t?t:12,"px ").concat(null!=i?i:"Helvetica Neue")}function Q(t,e,i,n){if(!R(N)){var o=document.createElement("canvas"),r=Z(o);(N=o.getContext("2d")).scale(r,r)}return N.font=q(e,i,n),Math.round(N.measureText(t).width)}t.ActionType=void 0,(W=t.ActionType||(t.ActionType={})).OnDataReady="onDataReady",W.OnZoom="onZoom",W.OnScroll="onScroll",W.OnVisibleRangeChange="onVisibleRangeChange",W.OnTooltipIconClick="onTooltipIconClick",W.OnCrosshairChange="onCrosshairChange",W.OnCandleBarClick="onCandleBarClick",W.OnPaneDrag="onPaneDrag",W.onRightClick="onRightClick";var $,J=function(){function t(){this._callbacks=[]}return t.prototype.subscribe=function(t){var e;(null!==(e=this._callbacks.indexOf(t))&&void 0!==e?e:-1)<0&&this._callbacks.push(t)},t.prototype.unsubscribe=function(t){var e;if(F(t)){var i=null!==(e=this._callbacks.indexOf(t))&&void 0!==e?e:-1;i>-1&&this._callbacks.splice(i,1)}else this._callbacks=[]},t.prototype.execute=function(t){this._callbacks.forEach((function(e){e(t)}))},t.prototype.isEmpty=function(){return 0===this._callbacks.length},t}();function tt(t,e,i,o,r){var a,s=e.result,l=e.figures,c=e.styles,u=H(c,"circles",o.circles),h=u.length,d=H(c,"bars",o.bars),p=d.length,g=H(c,"lines",o.lines),v=g.length,f=0,y=0,m=0,x=0;l.forEach((function(l){var c;switch(l.type){case"circle":x=f;var _=u[f%h];a=n(n({},_),{color:_.noChangeColor}),f++;break;case"bar":x=y;var S=d[y%p];a=n(n({},S),{color:S.noChangeColor}),y++;break;case"line":x=m,a=g[m%v],m++}if(R(a)){var w={prev:{kLineData:t[i-1],indicatorData:s[i-1]},current:{kLineData:t[i],indicatorData:s[i]},next:{kLineData:t[i+1],indicatorData:s[i+1]}},b=null===(c=l.styles)||void 0===c?void 0:c.call(l,w,e,o);r(l,n(n({},a),b),x)}}))}t.IndicatorSeries=void 0,($=t.IndicatorSeries||(t.IndicatorSeries={})).Normal="normal",$.Price="price",$.Volume="volume";var et,it=function(){function e(e){this.result=[],this._precisionFlag=!1;var i=e.name,n=e.shortName,o=e.series,r=e.calcParams,a=e.figures,s=e.precision,l=e.shouldOhlc,c=e.shouldFormatBigNumber,u=e.visible,h=e.zLevel,d=e.minValue,p=e.maxValue,g=e.styles,v=e.extendData,f=e.regenerateFigures,y=e.createTooltipDataSource,m=e.draw;this.name=i,this.shortName=null!=n?n:i,this.series=null!=o?o:t.IndicatorSeries.Normal,this.precision=null!=s?s:4,this.calcParams=null!=r?r:[],this.figures=null!=a?a:[],this.shouldOhlc=null!=l&&l,this.shouldFormatBigNumber=null!=c&&c,this.visible=null==u||u,this.zLevel=null!=h?h:0,this.minValue=null!=d?d:null,this.maxValue=null!=p?p:null,this.styles=k(null!=g?g:{}),this.extendData=v,this.regenerateFigures=null!=f?f:null,this.createTooltipDataSource=null!=y?y:null,this.draw=null!=m?m:null}return e.prototype.setShortName=function(t){return this.shortName!==t&&(this.shortName=t,!0)},e.prototype.setSeries=function(t){return this.series!==t&&(this.series=t,!0)},e.prototype.setPrecision=function(t,e){var i=null!=e&&e,n=Math.floor(t);return!(!(n!==this.precision&&t>=0)||i&&(!i||this._precisionFlag))&&(this.precision=n,i||(this._precisionFlag=!0),!0)},e.prototype.setCalcParams=function(t){var e,i;return this.calcParams=t,this.figures=null!==(i=null===(e=this.regenerateFigures)||void 0===e?void 0:e.call(this,t))&&void 0!==i?i:this.figures,!0},e.prototype.setShouldOhlc=function(t){return this.shouldOhlc!==t&&(this.shouldOhlc=t,!0)},e.prototype.setShouldFormatBigNumber=function(t){return this.shouldFormatBigNumber!==t&&(this.shouldFormatBigNumber=t,!0)},e.prototype.setVisible=function(t){return this.visible!==t&&(this.visible=t,!0)},e.prototype.setZLevel=function(t){return this.zLevel!==t&&(this.zLevel=t,!0)},e.prototype.setStyles=function(t){return M(this.styles,t),!0},e.prototype.setExtendData=function(t){return this.extendData!==t&&(this.extendData=t,!0)},e.prototype.setFigures=function(t){return this.figures!==t&&(this.figures=t,!0)},e.prototype.setMinValue=function(t){return this.minValue!==t&&(this.minValue=t,!0)},e.prototype.setMaxValue=function(t){return this.maxValue!==t&&(this.maxValue=t,!0)},e.prototype.setRegenerateFigures=function(t){return this.regenerateFigures!==t&&(this.regenerateFigures=t,!0)},e.prototype.setCreateTooltipDataSource=function(t){return this.createTooltipDataSource!==t&&(this.createTooltipDataSource=t,!0)},e.prototype.setDraw=function(t){return this.draw!==t&&(this.draw=t,!0)},e.prototype.calcIndicator=function(t){return o(this,void 0,void 0,(function(){var e,i;return r(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this.calc(t,this)];case 1:return e=n.sent(),this.result=e,[2,!0];case 2:return i=n.sent(),console.trace(i),[2,!1];case 3:return[2]}}))}))},e.extend=function(t){return function(e){function n(){return e.call(this,t)||this}return i(n,e),n.prototype.calc=function(e,i){return t.calc(e,i)},n}(e)},e}(),nt=function(){function t(){this.isShiftPressed=!1,document.onkeydown=this.handleKeyDown.bind(this),document.onkeyup=this.handleKeyUp.bind(this)}return t.getInstance=function(){return t.instance||(t.instance=new t),t.instance},t.prototype.handleKeyDown=function(t){t.shiftKey&&(this.isShiftPressed=!0)},t.prototype.handleKeyUp=function(t){t.shiftKey||(this.isShiftPressed=!1)},t.prototype.checkShiftKeyState=function(){return this.isShiftPressed},t}().getInstance();t.OverlayMode=void 0,(et=t.OverlayMode||(t.OverlayMode={})).Normal="normal",et.WeakMagnet="weak_magnet",et.StrongMagnet="strong_magnet";var ot,rt="overlay_figure_",at=Number.MAX_SAFE_INTEGER,st=["segment","parallelStraightLine","priceChannelLine"],lt=["parallelStraightLine","priceChannelLine"],ct=function(){function e(e){this.currentStep=1,this.points=[],this._prevPressedPoint=null,this._prevPressedPoints=[];var i=e.mode,n=e.modeSensitivity,o=e.extendData,r=e.styles,a=e.name,s=e.totalStep,l=e.lock,c=e.visible,u=e.zLevel,h=e.needDefaultPointFigure,d=e.needDefaultXAxisFigure,p=e.needDefaultYAxisFigure,g=e.createPointFigures,v=e.createXAxisFigures,f=e.createYAxisFigures,y=e.performEventPressedMove,m=e.performEventMoveForDrawing,x=e.onDrawStart,_=e.onDrawing,S=e.onDrawEnd,w=e.onClick,b=e.onDoubleClick,T=e.onRightClick,C=e.onPressedMoveStart,P=e.onPressedMoving,I=e.onPressedMoveEnd,D=e.onMouseEnter,E=e.onMouseLeave,M=e.onRemoved,A=e.onSelected,F=e.onDeselected;this.name=a,this.totalStep=!B(s)||s<2?1:s,this.lock=null!=l&&l,this.visible=null==c||c,this.zLevel=null!=u?u:0,this.needDefaultPointFigure=null!=h&&h,this.needDefaultXAxisFigure=null!=d&&d,this.needDefaultYAxisFigure=null!=p&&p,this.mode=null!=i?i:t.OverlayMode.Normal,this.modeSensitivity=null!=n?n:8,this.extendData=o,this.styles=k(null!=r?r:{}),this.createPointFigures=null!=g?g:null,this.createXAxisFigures=null!=v?v:null,this.createYAxisFigures=null!=f?f:null,this.performEventPressedMove=null!=y?y:null,this.performEventMoveForDrawing=null!=m?m:null,this.onDrawStart=null!=x?x:null,this.onDrawing=null!=_?_:null,this.onDrawEnd=null!=S?S:null,this.onClick=null!=w?w:null,this.onDoubleClick=null!=b?b:null,this.onRightClick=null!=T?T:null,this.onPressedMoveStart=null!=C?C:null,this.onPressedMoving=null!=P?P:null,this.onPressedMoveEnd=null!=I?I:null,this.onMouseEnter=null!=D?D:null,this.onMouseLeave=null!=E?E:null,this.onRemoved=null!=M?M:null,this.onSelected=null!=A?A:null,this.onDeselected=null!=F?F:null}return e.prototype.setId=function(t){return!O(this.id)&&(this.id=t,!0)},e.prototype.setGroupId=function(t){return!O(this.groupId)&&(this.groupId=t,!0)},e.prototype.setPaneId=function(t){this.paneId=t},e.prototype.setExtendData=function(t){return t!==this.extendData&&(this.extendData=t,!0)},e.prototype.setStyles=function(t){return M(this.styles,t),!0},e.prototype.setPoints=function(t){if(t.length>0){var e=void 0;if(this.points=l([],s(t),!1),t.length>=this.totalStep-1?(this.currentStep=-1,e=this.totalStep-1):(this.currentStep=t.length+1,e=t.length),null!==this.performEventMoveForDrawing)for(var i=0;i<e;i++)this.performEventMoveForDrawing({currentStep:i+2,mode:this.mode,points:this.points,performPointIndex:i,performPoint:this.points[i]});return-1===this.currentStep&&null!==this.performEventPressedMove&&this.performEventPressedMove({currentStep:this.currentStep,mode:this.mode,points:this.points,performPointIndex:this.points.length-1,performPoint:this.points[this.points.length-1]}),!0}return!1},e.prototype.setLock=function(t){return this.lock!==t&&(this.lock=t,!0)},e.prototype.setVisible=function(t){return this.visible!==t&&(this.visible=t,!0)},e.prototype.setZLevel=function(t){return this.zLevel!==t&&(this.zLevel=t,!0)},e.prototype.setMode=function(t){return this.mode!==t&&(this.mode=t,!0)},e.prototype.setModeSensitivity=function(t){return this.modeSensitivity!==t&&(this.modeSensitivity=t,!0)},e.prototype.setOnDrawStartCallback=function(t){return this.onDrawStart!==t&&(this.onDrawStart=t,!0)},e.prototype.setOnDrawingCallback=function(t){return this.onDrawing!==t&&(this.onDrawing=t,!0)},e.prototype.setOnDrawEndCallback=function(t){return this.onDrawEnd!==t&&(this.onDrawEnd=t,!0)},e.prototype.setOnClickCallback=function(t){return this.onClick!==t&&(this.onClick=t,!0)},e.prototype.setOnDoubleClickCallback=function(t){return this.onDoubleClick!==t&&(this.onDoubleClick=t,!0)},e.prototype.setOnRightClickCallback=function(t){return this.onRightClick!==t&&(this.onRightClick=t,!0)},e.prototype.setOnPressedMoveStartCallback=function(t){return this.onPressedMoveStart!==t&&(this.onPressedMoveStart=t,!0)},e.prototype.setOnPressedMovingCallback=function(t){return this.onPressedMoving!==t&&(this.onPressedMoving=t,!0)},e.prototype.setOnPressedMoveEndCallback=function(t){return this.onPressedMoveEnd!==t&&(this.onPressedMoveEnd=t,!0)},e.prototype.setOnMouseEnterCallback=function(t){return this.onMouseEnter!==t&&(this.onMouseEnter=t,!0)},e.prototype.setOnMouseLeaveCallback=function(t){return this.onMouseLeave!==t&&(this.onMouseLeave=t,!0)},e.prototype.setOnRemovedCallback=function(t){return this.onRemoved!==t&&(this.onRemoved=t,!0)},e.prototype.setOnSelectedCallback=function(t){return this.onSelected!==t&&(this.onSelected=t,!0)},e.prototype.setOnDeselectedCallback=function(t){return this.onDeselected!==t&&(this.onDeselected=t,!0)},e.prototype.nextStep=function(){this.currentStep===this.totalStep-1?this.currentStep=-1:this.currentStep++},e.prototype.forceComplete=function(){this.currentStep=-1},e.prototype.isDrawing=function(){return-1!==this.currentStep},e.prototype.isStart=function(){return 1===this.currentStep},e.prototype.eventMoveForDrawing=function(t,e){var i,n=this.currentStep-1,o={},r=nt.checkShiftKeyState();!1!==B(t.timestamp)&&(2===n&&lt.includes(this.name)?(B(t.timestamp)&&(t.timestamp>this.points[1].timestamp?o.timestamp=this.points[1].timestamp:t.timestamp<this.points[0].timestamp?o.timestamp=this.points[0].timestamp:o.timestamp=t.timestamp),B(t.dataIndex)&&(t.dataIndex>this.points[1].dataIndex?o.dataIndex=this.points[1].dataIndex:t.dataIndex<this.points[0].dataIndex?o.dataIndex=this.points[0].dataIndex:o.dataIndex=t.dataIndex)):(B(t.timestamp)?o.timestamp=t.timestamp:n>0&&(o.timestamp=e[e.length-1].timestamp),B(t.dataIndex)?o.dataIndex=t.dataIndex:n>0&&(o.dataIndex=e.length-1)),1===n&&st.includes(this.name)&&r?o.value=this.points[0].value:B(t.value)&&(o.value=t.value),this.points[n]=o,null===(i=this.performEventMoveForDrawing)||void 0===i||i.call(this,{currentStep:this.currentStep,mode:this.mode,points:this.points,performPointIndex:n,performPoint:o}))},e.prototype.eventPressedPointMove=function(t,e,i){var n,o=nt.checkShiftKeyState();2===e&&lt.includes(this.name)?B(t.dataIndex)&&(t.dataIndex>=this.points[1].dataIndex?(this.points[2].dataIndex=this.points[1].dataIndex,this.points[2].timestamp=this.points[1].timestamp):t.dataIndex<this.points[0].dataIndex?(this.points[2].dataIndex=this.points[0].dataIndex,this.points[2].timestamp=this.points[0].timestamp):(this.points[2].dataIndex=t.dataIndex,this.points[2].timestamp=t.timestamp)):B(t.dataIndex)&&B(t.timestamp)?(this.points[e].dataIndex=t.dataIndex,this.points[e].timestamp=t.timestamp):(this.points[e].dataIndex=i.length-1,this.points[e].timestamp=i[i.length-1].timestamp),1===e&&st.includes(this.name)?o?this.points[e].value=this.points[0].value:B(t.value)&&(this.points[e].value=t.value):B(t.value)?this.points[e].value=t.value:this.points[e].dataIndex=i.length-1,null===(n=this.performEventPressedMove)||void 0===n||n.call(this,{currentStep:this.currentStep,points:this.points,mode:this.mode,performPointIndex:e,performPoint:this.points[e]})},e.prototype.startPressedMove=function(t){this._prevPressedPoint=n({},t),this._prevPressedPoints=k(this.points)},e.prototype.eventPressedOtherMove=function(t,e){var i,o;null!==this._prevPressedPoint&&(B(t.dataIndex)&&B(this._prevPressedPoint.dataIndex)&&(i=t.dataIndex-this._prevPressedPoint.dataIndex),B(t.value)&&B(this._prevPressedPoint.value)&&(o=t.value-this._prevPressedPoint.value),this.points=this._prevPressedPoints.map((function(t){var r;B(t.timestamp)&&(t.dataIndex=e.timestampToDataIndex(t.timestamp));var a=n({},t);return B(i)&&B(t.dataIndex)&&(a.dataIndex=t.dataIndex+i,a.timestamp=null!==(r=e.dataIndexToTimestamp(a.dataIndex))&&void 0!==r?r:void 0),B(o)&&B(t.value)&&(a.value=t.value+o),a})))},e.extend=function(t){return function(e){function n(){return e.call(this,t)||this}return i(n,e),n}(e)},e}();t.FormatDateType=void 0,(ot=t.FormatDateType||(t.FormatDateType={}))[ot.Tooltip=0]="Tooltip",ot[ot.Crosshair=1]="Crosshair",ot[ot.XAxis=2]="XAxis";var ut;!function(t){t.Init="init",t.Forward="forward",t.Backward="backward"}(ut||(ut={}));var ht=1,dt=(new Date).getTime();function pt(t){var e=(new Date).getTime();return e===dt?++ht:ht=1,dt=e,"".concat(null!=t?t:"").concat(e,"_").concat(ht)}function gt(t,e){var i,n=document.createElement(t),o=null!=e?e:{};for(var r in o)n.style[r]=null!==(i=o[r])&&void 0!==i?i:"";return n}function vt(t,e,i){var n=0,o=0;for(o=t.length-1;n!==o;){var r=Math.floor((o+n)/2),a=o-n,s=t[r][e];if(i===t[n][e])return n;if(i===t[o][e])return o;if(i===s)return r;if(i>s?n=r:o=r,a<=2)break}return n}function ft(t,e){return null==e&&(e=10),e=Math.min(Math.max(0,e),20),+(+t).toFixed(e)}function yt(t,e,i){var n=[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER];return t.forEach((function(t){var o,r;n[0]=Math.max(null!==(o=t[e])&&void 0!==o?o:t,n[0]),n[1]=Math.min(null!==(r=t[i])&&void 0!==r?r:t,n[1])})),n}function mt(t){return Math.log(t)/Math.log(10)}function xt(t){return Math.pow(10,t)}var _t=1,St=50,wt=function(){function e(t){this._dateTimeFormat=this._buildDateTimeFormat(),this._zoomEnabled=!0,this._scrollEnabled=!0,this._totalBarSpace=0,this._barSpace=8,this._offsetRightDistance=80,this._startLastBarRightSideDiffBarCount=0,this._scrollLimitRole=0,this._minVisibleBarCount={left:2,right:2},this._maxOffsetDistance={left:50,right:50},this._visibleRange={from:0,to:0,realFrom:0,realTo:0},this._chartStore=t,this._gapBarSpace=this._calcGapBarSpace(),this._lastBarRightSideDiffBarCount=this._offsetRightDistance/this._barSpace}return e.prototype._calcGapBarSpace=function(){var t=Math.floor(.82*this._barSpace),e=Math.floor(this._barSpace),i=Math.min(t,e-1);return Math.max(1,i)},e.prototype.adjustVisibleRange=function(){var e,i,n,o,r=this._chartStore.getDataList(),a=r.length,s=this._totalBarSpace/this._barSpace;1===this._scrollLimitRole?(n=(this._totalBarSpace-this._maxOffsetDistance.right)/this._barSpace,o=(this._totalBarSpace-this._maxOffsetDistance.left)/this._barSpace):(n=this._minVisibleBarCount.left,o=this._minVisibleBarCount.right),n=Math.max(0,n),o=Math.max(0,o);var l=s-Math.min(n,a);this._lastBarRightSideDiffBarCount>l&&(this._lastBarRightSideDiffBarCount=l);var c=-a+Math.min(o,a);this._lastBarRightSideDiffBarCount<c&&(this._lastBarRightSideDiffBarCount=c);var u=Math.round(this._lastBarRightSideDiffBarCount+a+.5),h=u;u>a&&(u=a);var d=Math.round(u-s)-1;d<0&&(d=0);var p=this._lastBarRightSideDiffBarCount>0?Math.round(a+this._lastBarRightSideDiffBarCount-s)-1:d;if(this._visibleRange={from:d,to:u,realFrom:p,realTo:h},this._chartStore.getActionStore().execute(t.ActionType.OnVisibleRangeChange,this._visibleRange),this._chartStore.adjustVisibleDataList(),0===d){var g=r[0];this._chartStore.executeLoadMoreCallback(null!==(e=null==g?void 0:g.timestamp)&&void 0!==e?e:null),this._chartStore.executeLoadDataCallback({type:ut.Forward,data:null!=g?g:null})}u===a&&this._chartStore.executeLoadDataCallback({type:ut.Backward,data:null!==(i=r[a-1])&&void 0!==i?i:null})},e.prototype.getDateTimeFormat=function(){return this._dateTimeFormat},e.prototype._buildDateTimeFormat=function(t){var e={hour12:!1,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"};O(t)&&(e.timeZone=t);var i=null;try{i=new Intl.DateTimeFormat("en",e)}catch(t){}return i},e.prototype.setTimezone=function(t){var e=this._buildDateTimeFormat(t);null!==e&&(this._dateTimeFormat=e)},e.prototype.getTimezone=function(){return this._dateTimeFormat.resolvedOptions().timeZone},e.prototype.getBarSpace=function(){return{bar:this._barSpace,halfBar:this._barSpace/2,gapBar:this._gapBarSpace,halfGapBar:this._gapBarSpace/2}},e.prototype.setBarSpace=function(t,e){t<_t||t>St||this._barSpace===t||(this._barSpace=t,this._gapBarSpace=this._calcGapBarSpace(),null==e||e(),this.adjustVisibleRange(),this._chartStore.getTooltipStore().recalculateCrosshair(!0),this._chartStore.getChart().adjustPaneViewport(!1,!0,!0,!0))},e.prototype.setTotalBarSpace=function(t){return this._totalBarSpace!==t&&(this._totalBarSpace=t,this.adjustVisibleRange(),this._chartStore.getTooltipStore().recalculateCrosshair(!0)),this},e.prototype.setOffsetRightDistance=function(t,e){return this._offsetRightDistance=1===this._scrollLimitRole?Math.min(this._maxOffsetDistance.right,t):t,this._lastBarRightSideDiffBarCount=this._offsetRightDistance/this._barSpace,null!=e&&e&&(this.adjustVisibleRange(),this._chartStore.getTooltipStore().recalculateCrosshair(!0),this._chartStore.getChart().adjustPaneViewport(!1,!0,!0,!0)),this},e.prototype.resetOffsetRightDistance=function(){this.setOffsetRightDistance(this._offsetRightDistance)},e.prototype.getInitialOffsetRightDistance=function(){return this._offsetRightDistance},e.prototype.getOffsetRightDistance=function(){return Math.max(0,this._lastBarRightSideDiffBarCount*this._barSpace)},e.prototype.getLastBarRightSideDiffBarCount=function(){return this._lastBarRightSideDiffBarCount},e.prototype.setLastBarRightSideDiffBarCount=function(t){return this._lastBarRightSideDiffBarCount=t,this},e.prototype.setMaxOffsetLeftDistance=function(t){return this._scrollLimitRole=1,this._maxOffsetDistance.left=t,this},e.prototype.setMaxOffsetRightDistance=function(t){return this._scrollLimitRole=1,this._maxOffsetDistance.right=t,this},e.prototype.setLeftMinVisibleBarCount=function(t){return this._scrollLimitRole=0,this._minVisibleBarCount.left=t,this},e.prototype.setRightMinVisibleBarCount=function(t){return this._scrollLimitRole=0,this._minVisibleBarCount.right=t,this},e.prototype.getVisibleRange=function(){return this._visibleRange},e.prototype.startScroll=function(){this._startLastBarRightSideDiffBarCount=this._lastBarRightSideDiffBarCount},e.prototype.scroll=function(e){if(this._scrollEnabled){var i=e/this._barSpace;this._chartStore.getActionStore().execute(t.ActionType.OnScroll),this._lastBarRightSideDiffBarCount=this._startLastBarRightSideDiffBarCount-i,this.adjustVisibleRange(),this._chartStore.getTooltipStore().recalculateCrosshair(!0),this._chartStore.getChart().adjustPaneViewport(!1,!0,!0,!0)}},e.prototype.getDataByDataIndex=function(t){var e;return null!==(e=this._chartStore.getDataList()[t])&&void 0!==e?e:null},e.prototype.coordinateToFloatIndex=function(t){var e=this._chartStore.getDataList().length,i=(this._totalBarSpace-t)/this._barSpace,n=e+this._lastBarRightSideDiffBarCount-i;return Math.round(1e6*n)/1e6},e.prototype.dataIndexToTimestamp=function(t){var e,i=this.getDataByDataIndex(t);return null!==(e=null==i?void 0:i.timestamp)&&void 0!==e?e:null},e.prototype.timestampToDataIndex=function(t){var e=this._chartStore.getDataList();return 0===e.length?0:vt(e,"timestamp",t)},e.prototype.dataIndexToCoordinate=function(t){var e=this._chartStore.getDataList().length+this._lastBarRightSideDiffBarCount-t;return Math.floor(this._totalBarSpace-(e-.5)*this._barSpace)-.5},e.prototype.coordinateToDataIndex=function(t){return Math.ceil(this.coordinateToFloatIndex(t))-1},e.prototype.zoom=function(e,i){var n,o=this;if(this._zoomEnabled){var r=null!=i?i:null;if(!B(null==r?void 0:r.x)){var a=this._chartStore.getTooltipStore().getCrosshair();r={x:null!==(n=null==a?void 0:a.x)&&void 0!==n?n:this._totalBarSpace/2}}this._chartStore.getActionStore().execute(t.ActionType.OnZoom);var s=r.x,l=this.coordinateToFloatIndex(s),c=this._barSpace+e*(this._barSpace/10);this.setBarSpace(c,(function(){o._lastBarRightSideDiffBarCount+=l-o.coordinateToFloatIndex(s)}))}},e.prototype.setZoomEnabled=function(t){return this._zoomEnabled=t,this},e.prototype.getZoomEnabled=function(){return this._zoomEnabled},e.prototype.setScrollEnabled=function(t){return this._scrollEnabled=t,this},e.prototype.getScrollEnabled=function(){return this._scrollEnabled},e.prototype.clear=function(){this._visibleRange={from:0,to:0,realFrom:0,realTo:0}},e}(),bt={name:"AO",shortName:"AO",calcParams:[5,34],figures:[{key:"ao",title:"AO: ",type:"bar",baseValue:0,styles:function(e,i,n){var o,r,a,s,l,c=e.prev,u=e.current,h=null!==(r=null===(o=c.indicatorData)||void 0===o?void 0:o.ao)&&void 0!==r?r:Number.MIN_SAFE_INTEGER,d=null!==(s=null===(a=u.indicatorData)||void 0===a?void 0:a.ao)&&void 0!==s?s:Number.MIN_SAFE_INTEGER;return{color:l=d>h?H(i.styles,"bars[0].upColor",n.bars[0].upColor):H(i.styles,"bars[0].downColor",n.bars[0].downColor),style:d>h?t.PolygonType.Stroke:t.PolygonType.Fill,borderColor:l}}}],calc:function(t,e){var i=e.calcParams,n=Math.max(i[0],i[1]),o=0,r=0,a=0,s=0;return t.map((function(e,l){var c={},u=(e.low+e.high)/2;if(o+=u,r+=u,l>=i[0]-1){a=o/i[0];var h=t[l-(i[0]-1)];o-=(h.low+h.high)/2}if(l>=i[1]-1){s=r/i[1];h=t[l-(i[1]-1)];r-=(h.low+h.high)/2}return l>=n-1&&(c.ao=a-s),c}))}};var Tt={name:"BOLL",shortName:"BOLL",series:t.IndicatorSeries.Price,calcParams:[20,2],precision:2,shouldOhlc:!0,isOverlay:!0,figures:[{key:"up",title:"UP: ",type:"line"},{key:"mid",title:"MID: ",type:"line"},{key:"dn",title:"DN: ",type:"line"}],calc:function(t,e){var i=e.calcParams,n=i[0]-1,o=0;return t.map((function(e,r){var a=e.close,s={};if(o+=a,r>=n){s.mid=o/i[0];var l=function(t,e){var i=t.length,n=0;return t.forEach((function(t){var i=t.close-e;n+=i*i})),n=Math.abs(n),Math.sqrt(n/i)}(t.slice(r-n,r+1),s.mid);s.up=s.mid+i[1]*l,s.dn=s.mid-i[1]*l,o-=t[r-n].close}return s}))}},Ct={name:"BBI",shortName:"BBI",series:t.IndicatorSeries.Price,precision:2,calcParams:[3,6,12,24],shouldOhlc:!0,figures:[{key:"bbi",title:"BBI: ",type:"line"}],calc:function(t,e){var i=e.calcParams,n=Math.max.apply(Math,l([],s(i),!1)),o=[],r=[];return t.map((function(e,a){var s={},l=e.close;if(i.forEach((function(e,i){var n;o[i]=(null!==(n=o[i])&&void 0!==n?n:0)+l,a>=e-1&&(r[i]=o[i]/e,o[i]-=t[a-(e-1)].close)})),a>=n-1){var c=0;r.forEach((function(t){c+=t})),s.bbi=c/4}return s}))}},Pt={name:"CCI",shortName:"CCI",calcParams:[20],figures:[{key:"cci",title:"CCI: ",type:"line"}],calc:function(t,e){var i=e.calcParams,n=i[0]-1,o=0,r=[];return t.map((function(e,a){var s={},l=(e.high+e.low+e.close)/3;if(o+=l,r.push(l),a>=n){var c=o/i[0],u=r.slice(a-n,a+1),h=0;u.forEach((function(t){h+=Math.abs(t-c)}));var d=h/i[0];s.cci=0!==d?(l-c)/d/.015:0;var p=(t[a-n].high+t[a-n].low+t[a-n].close)/3;o-=p}return s}))}},It={name:"CR",shortName:"CR",calcParams:[26,10,20,40,60],figures:[{key:"cr",title:"CR: ",type:"line"},{key:"ma1",title:"MA1: ",type:"line"},{key:"ma2",title:"MA2: ",type:"line"},{key:"ma3",title:"MA3: ",type:"line"},{key:"ma4",title:"MA4: ",type:"line"}],calc:function(t,e){var i=e.calcParams,n=Math.ceil(i[1]/2.5+1),o=Math.ceil(i[2]/2.5+1),r=Math.ceil(i[3]/2.5+1),a=Math.ceil(i[4]/2.5+1),s=0,l=[],c=0,u=[],h=0,d=[],p=0,g=[],v=[];return t.forEach((function(e,f){var y,m,x,_,S,w={},b=null!==(y=t[f-1])&&void 0!==y?y:e,T=(b.high+b.close+b.low+b.open)/4,C=Math.max(0,e.high-T),P=Math.max(0,T-e.low);f>=i[0]-1&&(w.cr=0!==P?C/P*100:0,s+=w.cr,c+=w.cr,h+=w.cr,p+=w.cr,f>=i[0]+i[1]-2&&(l.push(s/i[1]),f>=i[0]+i[1]+n-3&&(w.ma1=l[l.length-1-n]),s-=null!==(m=v[f-(i[1]-1)].cr)&&void 0!==m?m:0),f>=i[0]+i[2]-2&&(u.push(c/i[2]),f>=i[0]+i[2]+o-3&&(w.ma2=u[u.length-1-o]),c-=null!==(x=v[f-(i[2]-1)].cr)&&void 0!==x?x:0),f>=i[0]+i[3]-2&&(d.push(h/i[3]),f>=i[0]+i[3]+r-3&&(w.ma3=d[d.length-1-r]),h-=null!==(_=v[f-(i[3]-1)].cr)&&void 0!==_?_:0),f>=i[0]+i[4]-2&&(g.push(p/i[4]),f>=i[0]+i[4]+a-3&&(w.ma4=g[g.length-1-a]),p-=null!==(S=v[f-(i[4]-1)].cr)&&void 0!==S?S:0)),v.push(w)})),v}},Dt={name:"DMA",shortName:"DMA",calcParams:[10,50,10],figures:[{key:"dma",title:"DMA: ",type:"line"},{key:"ama",title:"AMA: ",type:"line"}],calc:function(t,e){var i=e.calcParams,n=Math.max(i[0],i[1]),o=0,r=0,a=0,s=[];return t.forEach((function(e,l){var c,u={},h=e.close;o+=h,r+=h;var d=0,p=0;if(l>=i[0]-1&&(d=o/i[0],o-=t[l-(i[0]-1)].close),l>=i[1]-1&&(p=r/i[1],r-=t[l-(i[1]-1)].close),l>=n-1){var g=d-p;u.dma=g,a+=g,l>=n+i[2]-2&&(u.ama=a/i[2],a-=null!==(c=s[l-(i[2]-1)].dma)&&void 0!==c?c:0)}s.push(u)})),s}},Et={name:"DMI",shortName:"DMI",calcParams:[14,6],figures:[{key:"pdi",title:"PDI: ",type:"line"},{key:"mdi",title:"MDI: ",type:"line"},{key:"adx",title:"ADX: ",type:"line"},{key:"adxr",title:"ADXR: ",type:"line"}],calc:function(t,e){var i=e.calcParams,n=0,o=0,r=0,a=0,s=0,l=0,c=0,u=0,h=[];return t.forEach((function(e,d){var p,g,v={},f=null!==(p=t[d-1])&&void 0!==p?p:e,y=f.close,m=e.high,x=e.low,_=m-x,S=Math.abs(m-y),w=Math.abs(y-x),b=m-f.high,T=f.low-x,C=Math.max(Math.max(_,S),w),P=b>0&&b>T?b:0,I=T>0&&T>b?T:0;if(n+=C,o+=P,r+=I,d>=i[0]-1){d>i[0]-1?(a=a-a/i[0]+C,s=s-s/i[0]+P,l=l-l/i[0]+I):(a=n,s=o,l=r);var D=0,E=0;0!==a&&(D=100*s/a,E=100*l/a),v.pdi=D,v.mdi=E;var M=0;E+D!==0&&(M=Math.abs(E-D)/(E+D)*100),c+=M,d>=2*i[0]-2&&(u=d>2*i[0]-2?(u*(i[0]-1)+M)/i[0]:c/i[0],v.adx=u,d>=2*i[0]+i[1]-3&&(v.adxr=((null!==(g=h[d-(i[1]-1)].adx)&&void 0!==g?g:0)+u)/2))}h.push(v)})),h}},Mt={name:"EMA",shortName:"EMA",series:t.IndicatorSeries.Price,calcParams:[7,21,50],precision:2,shouldOhlc:!0,isOverlay:!0,figures:[{key:"ema1",title:"EMA7: ",type:"line"},{key:"ema2",title:"EMA21: ",type:"line"},{key:"ema3",title:"EMA50: ",type:"line"}],regenerateFigures:function(t){return t.map((function(t,e){return{key:"ema".concat(e+1),title:"EMA".concat(t,": "),type:"line"}}))},calc:function(t,e){var i=e.calcParams,n=e.figures,o=[],r=[0,0,0];return t.map((function(e,a){var s={},l=e.close;return i.forEach((function(e,i){var c=n[i].key;if(r[i]+=l,a>=e-1){o[i]=a>e-1?(2*l+(e-1)*o[i])/(e+1):r[i]/e;var u=o[i];if(s[c]=u,0===i&&a>0){var h=t[a-1].close,d=o[i],p=l;h<d&&p>u?s.metaData={direction:"BUY",entry:l}:h>d&&p<u&&(s.metaData={direction:"SELL",entry:l})}}})),s}))}},kt={name:"MA",shortName:"MA",series:t.IndicatorSeries.Price,calcParams:[7,20,50,200],precision:2,shouldOhlc:!0,isOverlay:!0,figures:[{key:"ma1",title:"MA5: ",type:"line"},{key:"ma2",title:"MA20: ",type:"line"},{key:"ma3",title:"MA50: ",type:"line"},{key:"ma4",title:"MA200: ",type:"line"}],regenerateFigures:function(t){return t.map((function(t,e){return{key:"ma".concat(e+1),title:"MA".concat(t,": "),type:"line"}}))},calc:function(t,e){var i=e.calcParams,n=e.figures,o=[];return t.map((function(e,r){var a={},s=e.close;return i.forEach((function(e,i){var l;o[i]=(null!==(l=o[i])&&void 0!==l?l:0)+s,r>=e-1&&(a[n[i].key]=o[i]/e,o[i]-=t[r-(e-1)].close)})),a}))}},At={name:"MACD",shortName:"MACD",calcParams:[12,26,9],figures:[{key:"dif",title:"DIF: ",type:"line"},{key:"dea",title:"DEA: ",type:"line"},{key:"macd",title:"MACD: ",type:"bar",baseValue:0,styles:function(e,i,n){var o,r,a,s,l,c=e.prev,u=e.current,h=null!==(r=null===(o=c.indicatorData)||void 0===o?void 0:o.macd)&&void 0!==r?r:Number.MIN_SAFE_INTEGER,d=null!==(s=null===(a=u.indicatorData)||void 0===a?void 0:a.macd)&&void 0!==s?s:Number.MIN_SAFE_INTEGER;return l=d>0?H(i.styles,"bars[0].upColor",n.bars[0].upColor):d<0?H(i.styles,"bars[0].downColor",n.bars[0].downColor):H(i.styles,"bars[0].noChangeColor",n.bars[0].noChangeColor),{style:h<d?t.PolygonType.Stroke:t.PolygonType.Fill,color:l,borderColor:l}}}],calc:function(t,e){var i,n,o=e.calcParams,r=0,a=0,s=0,l=0,c=Math.max(o[0],o[1]);return t.map((function(t,e){var u={},h=t.close;return r+=h,e>=o[0]-1&&(i=e>o[0]-1?(2*h+(o[0]-1)*i)/(o[0]+1):r/o[0]),e>=o[1]-1&&(n=e>o[1]-1?(2*h+(o[1]-1)*n)/(o[1]+1):r/o[1]),e>=c-1&&(a=i-n,u.dif=a,s+=a,e>=c+o[2]-2&&(l=e>c+o[2]-2?(2*a+l*(o[2]-1))/(o[2]+1):s/o[2],u.macd=2*(a-l),u.dea=l)),u}))}},Ft={name:"RSI",shortName:"RSI",calcParams:[14],figures:[{key:"rsi1",title:"RSI1: ",type:"line"}],regenerateFigures:function(t){return t.map((function(t,e){var i=e+1;return{key:"rsi".concat(i),title:"RSI".concat(i,": "),type:"line"}}))},calc:function(t,e){var i=e.calcParams,n=e.figures,o=[],r=[];return t.map((function(e,a){var s,l,c,u,h={},d=(null!==(s=t[a-1])&&void 0!==s?s:e).close,p=e.close-d,g=i[0];if(p>0?o[0]=(null!==(l=o[0])&&void 0!==l?l:0)+p:r[0]=(null!==(c=r[0])&&void 0!==c?c:0)+Math.abs(p),a>=g-1){0!==r[0]?h[n[0].key]=100-100/(1+o[0]/r[0]):h[n[0].key]=0;var v=t[a-(g-1)],f=null!==(u=t[a-g])&&void 0!==u?u:v,y=v.close-f.close;y>0?o[0]-=y:r[0]-=Math.abs(y)}return h}))}},Lt={name:"SMA",shortName:"SMA",series:t.IndicatorSeries.Price,calcParams:[12,2],precision:2,isOverlay:!0,figures:[{key:"sma",title:"SMA: ",type:"line"}],shouldOhlc:!0,calc:function(t,e){var i=e.calcParams,n=0,o=0;return t.map((function(t,e){var r={},a=t.close;return n+=a,e>=i[0]-1&&(o=e>i[0]-1?(a*i[1]+o*(i[0]-i[1]+1))/(i[0]+1):n/i[0],r.sma=o),r}))}},Bt={name:"KDJ",shortName:"KDJ",calcParams:[9,3,3],figures:[{key:"k",title:"K: ",type:"line"},{key:"d",title:"D: ",type:"line"},{key:"j",title:"J: ",type:"line"}],calc:function(t,e){var i=e.calcParams,n=[];return t.forEach((function(e,o){var r,a,s,l,c={},u=e.close;if(o>=i[0]-1){var h=yt(t.slice(o-(i[0]-1),o+1),"high","low"),d=h[0],p=h[1],g=d-p,v=(u-p)/(0===g?1:g)*100;c.k=((i[1]-1)*(null!==(a=null===(r=n[o-1])||void 0===r?void 0:r.k)&&void 0!==a?a:50)+v)/i[1],c.d=((i[2]-1)*(null!==(l=null===(s=n[o-1])||void 0===s?void 0:s.d)&&void 0!==l?l:50)+c.k)/i[2],c.j=3*c.k-2*c.d}n.push(c)})),n}},Rt={name:"SAR",shortName:"SAR",series:t.IndicatorSeries.Price,calcParams:[2,2,20],precision:2,shouldOhlc:!0,isOverlay:!0,figures:[{key:"sar",title:"SAR: ",type:"circle",styles:function(t,e,i){var n,o,r=t.current,a=null!==(o=null===(n=r.indicatorData)||void 0===n?void 0:n.sar)&&void 0!==o?o:Number.MIN_SAFE_INTEGER,s=r.kLineData;return{color:a<((null==s?void 0:s.high)+(null==s?void 0:s.low))/2?H(e.styles,"circles[0].upColor",i.circles[0].upColor):H(e.styles,"circles[0].downColor",i.circles[0].downColor)}}}],calc:function(t,e){var i=e.calcParams,n=i[0]/100,o=i[1]/100,r=i[2]/100,a=n,s=-100,l=!1,c=0;return t.map((function(e,i){var u=c,h=e.high,d=e.low;if(l){(-100===s||s<h)&&(s=h,a=Math.min(a+o,r)),c=u+a*(s-u);var p=Math.min(t[Math.max(1,i)-1].low,d);c>e.low?(c=s,a=n,s=-100,l=!l):c>p&&(c=p)}else{(-100===s||s>d)&&(s=d,a=Math.min(a+o,r)),c=u+a*(s-u);var g=Math.max(t[Math.max(1,i)-1].high,h);c<e.high?(c=s,a=0,s=-100,l=!l):c<g&&(c=g)}return{sar:c}}))}};var Vt={name:"VOL",shortName:"VOL",series:t.IndicatorSeries.Volume,shouldFormatBigNumber:!0,precision:0,minValue:0,figures:[{key:"volume",title:"VOLUME: ",type:"bar",baseValue:0,styles:function(t,e,i){var n;return{color:null===(n=t.current.indicatorData)||void 0===n?void 0:n.color}}}],calc:function(t,e){return t.map((function(e,i){var n,o,r=null!==(n=e.volume)&&void 0!==n?n:0;if(i<2)o=e.close>=e.open?m:x;else{var a=t[i],s=t[i-1],l=t[i-2];o=a.close===s.close?s.close>l.close?m:x:a.close>s.close?m:x}return{volume:r,color:o}}))}},Ot={name:"WR",shortName:"WR",calcParams:[6,10,14],figures:[{key:"wr1",title:"WR1: ",type:"line"},{key:"wr2",title:"WR2: ",type:"line"},{key:"wr3",title:"WR3: ",type:"line"}],regenerateFigures:function(t){return t.map((function(t,e){return{key:"wr".concat(e+1),title:"WR".concat(e+1,": "),type:"line"}}))},calc:function(t,e){var i=e.calcParams,n=e.figures;return t.map((function(e,o){var r={},a=e.close;return i.forEach((function(e,i){var s=e-1;if(o>=s){var l=yt(t.slice(o-s,o+1),"high","low"),c=l[0],u=c-l[1];r[n[i].key]=0===u?0:(a-c)/u*100}})),r}))}};var Nt={name:"TW",shortName:"TWave Volume",series:t.IndicatorSeries.Volume,shouldFormatBigNumber:!0,figures:[{key:"volume",title:"VAL: ",type:"bar",baseValue:0,styles:function(t,e,i){var n=t.current.indicatorData;return{color:null==n?void 0:n.color}}}],calc:function(t,e){e.calcParams,e.figures;for(var i=[],n=Array(t.length).fill(-1),o=0;o<t.length;o++)if(o<2)i.push({volume:0,color:"red"});else{t[o].close===t[o-1].close?t[o-1].close>t[o-2].close?n[o]=1:n[o]=0:t[o].close>t[o-1].close?n[o]=1:n[o]=0;for(var r=n[o],a=o;n[a]==n[a-1]&&a>2;)a--;for(var s=0,l=a;l<=o;l++){s+=t[l].volume;var c=void 0;c=1==r?m:x,i[l]={volume:s,color:c}}}return i}};var Wt={name:"TB",shortName:"TBlock Volume",series:t.IndicatorSeries.Volume,shouldFormatBigNumber:!0,figures:[{key:"volume",title:"VAL: ",type:"bar",baseValue:0,styles:function(t,e,i){var n=t.current.indicatorData;return{color:null==n?void 0:n.color}},attrs:function(t){return{size:10}}}],calc:function(t,e){e.calcParams,e.figures;for(var i=[],n=Array(t.length).fill(-1),o=0;o<t.length;o++)if(o<2)i.push({volume:0,color:"red"});else{t[o].close===t[o-1].close?t[o-1].close>t[o-2].close?n[o]=1:n[o]=0:t[o].close>t[o-1].close?n[o]=1:n[o]=0;for(var r=n[o],a=o;n[a]==n[a-1]&&a>2;)a--;for(var s=0,l=0,c=a;c<=o;c++){t[c].volume,s+=t[c].bidVol,l+=t[c].askVol}for(c=a;c<=o;c++){var u=void 0;u=1==r?m:x,i[c]={volume:l-s,color:u}}}return i}};var zt={name:"TPA",shortName:"TPace",series:t.IndicatorSeries.Volume,shouldFormatBigNumber:!0,minValue:0,figures:[{key:"pace",title:"VAL: ",type:"bar",baseValue:0,styles:function(t,e,i){var n,o=t.current.kLineData;return R(o)&&(n=o.close>o.open?m:x),{color:n}}}],calc:function(t,e){return t.map((function(t,e){var i=function(t){var e=Math.abs(t.close-t.open);return t.close===t.open?0:(t.askVol-t.bidVol)*e}(t);return{pace:i}}))}};var Yt={name:"TBA",shortName:"TBidAsk Oscillator",shouldFormatBigNumber:!0,figures:[{key:"bid",title:"Supply: ",type:"line",styles:function(t,e,i){return{color:x}}},{key:"ask",title:"Demand: ",type:"line",styles:function(t,e,i){return{color:m}}}],calc:function(t,e){e.calcParams;var i=[];return t.forEach((function(t,e){var n={};if(e>=20){var o=function(t,e){for(var i=0,n=0,o=t-20;o<t;o++)i+=e.bidVol,n+=e.askVol;return{bid:i/=20,ask:n/=20}}(e,t);n.bid=o.bid,n.ask=o.ask}i.push(n)})),i}};var Ht,Xt,Ut,Gt={name:"TCD",shortName:"TCumulative Delta",series:t.IndicatorSeries.Volume,shouldFormatBigNumber:!0,minValue:0,figures:[{key:"cumDelta",type:"bar",baseValue:0,styles:function(t,e,i){var n;return{color:null===(n=t.current.indicatorData)||void 0===n?void 0:n.color}}}],calc:function(t,e){var i=[];return t.forEach((function(e,n){var o={};if(n>=20){var r=function(t,e){for(var i=0,n=t-20;n<t;n++)i+=e[n].askVol-e[n].bidVol;return i/20}(n,t);o.color=r>=0?m:x,o.cumDelta=r}i.push(o)})),i}};function jt(t){return{open:t.open,high:t.high,low:t.low,close:t.close,volume:t.volume}}function Kt(t,e,i){for(var n=Number.MAX_VALUE,o=0,r=e;r>e-i;--r)r<0||r>=t.length||t[r]<n&&(n=t[r],o=r);return o}function Zt(t,e,i){for(var n=Number.MIN_VALUE,o=0,r=e;r>e-i;--r)r<0||r>=t.length||t[r]>n&&(n=t[r],o=r);return o}!function(t){t[t.Up=0]="Up",t[t.Down=1]="Down",t[t.Inisde=2]="Inisde",t[t.Outside=3]="Outside",t[t.None=4]="None"}(Ht||(Ht={})),function(t){t[t.None=0]="None",t[t.Up=1]="Up",t[t.Down=2]="Down"}(Xt||(Xt={})),function(t){t[t.Up=0]="Up",t[t.Down=1]="Down"}(Ut||(Ut={}));var qt=3e3,Qt=3001,$t=3002,Jt=3003;var te=-1;function ee(t,e){return t===e}function ie(t,e,i,n,o,r,a,s){if(e.value===Xt.None||e.value===Xt.Down){var l=void 0;l=0===n.length?te:n[n.length-1];var c=void 0;o.value===te?(c=Kt(s,t,t-20),o.value=t):(c=o.value,o.value=t),e.value=Xt.Up,ne(t,c,l,i,n,r,!1),i.push(c)}}function ne(t,e,i,n,o,r,a){e>i&&e!==te&&i!==te&&(oe(e,i,r),function(t,e,i,n,o,r){var a=0;if(i.length>2){var s=i.pop(),l=i[i.length-1];i.push(s);var c=jt(o[e]),u=jt(o[e-1]),h=jt(o[s]),d=o[s].totalDeltaVolume,p=o[l].totalDeltaVolume,g=o[e].totalDeltaVolume,v=e-n[n.length-1];if(n.length>2){var f=n.pop(),y=n[n.length-1];n.push(f);var m=o[f].totalDeltaVolume>o[y].totalDeltaVolume;g>d&&c.low>h.high&&m&&v>2&&(o[e].algo=3004,r||(o[t].marketStructure={swing:Xt.Up,confirmationBarIndex:t,previousSwingIndex:e}),a++)}c.low<h.low&&c.close>h.low&&c.close>u.close&&c.volume>u.volume&&(a>0?o[e].algo2=$t:o[e].algo=$t,r||(o[t].marketStructure={swing:Xt.Up,confirmationBarIndex:t,previousSwingIndex:e}),a++),g>d&&d>p&&v>2&&(a>0?o[e].algo2=qt:o[e].algo=qt,r||(o[t].marketStructure={swing:Xt.Up,confirmationBarIndex:t,previousSwingIndex:e}),a++)}}(t,e,n,o,r,a))}function oe(t,e,i){if(t>e&&t!==te&&e!==te){for(var n=0,o=0,r=0,a=e;a<=t;a++)n+=i[a].volume,o+=i[a].askVol,r+=i[a].bidVol;var s=o-r;i[t].totalVolume=n/1,i[t].totalDeltaVolume=s/1,i[t].textPosition=Ut.Down}}function re(t,e,i,n,o,r,a,s){if(e.value===Xt.None||e.value===Xt.Up){var l=void 0;l=0===n.length?te:n[n.length-1];var c=void 0;o.value===te?(c=Zt(a,t,t-20),o.value=t):(c=o.value,o.value=t),e.value=Xt.Down,ae(t,c,l,i,n,r,!1),i.push(c)}}function ae(t,e,i,n,o,r,a){e>i&&i!==te&&e!==te&&(se(e,i,r),function(t,e,i,n,o,r){var a=0;if(i.length>2){var s=i.pop(),l=i[i.length-1];i.push(s);var c=jt(o[e]),u=jt(o[e-1]),h=jt(o[s]),d=o[s].totalDeltaVolume,p=o[l].totalDeltaVolume,g=o[e].totalDeltaVolume,v=e-n[n.length-1];if(n.length>2){var f=n.pop(),y=n[n.length-1];n.push(f);var m=o[f].totalDeltaVolume<o[y].totalDeltaVolume;g<d&&c.high<h.low&&m&&v>2&&(o[e].algo=3005,r||(o[t].marketStructure={swing:Xt.Down,confirmationBarIndex:t,previousSwingIndex:e}),a++)}c.high>h.high&&c.close<h.high&&c.close<u.close&&c.volume>u.volume&&(a>0?o[e].algo2=Jt:o[e].algo=Jt,r||(o[t].marketStructure={swing:Xt.Down,confirmationBarIndex:t,previousSwingIndex:e}),a++),g<d&&d<p&&v>2&&(a>0?o[e].algo2=Qt:o[e].algo=Qt,r||(o[t].marketStructure={swing:Xt.Down,confirmationBarIndex:t,previousSwingIndex:e}),a++)}}(t,e,n,o,r,a))}function se(t,e,i){if(t>e&&e!==te&&t!==te){for(var n=0,o=0,r=0,a=e;a<=t;a++)n+=i[a].volume,o+=i[a].askVol,r+=i[a].bidVol;var s=o-r;i[t].totalVolume=n/1,i[t].totalDeltaVolume=s/1,i[t].textPosition=Ut.Up}}function le(t,e,i,n,o,r,a,s,l){var c=s[t]<s[n],u=a[t]-s[t],h=a[t-1]-s[t-1],d=jt(r[t]),p=jt(r[t-1]),g=t-i,v=t-n>o;if(c)return d.close<p.close&&v;var f=!1;if(0===h)return!1;if(g>4){var y=Kt(l,t,4),m=Kt(s,t,4);f=d.close<p.low&&y===t&&m===t&&(e===Ht.Down||e===Ht.Outside)}else if(g>=4){y=Kt(l,t,4*o),m=Kt(s,t,4*o);var x=u/h>=2,_=a[t-1]-.5*h,S=a[t]<_;f=y===t&&(e===Ht.Down||e===Ht.Outside)&&x&&S&&m===t}return f}function ce(t,e,i,n,o,r,a,s,l){var c=a[t]>a[n],u=t-i,h=a[t]-s[t],d=a[t-1]-s[t-1],p=jt(r[t]),g=jt(r[t-1]),v=t-n>o;if(c)return p.close>g.close&&v;var f=!1;if(0===d)return!1;if(u>4){var y=Zt(l,t,4),m=Zt(a,t,4),x=h/d>=1;f=p.close>g.high&&y===t&&m===t&&(e===Ht.Up||e===Ht.Outside)&&x}else if(u>=4){y=Zt(l,t,4*o),m=Zt(a,t,4*o),x=h/d>=2;var _=s[t-1]+.5*d,S=s[t]>_;f=y===t&&(e===Ht.Up||e===Ht.Outside)&&x&&S&&m===t}return f}function ue(t,e){return t.high>e.high?t.low<e.low?Ht.Outside:Ht.Up:t.low<e.low?Ht.Down:Ht.Inisde}function he(t,e,i){for(var n=e;n>i;n--)t[n].totalVolume=void 0,t[n].totalDeltaVolume=void 0,t[n].textPosition=void 0,t[n].algo=void 0,t[n].algo2=void 0}function de(t,e,i,n,o,r){if(e.value===Xt.Up){var a=te,s=void 0;0!==n.length?s=a=n[n.length-1]:(a=20,s=te),he(r,t,a),r[t].high>r[o.value].high||t===o.value||o.value===s?(r[t].high,o.value=t,se(o.value,s,r)):(r[o.value].high,ae(t,o.value,s,i,n,r,!0))}else if(e.value===Xt.Down){a=te;var l=void 0;0!==i.length?l=a=i[i.length-1]:(a=20,l=te),he(r,t,a),r[t].low<r[o.value].low||t===o.value||o.value===l?(r[t].low,o.value=t,oe(o.value,l,r)):(r[o.value].low,ne(t,o.value,l,n,i,r,!0))}}var pe=function(t){this.value=t},ge=function(t){this.value=t};function ve(t,e,i,n,o){for(var r=o.swingReversal,a=te,s=Ht.None,l=0,c=new pe(Xt.None),u=new ge(te),h=[],d=[],p=0;p<t.length;p++)if(!(p<20)){var g=jt(t[p]),v=jt(t[p-1]),f=ue(g,v);if(de(p,c,h,d,u,t),c.value===Xt.Up&&0!==d.length){var y=d[d.length-1];if(le(p,f,u.value,y,r,t,e,i,n)){a=p,s=Ht.Down,l=0,re(p,c,h,d,u,t,e);continue}}else if(c.value===Xt.Down&&0!=h.length){var m=h[h.length-1];if(ce(p,f,u.value,m,r,t,e,i,n)){a=p,s=Ht.Up,l=0,ie(p,c,d,h,u,t,0,i);continue}}if(f==Ht.Up){if(a===te){a=p,s=Ht.Up,l=1;continue}if(s===Ht.Down){c.value===Xt.Up?(g.high>=t[u.value].high||u.value===p)&&(a=p,s=Ht.Up,l=1):(a=p,s=Ht.Up,l=1);continue}var x=jt(t[a]);g.high>x.high&&(a=p,s=Ht.Up,ee(++l,r)&&ie(p,c,d,h,u,t,0,i))}else if(f==Ht.Down){if(a===te){s=Ht.Down,l=1,a=p;continue}if(s===Ht.Up){c.value===Xt.Down?(g.low<=t[u.value].low||u.value===p)&&(s=Ht.Down,l=1,a=p):(s=Ht.Down,l=1,a=p);continue}x=jt(t[a]);g.low<x.low&&(a=p,l++,s=Ht.Down,ee(l,r)&&re(p,c,h,d,u,t,e))}else if(f===Ht.Outside){if(g.close<=v.low){if(a==te){s=Ht.Down,l=1,a=p;continue}if(s==Ht.Down){x=jt(t[a]);g.low<x.low&&(a=p,s=Ht.Down,ee(++l,r)&&re(p,c,h,d,u,t,e))}else s==Ht.Up&&(s=Ht.Down,a=p,l=1);continue}if(g.close>=v.high){if(a==te){s=Ht.Up,l=1,a=p;continue}if(s==Ht.Up){x=jt(t[a]);g.high>x.high&&(a=p,s=Ht.Up,ee(++l,r)&&ie(p,c,d,h,u,t,0,i))}else s==Ht.Down&&(s=Ht.Up,a=p,l=1);continue}if(s==Ht.Up){x=jt(t[a]);g.high>x.high&&g.close>x.low&&u.value!==p&&(s=Ht.Up,a=p,ee(++l,r)&&ie(p,c,d,h,u,t,0,i))}else if(s==Ht.Down){x=jt(t[a]);g.low<x.low&&g.close<x.high&&u.value!==p&&(s=Ht.Down,a=p,ee(++l,r)&&re(p,c,h,d,u,t,e))}}}return t.map((function(e,i){var n={index:i.toString()};if(e.marketStructure)n.metaData=function(t,e){var i=t.marketStructure;if(i){var n=i.swing===Xt.Down?"SELL":"BUY",o=t.close,r=0;return i.swing===Xt.Down?r=e[i.previousSwingIndex].high:i.swing===Xt.Up&&(r=e[i.previousSwingIndex].low),{direction:n,entry:o,stoploss:r}}}(e,t);else if(void 0!==e.totalVolume&&void 0!==e.totalDeltaVolume){n.totalVolume=G(e.totalVolume),n.totalDeltaVolume=G(e.totalDeltaVolume),n.textPosition=e.textPosition;var o=fe(e.algo),r=fe(e.algo2);n.algo=o,n.secondAlgo=r}return n.high=e.high,n.low=e.low,n}))}function fe(t){if(void 0===t)return"";switch(t){case Qt:case qt:return"#";case $t:return"SP";case Jt:return"UT";case 3004:case 3005:return"PB";default:return""}}function ye(t){return{swingReversal:Number(t[0])||2,liteMode:Boolean(t[1])||!1}}function me(t,e,i,n){!function(t,e,i,n,o,r,a){void 0===a&&(a=4);var s="BUY"===r,l=e-n/2;t.beginPath(),t.moveTo(l+a,i),t.lineTo(l+n-a,i),t.quadraticCurveTo(l+n,i,l+n,i+a),t.lineTo(l+n,i+o-a),t.quadraticCurveTo(l+n,i+o,l+n-a,i+o),t.lineTo(l+a,i+o),t.quadraticCurveTo(l,i+o,l,i+o-a),t.lineTo(l,i+a),t.quadraticCurveTo(l,i,l+a,i),t.closePath(),t.fillStyle=s?"#00c853":"#d50000",t.fill(),t.fillStyle="white",t.font="bold 12px Arial",t.textAlign="center",t.textBaseline="middle",t.fillText(r,e,i+o/2)}(t,e,i,40,20,n)}var xe={name:"TWA",shortName:"TWave",isOverlay:!0,calcParams:[2,0],calc:function(t,e){var i=ye(e.calcParams),n=[],o=[],r=[],a=[];return t.forEach((function(t){var e={open:t.open,high:t.high,low:t.low,close:t.close,volume:t.volume,timestamp:t.timestamp,bidVol:t.bidVol,askVol:t.askVol};n.push(e),o.push(t.high),r.push(t.low),a.push(t.close)})),ve(n,o,r,a,i)},draw:function(t){var e=t.ctx;t.barSpace;var i=t.visibleRange,n=t.indicator,o=t.xAxis,r=t.yAxis,a=i.from,s=i.to,l=14;e.font="".concat(l,"px Helvetica Neue"),e.textAlign="center";for(var c=n.result,u=ye(n.calcParams),h=a;h<s;h++){var d=c[h],p=o.convertToPixel(h);if(d.totalVolume&&d.totalDeltaVolume){var g=r.convertToPixel(d.low),v=r.convertToPixel(d.high);if(d.textPosition===Ut.Up)if(u.liteMode&&(d.algo||d.secondAlgo))me(e,p,v-25,"SELL");else{e.fillStyle=m,d.totalDeltaVolume.includes("-")&&(e.fillStyle=x);var f=v-10-l;e.fillText(d.totalDeltaVolume.toString(),p,f),e.fillStyle=x,d.algo&&e.fillText(d.algo,p,f-15-l),d.secondAlgo&&e.fillText(d.secondAlgo,p,f-30-l)}else if(u.liteMode&&(d.algo||d.secondAlgo))me(e,p,g+5,"BUY");else{e.fillStyle=x,d.totalDeltaVolume.includes("-")||(e.fillStyle=m);f=g+10+l;e.fillText(d.totalDeltaVolume.toString(),p,f),e.fillStyle=m,d.algo&&e.fillText(d.algo,p,f+15+l),d.secondAlgo&&e.fillText(d.secondAlgo,p,f+30+l)}}}return!1}};var _e={name:"YEST",isOverlay:!0,calc:function(t){for(var e,i,n,o,r,a,s,l=[],c=0;c<t.length;c++){var u=t[c],h={};if(e=u.timestamp,0!==c){var d=t[c-1].timestamp;r=d,a=void 0,s=void 0,a=new Date(e),s=new Date(r),a.getDate()===s.getDate()&&a.getMonth()===s.getMonth()&&a.getFullYear()===s.getFullYear()?(u.high>i&&(i=u.high),u.low<n&&(n=u.low),o&&(h.high=o.high,h.low=o.low,h.newDay=!1)):(o={high:i,low:n},i=u.high,n=u.low,o&&(h.high=o.high,h.low=o.low,h.newDay=!0)),l.push(h)}else i=u.high,n=u.low,l.push(h)}return l},draw:function(t){var e=t.ctx,i=t.barSpace,n=t.visibleRange,o=t.indicator,r=t.xAxis,a=t.yAxis,s=n.from,l=n.to;e.font="12px Helvetica Neue",e.textAlign="left";for(var c=o.result,u=s;u<l;u++){var h=c[u],d=r.convertToPixel(u);e.fillStyle="#888888";var p=i.gapBar/2;if(h.high&&h.low){var g=a.convertToPixel(h.high);e.fillRect(d,g,i.bar-p,1);var v=a.convertToPixel(h.low);e.fillRect(d,v,i.bar-p,1),h.newDay&&(e.fillText("Yesterday Low",d,v+15),e.fillText("Yesterday High",d,g-5))}}return!1}},Se={name:"VWAP",shortName:"VWAP",series:t.IndicatorSeries.Price,shouldOhlc:!0,isOverlay:!0,calcParams:[3],figures:[{key:"vwap",title:"VWAP: ",type:"line"},{key:"vwap1U",type:"line"},{key:"vwap1L",type:"line"},{key:"vwap2U",type:"line"},{key:"vwap2L",type:"line"},{key:"vwap3U",type:"line"},{key:"vwap3L",type:"line"}],calc:function(t,e){var i,n,o,r=[],a=e.calcParams[0];return t.forEach((function(t){var e={},s=(t.high+t.low+t.close)/3;t.isStartOfSession?(i=t.volume,n=t.volume*s,o=t.volume*s*s):(i+=t.volume,n+=t.volume*s,o+=t.volume*s*s);var l=n/i,c=Math.sqrt(Math.max(o/i-l*l,0));e.vwap=l,a>=1&&(e.vwap1U=l+1.28*c,e.vwap1L=l-1.28*c),a>=2&&(e.vwap2U=l+2.01*c,e.vwap2L=l-2.01*c),a>=3&&(e.vwap3U=l+2.51*c,e.vwap3L=l-2.51*c),r.push(e)})),r}};var we="#ffce55";function be(t,e,i,n,o,r){t.beginPath(),"UP"===o?(t.moveTo(e,i),t.lineTo(e-n,i+n),t.lineTo(e+n,i+n)):(t.moveTo(e,i),t.lineTo(e-n,i-n),t.lineTo(e+n,i-n)),t.closePath(),t.fillStyle=r,t.fill()}var Te={},Ce=[bt,{name:"BIAS",shortName:"BIAS",calcParams:[6,12,24],figures:[{key:"bias1",title:"BIAS6: ",type:"line"},{key:"bias2",title:"BIAS12: ",type:"line"},{key:"bias3",title:"BIAS24: ",type:"line"}],regenerateFigures:function(t){return t.map((function(t,e){return{key:"bias".concat(e+1),title:"BIAS".concat(t,": "),type:"line"}}))},calc:function(t,e){var i=e.calcParams,n=e.figures,o=[];return t.map((function(e,r){var a={},s=e.close;return i.forEach((function(e,l){var c;if(o[l]=(null!==(c=o[l])&&void 0!==c?c:0)+s,r>=e-1){var u=o[l]/i[l];a[n[l].key]=(s-u)/u*100,o[l]-=t[r-(e-1)].close}})),a}))}},Tt,{name:"BRAR",shortName:"BRAR",calcParams:[26],figures:[{key:"br",title:"BR: ",type:"line"},{key:"ar",title:"AR: ",type:"line"}],calc:function(t,e){var i=e.calcParams,n=0,o=0,r=0,a=0;return t.map((function(e,s){var l,c,u={},h=e.high,d=e.low,p=e.open,g=(null!==(l=t[s-1])&&void 0!==l?l:e).close;if(r+=h-p,a+=p-d,n+=h-g,o+=g-d,s>=i[0]-1){u.ar=0!==a?r/a*100:0,u.br=0!==o?n/o*100:0;var v=t[s-(i[0]-1)],f=v.high,y=v.low,m=v.open,x=(null!==(c=t[s-i[0]])&&void 0!==c?c:t[s-(i[0]-1)]).close;n-=f-x,o-=x-y,r-=f-m,a-=m-y}return u}))}},Ct,Pt,It,Dt,Et,{name:"EMV",shortName:"EMV",calcParams:[14,9],figures:[{key:"emv",title:"EMV: ",type:"line"},{key:"maEmv",title:"MAEMV: ",type:"line"}],calc:function(t,e){var i=e.calcParams,n=0,o=[];return t.map((function(e,r){var a,s={};if(r>0){var l=t[r-1],c=e.high,u=e.low,h=null!==(a=e.volume)&&void 0!==a?a:0,d=(c+u)/2-(l.high+l.low)/2;if(0===h||c-u==0)s.emv=0;else{var p=h/1e8/(c-u);s.emv=d/p}n+=s.emv,o.push(s.emv),r>=i[0]&&(s.maEmv=n/i[0],n-=o[r-i[0]])}return s}))}},Mt,{name:"MTM",shortName:"MTM",calcParams:[12,6],figures:[{key:"mtm",title:"MTM: ",type:"line"},{key:"maMtm",title:"MAMTM: ",type:"line"}],calc:function(t,e){var i=e.calcParams,n=0,o=[];return t.forEach((function(e,r){var a,s={};if(r>=i[0]){var l=e.close,c=t[r-i[0]].close;s.mtm=l-c,n+=s.mtm,r>=i[0]+i[1]-1&&(s.maMtm=n/i[1],n-=null!==(a=o[r-(i[1]-1)].mtm)&&void 0!==a?a:0)}o.push(s)})),o}},kt,At,{name:"OBV",shortName:"OBV",calcParams:[30],figures:[{key:"obv",title:"OBV: ",type:"line"},{key:"maObv",title:"MAOBV: ",type:"line"}],calc:function(t,e){var i=e.calcParams,n=0,o=0,r=[];return t.forEach((function(e,a){var s,l,c,u,h=null!==(s=t[a-1])&&void 0!==s?s:e;e.close<h.close?o-=null!==(l=e.volume)&&void 0!==l?l:0:e.close>h.close&&(o+=null!==(c=e.volume)&&void 0!==c?c:0);var d={obv:o};n+=o,a>=i[0]-1&&(d.maObv=n/i[0],n-=null!==(u=r[a-(i[0]-1)].obv)&&void 0!==u?u:0),r.push(d)})),r}},{name:"PVT",shortName:"PVT",figures:[{key:"pvt",title:"PVT: ",type:"line"}],calc:function(t){var e=0;return t.map((function(i,n){var o,r,a={},s=i.close,l=null!==(o=i.volume)&&void 0!==o?o:1,c=(null!==(r=t[n-1])&&void 0!==r?r:i).close,u=0,h=c*l;return 0!==h&&(u=(s-c)/h),e+=u,a.pvt=e,a}))}},{name:"PSY",shortName:"PSY",calcParams:[12,6],figures:[{key:"psy",title:"PSY: ",type:"line"},{key:"maPsy",title:"MAPSY: ",type:"line"}],calc:function(t,e){var i=e.calcParams,n=0,o=0,r=[],a=[];return t.forEach((function(e,s){var l,c,u={},h=(null!==(l=t[s-1])&&void 0!==l?l:e).close,d=e.close-h>0?1:0;r.push(d),n+=d,s>=i[0]-1&&(u.psy=n/i[0]*100,o+=u.psy,s>=i[0]+i[1]-2&&(u.maPsy=o/i[1],o-=null!==(c=a[s-(i[1]-1)].psy)&&void 0!==c?c:0),n-=r[s-(i[0]-1)]),a.push(u)})),a}},{name:"ROC",shortName:"ROC",calcParams:[12,6],figures:[{key:"roc",title:"ROC: ",type:"line"},{key:"maRoc",title:"MAROC: ",type:"line"}],calc:function(t,e){var i=e.calcParams,n=[],o=0;return t.forEach((function(e,r){var a,s,l={};if(r>=i[0]-1){var c=e.close,u=(null!==(a=t[r-i[0]])&&void 0!==a?a:t[r-(i[0]-1)]).close;l.roc=0!==u?(c-u)/u*100:0,o+=l.roc,r>=i[0]-1+i[1]-1&&(l.maRoc=o/i[1],o-=null!==(s=n[r-(i[1]-1)].roc)&&void 0!==s?s:0)}n.push(l)})),n}},Ft,Lt,Bt,Rt,{name:"TRIX",shortName:"TRIX",calcParams:[12,9],figures:[{key:"trix",title:"TRIX: ",type:"line"},{key:"maTrix",title:"MATRIX: ",type:"line"}],calc:function(t,e){var i,n,o,r=e.calcParams,a=0,s=0,l=0,c=0,u=[];return t.forEach((function(t,e){var h,d={},p=t.close;if(a+=p,e>=r[0]-1&&(i=e>r[0]-1?(2*p+(r[0]-1)*i)/(r[0]+1):a/r[0],s+=i,e>=2*r[0]-2&&(n=e>2*r[0]-2?(2*i+(r[0]-1)*n)/(r[0]+1):s/r[0],l+=n,e>=3*r[0]-3))){var g=void 0,v=0;e>3*r[0]-3?v=((g=(2*n+(r[0]-1)*o)/(r[0]+1))-o)/o*100:g=l/r[0],o=g,d.trix=v,c+=v,e>=3*r[0]+r[1]-4&&(d.maTrix=c/r[1],c-=null!==(h=u[e-(r[1]-1)].trix)&&void 0!==h?h:0)}u.push(d)})),u}},Vt,{name:"VR",shortName:"VR",calcParams:[26,6],figures:[{key:"vr",title:"VR: ",type:"line"},{key:"maVr",title:"MAVR: ",type:"line"}],calc:function(t,e){var i=e.calcParams,n=0,o=0,r=0,a=0,s=[];return t.forEach((function(e,l){var c,u,h,d,p,g={},v=e.close,f=(null!==(c=t[l-1])&&void 0!==c?c:e).close,y=null!==(u=e.volume)&&void 0!==u?u:0;if(v>f?n+=y:v<f?o+=y:r+=y,l>=i[0]-1){var m=r/2;g.vr=o+m===0?0:(n+m)/(o+m)*100,a+=g.vr,l>=i[0]+i[1]-2&&(g.maVr=a/i[1],a-=null!==(h=s[l-(i[1]-1)].vr)&&void 0!==h?h:0);var x=t[l-(i[0]-1)],_=null!==(d=t[l-i[0]])&&void 0!==d?d:x,S=x.close,w=null!==(p=x.volume)&&void 0!==p?p:0;S>_.close?n-=w:S<_.close?o-=w:r-=w}s.push(g)})),s}},Ot,Nt,Wt,zt,Yt,Gt,xe,_e,Se,{name:"ATR",shortName:"ATR",precision:2,calcParams:[14],figures:[{key:"atr",title:"ATR: ",type:"line"}],calc:function(t,e){for(var i=[],n=e.calcParams[0],o=0;o<t.length;o++){var r={};if(o<n)i.push(r);else{for(var a=0,s=0;s<n;s++){a+=Math.max(t[o-s].high-t[o-s].low,Math.abs(t[o-s].high-t[o-s-1].close),Math.abs(t[o-s].low-t[o-s-1].close))}r.atr=a/n,i.push(r)}}return i}},{name:"QUA",shortName:"Quarter",isOverlay:!0,calc:function(t,e,i){return t.map((function(t){var e,i,n=(e=new Date(t.timestamp),(i=e.getMonth())>=0&&i<=2?1:i>=3&&i<=5?2:i>=6&&i<=8?3:4),o=function(t){return 1==t?"rgba(40,174,40,0.2)":2==t?"rgba(243,80,80,0.2)":3==t?"rgba(255,206,85,0.2)":"rgba(55,96,255,0.2)"}(n),r={};return r.color=o,r.index=n,r}))},draw:function(t){var e=t.ctx,i=t.barSpace,n=t.visibleRange,o=t.indicator,r=t.xAxis;t.yAxis;for(var a=n.from,s=n.to,l=o.result,c=a;c<s;c++){var u=l[c],h=r.convertToPixel(c);e.fillStyle=u.color,e.fillRect(h-i.bar/2,0,i.bar,e.canvas.height)}return!1}},{name:"POS",shortName:"PositionMarker",isOverlay:!0,calcParams:[],calc:function(t,e){for(var i=[],n=0;n<t.length;n++){var o=t[n],r={};o.tradeEntry?(r.price=o.tradeEntry.entryPrice,r.direction=o.tradeEntry.direction,o.tradeEntry.direction,r.color=we,r.status="OPEN",i.push(r)):o.tradeExit?(r.price=o.tradeExit.exitPrice,r.direction=o.tradeExit.direction,r.status="CLOSE","WIN"===o.tradeExit.result?r.color="#04cf58":r.color="#ea21ff",i.push(r)):i.push(r)}return i},draw:function(t){for(var e=t.ctx,i=t.xAxis,n=t.yAxis,o=t.visibleRange,r=t.indicator,a=o.from,s=o.to,l=r.result,c=a;c<s;c++){var u=l[c];if(u.price&&u.color&&u.direction&&u.status){var h=i.convertToPixel(c),d=n.convertToPixel(u.price),p=void 0,g=void 0;"OPEN"===u.status?"BUY"===u.direction?(p=6,g="UP"):(p=-6,g="DOWN"):"BUY"===u.direction?(p=-6,g="DOWN"):(p=6,g="UP"),be(e,h,d+p,8,g,u.color)}}return!1}}],Pe={AVP:"Average Price",AO:"Awesome Oscillator",BIAS:"Bias",BOLL:"Bollinger Bands",BRAR:"BRAR",BBI:"Bull and Bear Index",CCI:"Commodity Channel Index",CR:"Current Ratio",DMA:"Different of Moving Average",DMI:"Directional Movement Index",EMV:"Ease of Movement Value",EMA:"Exponential Moving Average",MTM:"Momentum",MA:"Moving Average",MACD:"Moving Average Convergence Divergence",OBV:"On Balance Volume",PVT:"Price and Volume Trend",PSY:"Psychological Line",ROC:"Rate of Change",RSI:"Relative Strength Index",SMA:"Simple Moving Average",KDJ:"Stochastic Oscillator",SAR:"Stop and Reverse",TRIX:"Triple Exponentially Smoothed Average",VOL:"Volume",VR:"Volume Ratio",WR:"Williams %R",TW:"TWave Histogram",TB:"TBlock Histogram",TPA:"TPace",TBA:"TSupply Demand Oscillator",TCD:"TCumulative Delta",TWA:"TWave",YEST:"Yesterday Low",VWAP:"VWAP",ATR:"Average True Range",QUA:"Quarter Session",POS:"Position Marker"};function Ie(t){var e;return null!==(e=Te[t])&&void 0!==e?e:null}Ce.forEach((function(t){Te[t.name]=it.extend(t)}));var De=function(){function e(t){this._instances=new Map,this._chartStore=t}return e.prototype._overrideInstance=function(t,e){var i=e.shortName,n=e.series,o=e.calcParams,r=e.precision,a=e.figures,s=e.minValue,l=e.maxValue,c=e.shouldOhlc,u=e.shouldFormatBigNumber,h=e.visible,d=e.zLevel,p=e.styles,g=e.extendData,v=e.regenerateFigures,f=e.createTooltipDataSource,y=e.draw,m=e.calc;e.alertCallback;var x=!1;O(i)&&t.setShortName(i)&&(x=!0),R(n)&&t.setSeries(n)&&(x=!0);var _=!1;A(o)&&t.setCalcParams(o)&&(x=!0,_=!0),A(a)&&t.setFigures(a)&&(x=!0,_=!0),void 0!==s&&t.setMinValue(s)&&(x=!0),void 0!==l&&t.setMinValue(l)&&(x=!0),B(r)&&t.setPrecision(r)&&(x=!0),V(c)&&t.setShouldOhlc(c)&&(x=!0),V(u)&&t.setShouldFormatBigNumber(u)&&(x=!0),V(h)&&t.setVisible(h)&&(x=!0);var S=!1;return B(d)&&t.setZLevel(d)&&(x=!0,S=!0),R(p)&&t.setStyles(p)&&(x=!0),void 0!==g&&t.setExtendData(g)&&(x=!0,_=!0),void 0!==v&&t.setRegenerateFigures(v)&&(x=!0),void 0!==f&&t.setCreateTooltipDataSource(f)&&(x=!0),void 0!==y&&t.setDraw(y)&&(x=!0),F(m)&&(t.calc=m,_=!0),[x,_,S]},e.prototype._sort=function(t){var e;O(t)?null===(e=this._instances.get(t))||void 0===e||e.sort((function(t,e){return t.zLevel-e.zLevel})):this._instances.forEach((function(t){t.sort((function(t,e){return t.zLevel-e.zLevel}))}))},e.prototype.addInstance=function(t,e,i){return o(this,void 0,void 0,(function(){var n,o,a,s;return r(this,(function(r){switch(r.label){case 0:return n=t.name,R(o=this._instances.get(e))&&R(o.find((function(t){return t.name===n})))?[2,Promise.reject(new Error("Duplicate indicators."))]:(R(o)||(o=[]),a=Ie(n),s=new a,this.synchronizeSeriesPrecision(s),this._overrideInstance(s,t),i||(o=[]),o.push(s),this._instances.set(e,o),this._sort(e),[4,s.calcIndicator(this._chartStore.getDataList())]);case 1:return[2,r.sent()]}}))}))},e.prototype.getInstances=function(t){var e;return null!==(e=this._instances.get(t))&&void 0!==e?e:[]},e.prototype.removeInstance=function(t,e){var i,n=!1,o=this._instances.get(t);if(R(o)){if(O(e)){var r=o.findIndex((function(t){return t.name===e}));r>-1&&(o.splice(r,1),n=!0)}else this._instances.set(t,[]),n=!0;0===(null===(i=this._instances.get(t))||void 0===i?void 0:i.length)&&this._instances.delete(t)}return n},e.prototype.hasInstances=function(t){return this._instances.has(t)},e.prototype.calcInstance=function(t,e){return o(this,void 0,void 0,(function(){var i,n,o,a=this;return r(this,(function(r){switch(r.label){case 0:return i=[],O(t)?O(e)?R(n=this._instances.get(e))&&R(o=n.find((function(e){return e.name===t})))&&i.push(o.calcIndicator(this._chartStore.getDataList())):this._instances.forEach((function(e){var n=e.find((function(e){return e.name===t}));R(n)&&i.push(n.calcIndicator(a._chartStore.getDataList()))})):this._instances.forEach((function(t){t.forEach((function(t){i.push(t.calcIndicator(a._chartStore.getDataList()))}))})),[4,Promise.all(i)];case 1:return[2,r.sent().includes(!0)]}}))}))},e.prototype.getInstanceByPaneId=function(t,e){var i,n,o=function(t){var e=new Map;return t.forEach((function(t){e.set(t.name,t)})),e};if(O(t)){var r=null!==(i=this._instances.get(t))&&void 0!==i?i:[];return O(e)?null!==(n=null==r?void 0:r.find((function(t){return t.name===e})))&&void 0!==n?n:null:o(r)}var a=new Map;return this._instances.forEach((function(t,e){a.set(e,o(t))})),a},e.prototype.synchronizeSeriesPrecision=function(e){var i=this._chartStore.getPrecision(),n=i.price,o=i.volume,r=function(e){switch(e.series){case t.IndicatorSeries.Price:e.setPrecision(n,!0);break;case t.IndicatorSeries.Volume:e.setPrecision(o,!0)}};R(e)?r(e):this._instances.forEach((function(t){t.forEach((function(t){r(t)}))}))},e.prototype.override=function(t,e){return o(this,void 0,void 0,(function(){var i,n,o,a,s,l,c,u=this;return r(this,(function(r){switch(r.label){case 0:return i=t.name,n=new Map,null!==e?R(o=this._instances.get(e))&&n.set(e,o):n=this._instances,a=!1,s=[],l=!1,n.forEach((function(e){var n=e.find((function(t){return t.name===i}));if(R(n)){var o=u._overrideInstance(n,t);o[2]&&(l=!0),o[1]?s.push(n.calcIndicator(u._chartStore.getDataList())):o[0]&&(a=!0)}})),l&&this._sort(),[4,Promise.all(s)];case 1:return c=r.sent(),[2,[a,c.includes(!0)]]}}))}))},e}(),Ee=function(){function t(t){this._crosshair={},this._activeIcon=null,this._chartStore=t}return t.prototype.setCrosshair=function(t,e){var i,o,r=this._chartStore.getDataList(),a=null!=t?t:{},s=r[o=B(a.x)?(i=this._chartStore.getTimeScaleStore().coordinateToDataIndex(a.x))<0?0:i>r.length-1?r.length-1:i:i=r.length-1],l=this._chartStore.getTimeScaleStore().dataIndexToCoordinate(i),c=this._crosshair.x,u=this._crosshair.y,h=this._crosshair.paneId;this._crosshair=n(n({},a),{realX:l,kLineData:s,realDataIndex:i,dataIndex:o}),c===a.x&&u===a.y&&h===a.paneId||(null!==s&&this._chartStore.getChart().crosshairChange(this._crosshair),null!=e&&e||this._chartStore.getChart().updatePane(1))},t.prototype.recalculateCrosshair=function(t){this.setCrosshair(this._crosshair,t)},t.prototype.getCrosshair=function(){return this._crosshair},t.prototype.setActiveIcon=function(t){this._activeIcon=null!=t?t:null},t.prototype.getActiveIcon=function(){return this._activeIcon},t.prototype.clear=function(){this.setCrosshair({},!0),this.setActiveIcon()},t}(),Me={name:"ruler",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:function(t){var e=t.coordinates,i=t.overlay,n=[];if(e.length>1){var o=i.points,r=(e[1].x+e[0].x)/2,a=o[1].value-o[0].value,s=o[1].dataIndex-o[0].dataIndex,l=a/o[0].value,c=e[1].y,u=void 0;return u=a>0?"rgb(6, 122, 180, 0.3)":"rgb(210, 56, 48, 0.3)",n.push({x:r,y:c,text:"".concat((100*l).toFixed(1),"% ").concat(s," bars"),baseline:"bottom"}),[{type:"polygon",attrs:{coordinates:[e[0],{x:e[1].x,y:e[0].y},e[1],{x:e[0].x,y:e[1].y}]},styles:{color:u,style:"stroke_fill"}},{type:"text",ignoreEvent:!0,attrs:n}]}return[]}},ke=function(){function t(){this._children=[],this._callbacks=new Map}return t.prototype.registerEvent=function(t,e){return this._callbacks.set(t,e),this},t.prototype.onEvent=function(t,e,i){var n=this._callbacks.get(t);return!(!R(n)||!this.checkEventOn(e))&&n(e,i)},t.prototype.checkEventOn=function(t){var e,i;try{for(var n=a(this._children),o=n.next();!o.done;o=n.next()){if(o.value.checkEventOn(t))return!0}}catch(t){e={error:t}}finally{try{o&&!o.done&&(i=n.return)&&i.call(n)}finally{if(e)throw e.error}}return!1},t.prototype.dispatchEvent=function(t,e,i){var n=this._children.length-1;if(n>-1)for(var o=n;o>-1;o--)if(this._children[o].dispatchEvent(t,e,i))return!0;return this.onEvent(t,e,i)},t.prototype.addChild=function(t){return this._children.push(t),this},t.prototype.clear=function(){this._children=[]},t}(),Ae=function(t){function e(e){var i=t.call(this)||this;return i.attrs=e.attrs,i.styles=e.styles,i}return i(e,t),e.prototype.checkEventOn=function(t){return this.checkEventOnImp(t,this.attrs,this.styles)},e.prototype.setAttrs=function(t){return this.attrs=t,this},e.prototype.setStyles=function(t){return this.styles=t,this},e.prototype.draw=function(t){this.drawImp(t,this.attrs,this.styles)},e.extend=function(t){var n=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return i(n,e),n.prototype.checkEventOnImp=function(e,i,n){return t.checkEventOn(e,i,n)},n.prototype.drawImp=function(e,i,n){t.draw(e,i,n)},n}(e);return n},e}(ke);function Fe(t,e){var i=[];i=i.concat(e);for(var n=0;n<i.length;n++){var o=i[n].coordinates;if(o.length>1)for(var r=1;r<o.length;r++){var a=o[r-1],s=o[r];if(a.x===s.x){if(Math.abs(a.y-t.y)+Math.abs(s.y-t.y)-Math.abs(a.y-s.y)<4&&Math.abs(t.x-a.x)<2)return!0}else{var l=Re(a,s),c=Le(l,t),u=Math.abs(c-t.y);if(Math.abs(a.x-t.x)+Math.abs(s.x-t.x)-Math.abs(a.x-s.x)<4&&u*u/(l[0]*l[0]+1)<4)return!0}}}return!1}function Le(t,e){return null!==t?e.x*t[0]+t[1]:e.y}function Be(t,e,i){return Le(Re(t,e),i)}function Re(t,e){var i=t.x-e.x;if(0!==i){var n=(t.y-e.y)/i;return[n,t.y-n*t.x]}return null}function Ve(t,e,i){var n=e.length,o=B(i)?i>0&&i<1?i:0:i?.5:0;if(o>0&&n>2){for(var r=e[0].x,a=e[0].y,s=1;s<n-1;s++){var l=e[s-1],c=e[s],u=e[s+1],h=c.x-l.x,d=c.y-l.y,p=u.x-c.x,g=u.y-c.y,v=u.x-l.x,f=u.y-l.y,y=Math.sqrt(h*h+d*d),m=Math.sqrt(p*p+g*g),x=m/(m+y),_=c.x+v*o*x,S=c.y+f*o*x;_=Math.min(_,Math.max(u.x,c.x)),S=Math.min(S,Math.max(u.y,c.y)),_=Math.max(_,Math.min(u.x,c.x)),S=Math.max(S,Math.min(u.y,c.y)),v=_-c.x,f=S-c.y;var w=c.x-v*y/m,b=c.y-f*y/m;w=Math.min(w,Math.max(l.x,c.x)),b=Math.min(b,Math.max(l.y,c.y)),w=Math.max(w,Math.min(l.x,c.x)),b=Math.max(b,Math.min(l.y,c.y)),v=c.x-w,f=c.y-b,_=c.x+v*m/y,S=c.y+f*m/y,t.bezierCurveTo(r,a,w,b,c.x,c.y),r=_,a=S}var T=e[n-1];t.bezierCurveTo(r,a,T.x,T.y,T.x,T.y)}else for(s=1;s<n;s++)t.lineTo(e[s].x,e[s].y)}function Oe(e,i,n){var o=[];o=o.concat(i);var r=n.style,a=void 0===r?t.LineType.Solid:r,s=n.smooth,l=void 0!==s&&s,c=n.size,u=void 0===c?1:c,h=n.color,d=void 0===h?"currentColor":h,p=n.dashedValue,g=void 0===p?[2,2]:p;e.lineWidth=u,e.strokeStyle=d,a===t.LineType.Dashed?e.setLineDash(g):e.setLineDash([]),o.forEach((function(t){var i=t.coordinates;i.length>1&&(e.beginPath(),e.moveTo(i[0].x,i[0].y),Ve(e,i,l),e.stroke(),e.closePath())}))}var Ne={name:"line",checkEventOn:Fe,draw:function(t,e,i){Oe(t,e,i)}};function We(t,e,i){var n=null!=i?i:0,o=[];if(t.length>1)if(t[0].x===t[1].x){var r=e.height;if(o.push({coordinates:[{x:t[0].x,y:0},{x:t[0].x,y:r}]}),t.length>2){o.push({coordinates:[{x:t[2].x,y:0},{x:t[2].x,y:r}]});for(var a=t[0].x-t[2].x,s=0;s<n;s++){var l=a*(s+1);o.push({coordinates:[{x:t[0].x+l,y:0},{x:t[0].x+l,y:r}]})}}}else{var c=t[0].x,u=0,h=Re(t[0],t[1]),d=h[0],p=h[1];if(t.length>1&&(u=t[1].x,o.push({coordinates:[{x:c,y:c*d+p},{x:u,y:u*d+p}]})),t.length>2){var g=t[2].y-d*t[2].x;o.push({coordinates:[{x:c,y:c*d+g},{x:u,y:u*d+g}]});for(a=p-g,s=0;s<n;s++){var v=p+a*(s+1);o.push({coordinates:[{x:c,y:c*d+v},{x:u,y:u*d+v}]})}}}return o}var ze={name:"parallelStraightLine",totalStep:4,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:function(t){return[{type:"line",attrs:We(t.coordinates,t.bounding)}]}},Ye={name:"priceChannelLine",totalStep:4,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:function(t){return[{type:"line",attrs:We(t.coordinates,t.bounding,1)}]}},He={name:"priceLine",totalStep:2,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:function(t){var e,i=t.coordinates,n=t.bounding,o=t.precision,r=t.overlay,a=t.thousandsSeparator,s=t.decimalFoldThreshold,l=t.yAxis,c=r.points[0].value,u=void 0===c?0:c,h=null===(e=null==l?void 0:l.isInCandle())||void 0===e||e?o.price:o.excludePriceVolumeMax;return[{type:"line",attrs:{coordinates:[i[0],{x:n.width,y:i[0].y}]}},{type:"text",ignoreEvent:!0,attrs:{x:i[0].x,y:i[0].y,text:K(j(u.toFixed(h),a),s),baseline:"bottom"}}]}};function Xe(t,e){if(t.length>1){var i=void 0;return i=t[0].x===t[1].x&&t[0].y!==t[1].y?t[0].y<t[1].y?{x:t[0].x,y:e.height}:{x:t[0].x,y:0}:t[0].x>t[1].x?{x:0,y:Be(t[0],t[1],{x:0,y:t[0].y})}:{x:e.width,y:Be(t[0],t[1],{x:e.width,y:t[0].y})},{coordinates:[t[0],i]}}return[]}var Ue={name:"rayLine",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:function(t){return[{type:"line",attrs:Xe(t.coordinates,t.bounding)}]}},Ge={name:"straightLine",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:function(t){var e=t.coordinates,i=t.bounding;return 2===e.length?e[0].x===e[1].x?[{type:"line",attrs:{coordinates:[{x:e[0].x,y:0},{x:e[0].x,y:i.height}]}}]:[{type:"line",attrs:{coordinates:[{x:0,y:Be(e[0],e[1],{x:0,y:e[0].y})},{x:i.width,y:Be(e[0],e[1],{x:i.width,y:e[0].y})}]}}]:[]}},je={name:"simpleAnnotation",totalStep:2,styles:{line:{style:t.LineType.Dashed}},createPointFigures:function(t){var e,i,n=t.overlay,o=t.coordinates;R(n.extendData)&&(i=F(n.extendData)?n.extendData(n):null!==(e=n.extendData)&&void 0!==e?e:"");var r=o[0].x,a=o[0].y-6,s=a-50,l=s-5;return[{type:"line",attrs:{coordinates:[{x:r,y:a},{x:r,y:s}]},ignoreEvent:!0},{type:"polygon",attrs:{coordinates:[{x:r,y:s},{x:r-4,y:l},{x:r+4,y:l}]},ignoreEvent:!0},{type:"text",attrs:{x:r,y:l,text:null!=i?i:"",align:"center",baseline:"bottom"},ignoreEvent:!0}]}},Ke={name:"simpleTag",totalStep:2,styles:{line:{style:t.LineType.Dashed}},createPointFigures:function(t){var e=t.bounding,i=t.coordinates;return{type:"line",attrs:{coordinates:[{x:0,y:i[0].y},{x:e.width,y:i[0].y}]},ignoreEvent:!0}},createYAxisFigures:function(t){var e,i,n,o,r,a=t.overlay,s=t.coordinates,l=t.bounding,c=t.yAxis,u=t.precision;return null!==(e=null==c?void 0:c.isFromZero())&&void 0!==e&&e?(n="left",o=0):(n="right",o=l.width),R(a.extendData)&&(r=F(a.extendData)?a.extendData(a):null!==(i=a.extendData)&&void 0!==i?i:""),!R(r)&&B(a.points[0].value)&&(r=U(a.points[0].value,u.price)),{type:"text",attrs:{x:o,y:s[0].y,text:null!=r?r:"",align:n,baseline:"middle"}}}};function Ze(t,e,i){return{x:(t.x-e.x)*Math.cos(i)-(t.y-e.y)*Math.sin(i)+e.x,y:(t.x-e.x)*Math.sin(i)+(t.y-e.y)*Math.cos(i)+e.y}}function qe(t,e){var i=Math.abs(t.x-e.x),n=Math.abs(t.y-e.y);return Math.sqrt(i*i+n*n)}var Qe={name:"arrow",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:function(t){var e=t.coordinates;if(e.length>1){var i=e[1].x>e[0].x?0:1,n=Re(e[0],e[1]),o=void 0;o=n?Math.atan(n[0])+Math.PI*i:e[1].y>e[0].y?Math.PI/2:Math.PI/2*3;var r=Ze({x:e[1].x-8,y:e[1].y+4},e[1],o),a=Ze({x:e[1].x-8,y:e[1].y-4},e[1],o);return[{type:"line",attrs:{coordinates:e}},{type:"line",ignoreEvent:!0,attrs:{coordinates:[r,e[1],a]}}]}return[]}},$e={name:"circle",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,styles:{circle:{color:"rgba(22, 119, 255, 0.15)"}},createPointFigures:function(t){var e=t.coordinates;if(e.length>1){var i=qe(e[0],e[1]);return{type:"circle",attrs:n(n({},e[0]),{r:i}),styles:{style:"stroke_fill"}}}return[]}},Je={name:"fibonacciCircle",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:function(t){var e=t.coordinates;if(e.length>1){var i=Math.abs(e[0].x-e[1].x),o=Math.abs(e[0].y-e[1].y),r=Math.sqrt(i*i+o*o),a=[],s=[];return[.236,.382,.5,.618,.786,1].forEach((function(t){var i=r*t;a.push(n(n({},e[0]),{r:i})),s.push({x:e[0].x,y:e[0].y+i+6,text:"".concat((100*t).toFixed(1),"%")})})),[{type:"circle",attrs:a,styles:{style:"stroke"}},{type:"text",ignoreEvent:!0,attrs:s}]}return[]}},ti={name:"fibonacciSpiral",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:function(t){var e=t.coordinates,i=t.bounding;if(e.length>1){var o=qe(e[0],e[1])/Math.sqrt(24),r=e[1].x>e[0].x?0:1,a=zn.getLinearSlopeIntercept(e[0],e[1]),s=void 0;s=a?Math.atan(a[0])+Math.PI*r:e[1].y>e[0].y?Math.PI/2:Math.PI/2*3;for(var l=Ze({x:e[0].x-o,y:e[0].y},e[0],s),c=Ze({x:e[0].x-o,y:e[0].y-o},e[0],s),u=[n(n({},l),{r:o,startAngle:s,endAngle:s+Math.PI/2}),n(n({},c),{r:2*o,startAngle:s+Math.PI/2,endAngle:s+Math.PI})],h=e[0].x-o,d=e[0].y-o,p=2;p<9;p++){var g=u[p-2].r+u[p-1].r,v=0;switch(p%4){case 0:v=s,h-=u[p-2].r;break;case 1:v=s+Math.PI/2,d-=u[p-2].r;break;case 2:v=s+Math.PI,h+=u[p-2].r;break;case 3:v=s+Math.PI/2*3,d+=u[p-2].r}var f=v+Math.PI/2,y=Ze({x:h,y:d},e[0],s);u.push(n(n({},y),{r:g,startAngle:v,endAngle:f}))}return[{type:"arc",attrs:u},{type:"line",attrs:Xe(e,i)}]}return[]}},ei={name:"fibonacciSpeedResistanceFan",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:function(t){var e=t.coordinates,i=t.bounding,n=[],o=[],r=[];if(e.length>1){var a=e[1].x>e[0].x?-38:4,s=e[1].y>e[0].y?-2:20,l=e[1].x-e[0].x,c=e[1].y-e[0].y;[1,.75,.618,.5,.382,.25,0].forEach((function(t){var u=e[1].x-l*t,h=e[1].y-c*t;n.push({coordinates:[{x:u,y:e[0].y},{x:u,y:e[1].y}]}),n.push({coordinates:[{x:e[0].x,y:h},{x:e[1].x,y:h}]}),o=(o=o.concat(Xe([e[0],{x:u,y:e[1].y}],i))).concat(Xe([e[0],{x:e[1].x,y:h}],i)),r.unshift({x:e[0].x+a,y:h+10,text:"".concat(t.toFixed(3))}),r.unshift({x:u-18,y:e[0].y+s,text:"".concat(t.toFixed(3))})}))}return[{type:"line",attrs:n},{type:"line",attrs:o},{type:"text",ignoreEvent:!0,attrs:r}]}},ii={name:"gannBox",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,styles:{polygon:{color:"rgba(22, 119, 255, 0.15)"}},createPointFigures:function(t){var e=t.coordinates;if(e.length>1){var i=(e[1].y-e[0].y)/4,o=e[1].x-e[0].x,r=[{coordinates:[e[0],{x:e[1].x,y:e[1].y-i}]},{coordinates:[e[0],{x:e[1].x,y:e[1].y-2*i}]},{coordinates:[{x:e[0].x,y:e[1].y},{x:e[1].x,y:e[0].y+i}]},{coordinates:[{x:e[0].x,y:e[1].y},{x:e[1].x,y:e[0].y+2*i}]},{coordinates:[n({},e[0]),{x:e[0].x+.236*o,y:e[1].y}]},{coordinates:[n({},e[0]),{x:e[0].x+.5*o,y:e[1].y}]},{coordinates:[{x:e[0].x,y:e[1].y},{x:e[0].x+.236*o,y:e[0].y}]},{coordinates:[{x:e[0].x,y:e[1].y},{x:e[0].x+.5*o,y:e[0].y}]}],a=[{coordinates:[e[0],e[1]]},{coordinates:[{x:e[0].x,y:e[1].y},{x:e[1].x,y:e[0].y}]}];return[{type:"line",attrs:[{coordinates:[e[0],{x:e[1].x,y:e[0].y}]},{coordinates:[{x:e[1].x,y:e[0].y},e[1]]},{coordinates:[e[1],{x:e[0].x,y:e[1].y}]},{coordinates:[{x:e[0].x,y:e[1].y},e[0]]}]},{type:"polygon",ignoreEvent:!0,attrs:{coordinates:[e[0],{x:e[1].x,y:e[0].y},e[1],{x:e[0].x,y:e[1].y}]},styles:{style:"fill"}},{type:"line",attrs:r,styles:{style:"dashed"}},{type:"line",attrs:a}]}return[]}},ni={name:"abcd",totalStep:5,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:function(t){var e=t.coordinates,i=[],o=[],r=["A","B","C","D"],a=e.map((function(t,e){return n(n({},t),{baseline:"bottom",text:"(".concat(r[e],")")})}));return e.length>2&&(i=[e[0],e[2]],e.length>3&&(o=[e[1],e[3]])),[{type:"line",attrs:{coordinates:e}},{type:"line",attrs:[{coordinates:i},{coordinates:o}],styles:{style:"dashed"}},{type:"text",ignoreEvent:!0,attrs:a}]}},oi={name:"xabcd",totalStep:6,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,styles:{polygon:{color:"rgba(22, 119, 255, 0.15)"}},createPointFigures:function(t){var e=t.coordinates;t.overlay;var i=[],o=[],r=["X","A","B","C","D"],a=e.map((function(t,e){return n(n({},t),{baseline:"bottom",text:"(".concat(r[e],")")})}));return e.length>2&&(i.push({coordinates:[e[0],e[2]]}),o.push({coordinates:[e[0],e[1],e[2]]}),e.length>3&&(i.push({coordinates:[e[1],e[3]]}),e.length>4&&(i.push({coordinates:[e[2],e[4]]}),o.push({coordinates:[e[2],e[3],e[4]]})))),[{type:"line",attrs:{coordinates:e}},{type:"line",attrs:i,styles:{style:"dashed"}},{type:"polygon",ignoreEvent:!0,attrs:o},{type:"text",ignoreEvent:!0,attrs:a}]}},ri={name:"anyWaves",totalStep:Number.MAX_SAFE_INTEGER,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:function(t){var e=t.coordinates,i=e.map((function(t,e){return n(n({},t),{text:"(".concat(e,")"),baseline:"bottom"})}));return[{type:"line",attrs:{coordinates:e}},{type:"text",ignoreEvent:!0,attrs:i}]}},ai={};function si(t){var e;return null!==(e=ai[t])&&void 0!==e?e:null}[Me,{name:"horizontalSegment",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:function(t){var e=t.coordinates,i=[];return 2===e.length&&i.push({coordinates:e}),[{type:"line",attrs:i}]},performEventPressedMove:function(t){var e=t.points,i=t.performPoint;e[0].value=i.value,e[1].value=i.value},performEventMoveForDrawing:function(t){var e=t.currentStep,i=t.points,n=t.performPoint;2===e&&(i[0].value=n.value)}},{name:"horizontalStraightLine",totalStep:2,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:function(t){var e=t.coordinates,i=t.bounding;return[{type:"line",attrs:{coordinates:[{x:0,y:e[0].y},{x:i.width,y:e[0].y}]}}]}},ze,Ye,He,Ue,{name:"segment",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:function(t){var e=t.coordinates;return 2===e.length?[{type:"line",attrs:{coordinates:e}}]:[]}},Ge,{name:"verticalSegment",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:function(t){var e=t.coordinates;return 2===e.length?[{type:"line",attrs:{coordinates:e}}]:[]},performEventPressedMove:function(t){var e=t.points,i=t.performPoint;e[0].timestamp=i.timestamp,e[0].dataIndex=i.dataIndex,e[1].timestamp=i.timestamp,e[1].dataIndex=i.dataIndex},performEventMoveForDrawing:function(t){var e=t.currentStep,i=t.points,n=t.performPoint;2===e&&(i[0].timestamp=n.timestamp,i[0].dataIndex=n.dataIndex)}},{name:"verticalStraightLine",totalStep:2,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:function(t){var e=t.coordinates,i=t.bounding;return[{type:"line",attrs:{coordinates:[{x:e[0].x,y:0},{x:e[0].x,y:i.height}]}}]}},je,Ke,{name:"rect",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,styles:{polygon:{color:"rgba(22, 119, 255, 0.15)"}},createPointFigures:function(t){var e=t.coordinates;return e.length>1?[{type:"polygon",attrs:{coordinates:[e[0],{x:e[1].x,y:e[0].y},e[1],{x:e[0].x,y:e[1].y}]},styles:{style:"stroke_fill"}}]:[]}},Qe,$e,{name:"parallelogram",totalStep:4,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,styles:{polygon:{color:"rgba(22, 119, 255, 0.15)"}},createPointFigures:function(t){var e=t.coordinates;if(2===e.length)return[{type:"line",ignoreEvent:!0,attrs:{coordinates:e}}];if(3===e.length){var i={x:e[0].x+(e[2].x-e[1].x),y:e[2].y};return[{type:"polygon",attrs:{coordinates:[e[0],e[1],e[2],i]},styles:{style:"stroke_fill"}}]}return[]},performEventPressedMove:function(t){var e=t.points,i=t.performPointIndex,n=t.performPoint;i<2&&(e[0].price=n.price,e[1].price=n.price)},performEventMoveForDrawing:function(t){var e=t.currentStep,i=t.points,n=t.performPoint;2===e&&(i[0].price=n.price)}},{name:"triangle",totalStep:4,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,styles:{polygon:{color:"rgba(22, 119, 255, 0.15)"}},createPointFigures:function(t){return[{type:"polygon",attrs:{coordinates:t.coordinates},styles:{style:"stroke_fill"}}]}},Je,{name:"fibonacciSegment",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:function(t){var e=t.coordinates,i=t.overlay,n=t.precision,o=[],r=[];if(e.length>1){var a=e[1].x>e[0].x?e[0].x:e[1].x,s=e[0].y-e[1].y,l=i.points,c=l[0].value-l[1].value;[1,.786,.618,.5,.382,.236,0].forEach((function(t){var i=e[1].y+s*t,u=(l[1].value+c*t).toFixed(n.price);o.push({coordinates:[{x:e[0].x,y:i},{x:e[1].x,y:i}]}),r.push({x:a,y:i,text:"".concat(u," (").concat((100*t).toFixed(1),"%)"),baseline:"bottom"})}))}return[{type:"line",attrs:o},{type:"text",ignoreEvent:!0,attrs:r}]}},{name:"fibonacciExtension",totalStep:4,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:function(t){var e=t.coordinates,i=t.overlay,n=t.precision,o=[],r=[];if(e.length>2){var a=i.points,s=a[1].value-a[0].value,l=e[1].y-e[0].y,c=e[2].x>e[1].x?e[1].x:e[2].x;[0,.236,.382,.5,.618,.786,1].forEach((function(t){var i=e[2].y+l*t,u=(a[2].value+s*t).toFixed(n.price);o.push({coordinates:[{x:e[1].x,y:i},{x:e[2].x,y:i}]}),r.push({x:c,y:i,text:"".concat(u," (").concat((100*t).toFixed(1),"%)"),baseline:"bottom"})}))}return[{type:"line",attrs:{coordinates:e},styles:{style:"dashed"}},{type:"line",attrs:o},{type:"text",ignoreEvent:!0,attrs:r}]}},ti,ei,ii,ni,oi,ri,{name:"threeWaves",totalStep:5,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:function(t){var e=t.coordinates,i=e.map((function(t,e){return n(n({},t),{text:"(".concat(e,")"),baseline:"bottom"})}));return[{type:"line",attrs:{coordinates:e}},{type:"text",ignoreEvent:!0,attrs:i}]}},{name:"fiveWaves",totalStep:7,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:function(t){var e=t.coordinates,i=e.map((function(t,e){return n(n({},t),{text:"(".concat(e,")"),baseline:"bottom"})}));return[{type:"line",attrs:{coordinates:e}},{type:"text",ignoreEvent:!0,attrs:i}]}},{name:"eightWaves",totalStep:10,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:function(t){var e=t.coordinates,i=e.map((function(t,e){return n(n({},t),{text:"(".concat(e,")"),baseline:"bottom"})}));return[{type:"line",attrs:{coordinates:e}},{type:"text",ignoreEvent:!0,attrs:i}]}}].forEach((function(t){ai[t.name]=ct.extend(t)}));var li="candle_pane",ci="indicator_pane_",ui="x_axis_pane",hi=function(){function t(t){this._instances=new Map,this._progressInstanceInfo=null,this._pressedInstanceInfo={paneId:"",instance:null,figureType:0,figureKey:"",figureIndex:-1,attrsIndex:-1},this._hoverInstanceInfo={paneId:"",instance:null,figureType:0,figureKey:"",figureIndex:-1,attrsIndex:-1},this._clickInstanceInfo={paneId:"",instance:null,figureType:0,figureKey:"",figureIndex:-1,attrsIndex:-1},this._chartStore=t}return t.prototype._overrideInstance=function(t,e){var i=e.id,n=e.groupId,o=e.points,r=e.styles,a=e.lock,s=e.visible,l=e.zLevel,c=e.mode,u=e.modeSensitivity,h=e.extendData,d=e.onDrawStart,p=e.onDrawing,g=e.onDrawEnd,v=e.onClick,f=e.onDoubleClick,y=e.onRightClick,m=e.onPressedMoveStart,x=e.onPressedMoving,_=e.onPressedMoveEnd,S=e.onMouseEnter,w=e.onMouseLeave,b=e.onRemoved,T=e.onSelected,C=e.onDeselected,P=!1,I=!1;return O(i)&&t.setId(i),O(n)&&t.setGroupId(n),A(o)&&t.setPoints(o)&&(P=!0),R(r)&&t.setStyles(r)&&(P=!0),V(a)&&t.setLock(a),V(s)&&t.setVisible(s)&&(P=!0),B(l)&&t.setZLevel(l)&&(P=!0,I=!0),R(c)&&t.setMode(c),B(u)&&t.setModeSensitivity(u),void 0!==h&&t.setExtendData(h)&&(P=!0),void 0!==d&&t.setOnDrawStartCallback(d),void 0!==p&&t.setOnDrawingCallback(p),void 0!==g&&t.setOnDrawEndCallback(g),void 0!==v&&t.setOnClickCallback(v),void 0!==f&&t.setOnDoubleClickCallback(f),void 0!==y&&t.setOnRightClickCallback(y),void 0!==m&&t.setOnPressedMoveStartCallback(m),void 0!==x&&t.setOnPressedMovingCallback(x),void 0!==_&&t.setOnPressedMoveEndCallback(_),void 0!==S&&t.setOnMouseEnterCallback(S),void 0!==w&&t.setOnMouseLeaveCallback(w),void 0!==b&&t.setOnRemovedCallback(b),void 0!==T&&t.setOnSelectedCallback(T),void 0!==C&&t.setOnDeselectedCallback(C),[P,I]},t.prototype.getInstanceById=function(t){var e,i;try{for(var n=a(this._instances),o=n.next();!o.done;o=n.next()){var r=o.value[1].find((function(e){return e.id===t}));if(R(r))return r}}catch(t){e={error:t}}finally{try{o&&!o.done&&(i=n.return)&&i.call(n)}finally{if(e)throw e.error}}return null!==this._progressInstanceInfo&&this._progressInstanceInfo.instance.id===t?this._progressInstanceInfo.instance:null},t.prototype._sort=function(t){var e;O(t)?null===(e=this._instances.get(t))||void 0===e||e.sort((function(t,e){return t.zLevel-e.zLevel})):this._instances.forEach((function(t){t.sort((function(t,e){return t.zLevel-e.zLevel}))}))},t.prototype.addInstances=function(t,e,i){var n=this,o=t.map((function(t){var o,r,a,s,l=null!==(o=t.id)&&void 0!==o?o:pt("overlay_");if(null===n.getInstanceById(l)){var c=si(t.name);if(null!==c){var u=new c;u.setPaneId(e);var h=null!==(r=t.groupId)&&void 0!==r?r:l;return t.id=l,t.groupId=h,n._overrideInstance(u,t),u.isDrawing()?n._progressInstanceInfo={paneId:e,instance:u,appointPaneFlag:i}:(n._instances.has(e)||n._instances.set(e,[]),null===(a=n._instances.get(e))||void 0===a||a.push(u)),u.isStart()&&(null===(s=u.onDrawStart)||void 0===s||s.call(u,{overlay:u})),l}}return null}));if(o.some((function(t){return null!==t}))){this._sort();var r=this._chartStore.getChart();r.updatePane(1,e),r.updatePane(1,ui)}return o},t.prototype.getProgressInstanceInfo=function(){return this._progressInstanceInfo},t.prototype.progressInstanceComplete=function(){var t;if(null!==this._progressInstanceInfo){var e=this._progressInstanceInfo,i=e.instance,n=e.paneId;i.isDrawing()||(this._instances.has(n)||this._instances.set(n,[]),null===(t=this._instances.get(n))||void 0===t||t.push(i),this._sort(n),this._progressInstanceInfo=null)}},t.prototype.updateProgressInstanceInfo=function(t,e){null!==this._progressInstanceInfo&&(V(e)&&e&&(this._progressInstanceInfo.appointPaneFlag=e),this._progressInstanceInfo.paneId=t,this._progressInstanceInfo.instance.setPaneId(t))},t.prototype.getInstances=function(t){var e;if(!O(t)){var i=[];return this._instances.forEach((function(t){i=i.concat(t)})),i}return null!==(e=this._instances.get(t))&&void 0!==e?e:[]},t.prototype.override=function(t){var e=this,i=t.id,n=t.groupId,o=t.name,r=!1,a=!1,s=function(i){var n=e._overrideInstance(i,t);n[0]&&(r=!0),n[1]&&(a=!0)};if(O(i)){var l=this.getInstanceById(i);null!==l&&s(l)}else{var c=O(o),u=O(n);if(this._instances.forEach((function(t){t.forEach((function(t){(c&&t.name===o||u&&t.groupId===n||!c&&!u)&&s(t)}))})),null!==this._progressInstanceInfo){var h=this._progressInstanceInfo.instance;(c&&h.name===o||u&&h.groupId===n||!c&&!u)&&s(h)}}a&&this._sort(),r&&this._chartStore.getChart().updatePane(1)},t.prototype.removeInstance=function(t){var e,i,n,o=this,r=function(t,e){if(O(t.id)){if(e.id!==t.id)return!1}else if(O(t.groupId)){if(e.groupId!==t.groupId)return!1}else if(O(t.name)&&e.name!==t.name)return!1;return!0},s=[],l=R(t);if(null!==this._progressInstanceInfo){var c=this._progressInstanceInfo.instance;(!l||l&&r(t,c))&&(s.push(this._progressInstanceInfo.paneId),null===(n=c.onRemoved)||void 0===n||n.call(c,{overlay:c}),this._progressInstanceInfo=null)}var u=new Set;if(l){var h=new Map,d=function(e){var i=e[1].filter((function(i){var n;return!r(t,i)||(s.includes(e[0])||s.push(e[0]),null===(n=i.onRemoved)||void 0===n||n.call(i,{overlay:i}),!1)}));i.length>0&&h.set(e[0],i)};try{for(var p=a(this._instances),g=p.next();!g.done;g=p.next()){d(g.value)}}catch(t){e={error:t}}finally{try{g&&!g.done&&(i=p.return)&&i.call(p)}finally{if(e)throw e.error}}this._instances=h}else this._instances.forEach((function(t,e){s.push(e),t.forEach((function(t){var i;"OVERLAY_TRADING_GROUP_ID"!==t.groupId&&(u.add(e+t.id),null===(i=t.onRemoved)||void 0===i||i.call(t,{overlay:t}))}))}));if(s.length>0){var v=this._chartStore.getChart();s.forEach((function(t){var e=o._instances.get(t);if(e){var i=e.filter((function(e){return!u.has(t+e.id)}));o._instances.set(t,i)}v.updatePane(1,t)})),v.updatePane(1,ui)}},t.prototype.setPressedInstanceInfo=function(t){this._pressedInstanceInfo=t},t.prototype.getPressedInstanceInfo=function(){return this._pressedInstanceInfo},t.prototype.updatePointPosition=function(t,e){if(t>0){var i=this._chartStore.getDataList();this._instances.forEach((function(n){n.forEach((function(n){n.points.forEach((function(n){if(!R(n.timestamp)&&R(n.dataIndex)){e===ut.Forward&&(n.dataIndex=n.dataIndex+t);var o=i[n.dataIndex];n.timestamp=null==o?void 0:o.timestamp}}))}))}))}},t.prototype.setHoverInstanceInfo=function(t,e){var i,o,r=this._hoverInstanceInfo,a=r.instance,s=r.figureType,l=r.figureKey,c=r.figureIndex;if(((null==a?void 0:a.id)!==(null===(i=t.instance)||void 0===i?void 0:i.id)||s!==t.figureType||c!==t.figureIndex)&&(this._hoverInstanceInfo=t,(null==a?void 0:a.id)!==(null===(o=t.instance)||void 0===o?void 0:o.id))){var u=!1,h=!1;null!==a&&(h=!0,F(a.onMouseLeave)&&(a.onMouseLeave(n({overlay:a,figureKey:l,figureIndex:c},e)),u=!0)),null!==t.instance&&(h=!0,t.instance.setZLevel(at),F(t.instance.onMouseEnter)&&(t.instance.onMouseEnter(n({overlay:t.instance,figureKey:t.figureKey,figureIndex:t.figureIndex},e)),u=!0)),h&&this._sort(),u||this._chartStore.getChart().updatePane(1)}},t.prototype.getHoverInstanceInfo=function(){return this._hoverInstanceInfo},t.prototype.setClickInstanceInfo=function(t,e){var i,o,r,a,s,l,c,u,h,d=this._clickInstanceInfo,p=d.paneId,g=d.instance,v=d.figureType,f=d.figureKey,y=d.figureIndex;if(null!==(o=null===(i=t.instance)||void 0===i?void 0:i.isDrawing())&&void 0!==o&&o||null===(a=null===(r=t.instance)||void 0===r?void 0:r.onClick)||void 0===a||a.call(r,n({overlay:t.instance,figureKey:t.figureKey,figureIndex:t.figureIndex},e)),((null==g?void 0:g.id)!==(null===(s=t.instance)||void 0===s?void 0:s.id)||v!==t.figureType||y!==t.figureIndex)&&(this._clickInstanceInfo=t,(null==g?void 0:g.id)!==(null===(l=t.instance)||void 0===l?void 0:l.id))){null===(c=null==g?void 0:g.onDeselected)||void 0===c||c.call(g,n({overlay:g,figureKey:f,figureIndex:y},e)),null===(h=null===(u=t.instance)||void 0===u?void 0:u.onSelected)||void 0===h||h.call(u,n({overlay:t.instance,figureKey:t.figureKey,figureIndex:t.figureIndex},e));var m=this._chartStore.getChart();m.updatePane(1,t.paneId),p!==t.paneId&&m.updatePane(1,p),m.updatePane(1,ui)}},t.prototype.getClickInstanceInfo=function(){return this._clickInstanceInfo},t.prototype.isEmpty=function(){return 0===this._instances.size&&null===this._progressInstanceInfo},t.prototype.isDrawing=function(){var t,e;return null!==this._progressInstanceInfo&&null!==(e=null===(t=this._progressInstanceInfo)||void 0===t?void 0:t.instance.isDrawing())&&void 0!==e&&e},t}(),di=function(){function t(){this._actions=new Map}return t.prototype.execute=function(t,e){var i;null===(i=this._actions.get(t))||void 0===i||i.execute(e)},t.prototype.subscribe=function(t,e){var i;this._actions.has(t)||this._actions.set(t,new J),null===(i=this._actions.get(t))||void 0===i||i.subscribe(e)},t.prototype.unsubscribe=function(t,e){var i=this._actions.get(t);R(i)&&(i.unsubscribe(e),i.isEmpty()&&this._actions.delete(t))},t.prototype.has=function(t){var e=this._actions.get(t);return R(e)&&!e.isEmpty()},t}(),pi={light:{grid:{horizontal:{color:"#EDEDED"},vertical:{color:"#EDEDED"}},candle:{priceMark:{high:{color:"#76808F"},low:{color:"#76808F"}},tooltip:{rect:{color:"#FEFEFE",borderColor:"#F2F3F5"},text:{color:"#76808F"}}},indicator:{tooltip:{text:{color:"#76808F"}}},xAxis:{axisLine:{color:"#DDDDDD"},tickText:{color:"#76808F"},tickLine:{color:"#DDDDDD"}},yAxis:{axisLine:{color:"#DDDDDD"},tickText:{color:"#76808F"},tickLine:{color:"#DDDDDD"}},separator:{color:"#DDDDDD"},crosshair:{horizontal:{line:{color:"#76808F"},text:{borderColor:"#686D76",backgroundColor:"#686D76"}},vertical:{line:{color:"#76808F"},text:{borderColor:"#686D76",backgroundColor:"#686D76"}}}},dark:{grid:{horizontal:{color:"#292929"},vertical:{color:"#292929"}},candle:{priceMark:{high:{color:"#929AA5"},low:{color:"#929AA5"}},tooltip:{rect:{color:"rgba(10, 10, 10, .6)",borderColor:"rgba(10, 10, 10, .6)"},text:{color:"#929AA5"}}},indicator:{tooltip:{text:{color:"#929AA5"}}},xAxis:{axisLine:{color:"#333333"},tickText:{color:"#929AA5"},tickLine:{color:"#333333"}},yAxis:{axisLine:{color:"#333333"},tickText:{color:"#929AA5"},tickLine:{color:"#333333"}},separator:{color:"#333333"},crosshair:{horizontal:{line:{color:"#929AA5"},text:{borderColor:"#373a40",backgroundColor:"#373a40"}},vertical:{line:{color:"#929AA5"},text:{borderColor:"#373a40",backgroundColor:"#373a40"}}}}};function gi(t){var e;return null!==(e=pi[t])&&void 0!==e?e:null}var vi={drawSessionBreak:!0,tradingHours:{morningSession:{open:"09:00:00",close:"11:30:00"},afternoonSession:{enabled:!0,open:"13:00:00",close:"14:30:00"}}},fi=function(){function e(e,i){var o,r,a;this._styles={grid:P(),candle:(a={show:!1,color:b,textOffset:5,textSize:10,textFamily:"Helvetica Neue",textWeight:"normal"},{type:t.CandleType.CandleSolid,bar:{upColor:m,downColor:x,noChangeColor:_,upBorderColor:m,downBorderColor:x,noChangeBorderColor:_,upWickColor:m,downWickColor:x,noChangeWickColor:_},area:{lineSize:2,lineColor:w,smooth:!1,value:"close",backgroundColor:[{offset:0,color:C(.01)},{offset:1,color:C(.2)}],point:{show:!0,color:w,radius:4,rippleColor:C(.3),rippleRadius:8,animation:!0,animationDuration:1e3}},priceMark:{show:!0,high:n({},a),low:n({},a),last:{show:!1,upColor:m,downColor:x,noChangeColor:_,line:{show:!0,style:t.LineType.Dashed,dashedValue:[4,4],size:1},text:{show:!0,style:t.PolygonType.Fill,size:12,paddingLeft:4,paddingTop:4,paddingRight:4,paddingBottom:4,borderColor:"transparent",borderStyle:t.LineType.Solid,borderSize:0,borderDashedValue:[2,2],color:S,family:"Helvetica Neue",weight:"normal",borderRadius:2}}},tooltip:{offsetLeft:4,offsetTop:6,offsetRight:4,offsetBottom:6,showRule:t.TooltipShowRule.Always,showType:t.TooltipShowType.Standard,custom:[{title:"time",value:"{time}"},{title:"open",value:"{open}"},{title:"high",value:"{high}"},{title:"low",value:"{low}"},{title:"close",value:"{close}"},{title:"volume",value:"{volume}"}],defaultValue:"n/a",rect:{position:g.Fixed,paddingLeft:4,paddingRight:4,paddingTop:4,paddingBottom:4,offsetLeft:4,offsetTop:4,offsetRight:4,offsetBottom:4,borderRadius:4,borderSize:1,borderColor:"#F2F3F5",color:"#FEFEFE"},text:{size:12,family:"Helvetica Neue",weight:"normal",color:b,marginLeft:8,marginTop:4,marginRight:8,marginBottom:4},icons:[]}}),indicator:(r=["#FF9600","#935EBD",w,"#E11D74","#01C5C4"].map((function(e){return{style:t.LineType.Solid,smooth:!1,size:1,dashedValue:[2,2],color:e}})),{ohlc:{upColor:m,downColor:x,noChangeColor:_},bars:[{style:t.PolygonType.Fill,borderStyle:t.LineType.Solid,borderSize:1,borderDashedValue:[2,2],upColor:m,downColor:x,noChangeColor:_}],lines:r,circles:[{style:t.PolygonType.Fill,borderStyle:t.LineType.Solid,borderSize:1,borderDashedValue:[2,2],upColor:m,downColor:x,noChangeColor:_}],lastValueMark:{show:!1,text:{show:!1,style:t.PolygonType.Fill,color:S,size:12,family:"Helvetica Neue",weight:"normal",borderStyle:t.LineType.Solid,borderColor:"transparent",borderSize:0,borderDashedValue:[2,2],paddingLeft:4,paddingTop:4,paddingRight:4,paddingBottom:4,borderRadius:2}},tooltip:{offsetLeft:4,offsetTop:6,offsetRight:4,offsetBottom:6,showRule:t.TooltipShowRule.Always,showType:t.TooltipShowType.Standard,showName:!0,showParams:!0,defaultValue:"n/a",text:{size:12,family:"Helvetica Neue",weight:"normal",color:b,marginLeft:8,marginTop:4,marginRight:8,marginBottom:4},icons:[]}}),xAxis:I(),yAxis:(o=I(),o.type=t.YAxisType.Normal,o.position=t.YAxisPosition.Right,o.inside=!1,o.reverse=!1,o),separator:{size:1,color:T,fill:!0,activeBackgroundColor:C(.08)},crosshair:D(),overlay:E(),sessionBreak:{size:1,color:_,style:t.LineType.Dashed,dashedValue:[2,2]}},this._customApi={formatDate:X,formatBigNumber:G},this._locale="en-US",this._precision={price:2,volume:0},this._thousandsSeparator=",",this._decimalFoldThreshold=3,this._dataList=[],this._loadMoreCallback=null,this._loadDataCallback=null,this._loading=!0,this._forwardMore=!0,this._backwardMore=!0,this._timeScaleStore=new wt(this),this._indicatorStore=new De(this),this._overlayStore=new hi(this),this._tooltipStore=new Ee(this),this._actionStore=new di,this._visibleDataList=[],this._tradingSettings=vi,this._timeFrameDuration=-1,this._chart=e,this.setOptions(i)}return e.prototype.adjustVisibleDataList=function(){this._visibleDataList=[];for(var t=this._timeScaleStore.getVisibleRange(),e=t.realFrom,i=t.realTo,n=e;n<i;n++){var o=this._dataList[n],r=this._timeScaleStore.dataIndexToCoordinate(n);this._visibleDataList.push({dataIndex:n,x:r,data:o})}},e.prototype.setOptions=function(t){var e,i,n,o;if(R(t)){var r=t.locale,a=t.timezone,s=t.styles,l=t.customApi,c=t.thousandsSeparator,u=t.decimalFoldThreshold;if(O(r)&&(this._locale=r),O(a)&&this._timeScaleStore.setTimezone(a),R(s)){var h=null;h=O(s)?gi(s):s,M(this._styles,h),A(null===(i=null===(e=null==h?void 0:h.candle)||void 0===e?void 0:e.tooltip)||void 0===i?void 0:i.custom)&&(this._styles.candle.tooltip.custom=null===(o=null===(n=null==h?void 0:h.candle)||void 0===n?void 0:n.tooltip)||void 0===o?void 0:o.custom)}R(l)&&M(this._customApi,l),O(c)&&(this._thousandsSeparator=c),B(u)&&u>0&&(this._decimalFoldThreshold=u)}return this},e.prototype.getStyles=function(){return this._styles},e.prototype.getLocale=function(){return this._locale},e.prototype.getCustomApi=function(){return this._customApi},e.prototype.getThousandsSeparator=function(){return this._thousandsSeparator},e.prototype.getDecimalFoldThreshold=function(){return this._decimalFoldThreshold},e.prototype.getPrecision=function(){return this._precision},e.prototype.setPrecision=function(t){return this._precision=t,this._indicatorStore.synchronizeSeriesPrecision(),this},e.prototype.getDataList=function(){return this._dataList},e.prototype.getVisibleDataList=function(){return this._visibleDataList},e.prototype.addData=function(e,i,n){return o(this,void 0,void 0,(function(){var o,a,s,l,c,u,h,d;return r(this,(function(r){switch(r.label){case 0:if(o=!1,a=!1,s=0,A(e)){switch(s=e.length,i){case ut.Init:this.clear(),this._dataList=e,this._forwardMore=null==n||n,this._timeScaleStore.resetOffsetRightDistance(),a=!0;break;case ut.Backward:this._dataList=this._dataList.concat(e),this._backwardMore=null!=n&&n,a=s>0;break;case ut.Forward:this._dataList=e.concat(this._dataList),this._forwardMore=null!=n&&n,a=s>0}this._loading=!1,o=!0}else l=this._dataList.length,c=e.timestamp,u=H(this._dataList[l-1],"timestamp",0),c>u?(this._dataList.push(e),(h=this._timeScaleStore.getLastBarRightSideDiffBarCount())<0&&this._timeScaleStore.setLastBarRightSideDiffBarCount(--h),s=1,o=!0,a=!0):c===u&&(this._dataList[l-1]=e,o=!0,a=!0);if(!o)return[3,5];r.label=1;case 1:return r.trys.push([1,4,,5]),this._overlayStore.updatePointPosition(s,i),a?(this._timeScaleStore.adjustVisibleRange(),this._tooltipStore.recalculateCrosshair(!0),[4,this._indicatorStore.calcInstance()]):[3,3];case 2:r.sent(),this._chart.adjustPaneViewport(!1,!0,!0,!0),r.label=3;case 3:return this._actionStore.execute(t.ActionType.OnDataReady),[3,5];case 4:return d=r.sent(),console.log("Chart store "+d.toString()),[3,5];case 5:return[2]}}))}))},e.prototype.setLoadMoreCallback=function(t){this._loadMoreCallback=t},e.prototype.executeLoadMoreCallback=function(t){this._forwardMore&&!this._loading&&R(this._loadMoreCallback)&&(this._loading=!0,this._loadMoreCallback(t))},e.prototype.setLoadDataCallback=function(t){this._loadDataCallback=t},e.prototype.executeLoadDataCallback=function(t){var e=this;if(!this._loading&&R(this._loadDataCallback)&&(this._forwardMore&&t.type===ut.Forward||this._backwardMore&&t.type===ut.Backward)){this._loading=!0,this._loadDataCallback(n(n({},t),{callback:function(i,n){e.addData(i,t.type,n).then((function(){})).catch((function(){}))}}))}},e.prototype.clear=function(){this._forwardMore=!0,this._backwardMore=!0,this._loading=!0,this._dataList=[],this._visibleDataList=[],this._timeScaleStore.clear(),this._tooltipStore.clear()},e.prototype.getTimeScaleStore=function(){return this._timeScaleStore},e.prototype.getIndicatorStore=function(){return this._indicatorStore},e.prototype.getOverlayStore=function(){return this._overlayStore},e.prototype.getTooltipStore=function(){return this._tooltipStore},e.prototype.getActionStore=function(){return this._actionStore},e.prototype.getChart=function(){return this._chart},e.prototype.setTradingSettings=function(t){this._tradingSettings=t},e.prototype.getTradingSettings=function(){return this._tradingSettings},e.prototype.setTimeframeDuration=function(t){this._timeFrameDuration=t},e.prototype.getTimeframeDuration=function(){return this._timeFrameDuration},e.prototype.addIntradayData=function(e){return o(this,void 0,void 0,(function(){var i,n,o,a,s,l,c,u;return r(this,(function(r){switch(r.label){case 0:if(i=!1,n=!1,o=0,a=this._dataList.length,s=e.timestamp,l=H(this._dataList[a-1],"timestamp",0),h=s,d=l,p=this._timeFrameDuration,g=p/6e4,v=new Date(h),f=new Date(d),y=v.getHours(),m=v.getMinutes(),x=f.getHours(),_=f.getMinutes(),y===x&&m-_<g?(this._dataList[a-1]=e,i=!0,n=!0):function(t,e,i){var n=i/6e4,o=new Date(t),r=new Date(e),a=o.getHours(),s=o.getMinutes(),l=r.getHours(),c=r.getMinutes();return a>l||a===l&&s-c>=n}(s,l,this._timeFrameDuration)&&(this._dataList.push(e),(c=this._timeScaleStore.getLastBarRightSideDiffBarCount())<0&&this._timeScaleStore.setLastBarRightSideDiffBarCount(--c),o=1,i=!0,n=!0),!i)return[3,5];r.label=1;case 1:return r.trys.push([1,4,,5]),this._overlayStore.updatePointPosition(o,null),n?(this._timeScaleStore.adjustVisibleRange(),this._tooltipStore.recalculateCrosshair(!0),[4,this._indicatorStore.calcInstance()]):[3,3];case 2:r.sent(),this._chart.adjustPaneViewport(!1,!0,!0,!0),r.label=3;case 3:return this._actionStore.execute(t.ActionType.OnDataReady),[3,5];case 4:return u=r.sent(),console.error(u),console.log("Chart store "+u.toString()),[3,5];case 5:return[2]}var h,d,p,g,v,f,y,m,x,_}))}))},e}(),yi="main",mi="xAxis",xi="yAxis",_i="separator";function Si(t){return F(window.requestAnimationFrame)?window.requestAnimationFrame(t):window.setTimeout(t,20)}function wi(t){F(window.cancelAnimationFrame)?window.cancelAnimationFrame(t):window.clearTimeout(t)}var bi=function(){function t(t,e){var i=this;this._supportedDevicePixelContentBox=!1,this._width=0,this._height=0,this._pixelWidth=0,this._pixelHeight=0,this._nextPixelWidth=0,this._nextPixelHeight=0,this._requestAnimationId=-1,this._mediaQueryListener=function(){var t=Z(i._element);i._nextPixelWidth=Math.round(i._element.clientWidth*t),i._nextPixelHeight=Math.round(i._element.clientHeight*t),i._resetPixelRatio()},this._listener=e,this._element=gt("canvas",t),this._ctx=this._element.getContext("2d",{willReadFrequently:!0}),function(){return o(this,void 0,void 0,(function(){return r(this,(function(t){switch(t.label){case 0:return[4,new Promise((function(t){var e=new ResizeObserver((function(i){t(i.every((function(t){return"devicePixelContentBoxSize"in t}))),e.disconnect()}));e.observe(document.body,{box:"device-pixel-content-box"})})).catch((function(){return!1}))];case 1:return[2,t.sent()]}}))}))}().then((function(t){i._supportedDevicePixelContentBox=t,t?(i._resizeObserver=new ResizeObserver((function(t){var e,n=t.find((function(t){return t.target===i._element})),o=null===(e=null==n?void 0:n.devicePixelContentBoxSize)||void 0===e?void 0:e[0];R(o)&&(i._nextPixelWidth=o.inlineSize,i._nextPixelHeight=o.blockSize,i._pixelWidth===i._nextPixelWidth&&i._pixelHeight===i._nextPixelHeight||i._resetPixelRatio())})),i._resizeObserver.observe(i._element,{box:"device-pixel-content-box"})):(i._mediaQueryList=window.matchMedia("(resolution: ".concat(Z(i._element),"dppx)")),i._mediaQueryList.addListener(i._mediaQueryListener))})).catch((function(t){return!1}))}return t.prototype._resetPixelRatio=function(){var t=this;this._executeListener((function(){var e=t._element.clientWidth,i=t._element.clientHeight,n=t._nextPixelWidth/e,o=t._nextPixelHeight/i;t._width=e,t._height=i,t._pixelWidth=t._nextPixelWidth,t._pixelHeight=t._nextPixelHeight,t._element.width=t._nextPixelWidth,t._element.height=t._nextPixelHeight,t._ctx.scale(n,o)}))},t.prototype._executeListener=function(t){var e=this;-1===this._requestAnimationId&&(this._requestAnimationId=Si((function(){e._ctx.clearRect(0,0,e._width,e._height),null==t||t(),e._listener(),e._requestAnimationId=-1})))},t.prototype.update=function(t,e){if(this._width!==t||this._height!==e){if(this._element.style.width="".concat(t,"px"),this._element.style.height="".concat(e,"px"),!this._supportedDevicePixelContentBox){var i=Z(this._element);this._nextPixelWidth=Math.round(t*i),this._nextPixelHeight=Math.round(e*i),this._resetPixelRatio()}}else this._executeListener()},t.prototype.getElement=function(){return this._element},t.prototype.getContext=function(){return this._ctx},t.prototype.destroy=function(){var t,e;null===(t=this._resizeObserver)||void 0===t||t.unobserve(this._element),null===(e=this._mediaQueryList)||void 0===e||e.removeListener(this._mediaQueryListener)},t}();function Ti(t){var e={width:0,height:0,left:0,right:0,top:0,bottom:0};return R(t)&&M(e,t),e}var Ci=function(t){function e(e,i){var n=t.call(this)||this;return n._bounding=Ti(),n._pane=i,n.init(e),n}return i(e,t),e.prototype.init=function(t){this._rootContainer=t,this._container=this.createContainer(),t.appendChild(this._container)},e.prototype.setBounding=function(t){return M(this._bounding,t),this},e.prototype.getContainer=function(){return this._container},e.prototype.getBounding=function(){return this._bounding},e.prototype.getPane=function(){return this._pane},e.prototype.update=function(t){this.updateImp(this._container,this._bounding,null!=t?t:3)},e.prototype.destroy=function(){this._rootContainer.removeChild(this._container)},e}(ke),Pi=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.init=function(e){var i=this;t.prototype.init.call(this,e),this._mainCanvas=new bi({position:"absolute",top:"0",left:"0",zIndex:"2",boxSizing:"border-box"},(function(){i.updateMain(i._mainCanvas.getContext())})),this._overlayCanvas=new bi({position:"absolute",top:"0",left:"0",zIndex:"2",boxSizing:"border-box"},(function(){i.updateOverlay(i._overlayCanvas.getContext())}));var n=this.getContainer();n.appendChild(this._mainCanvas.getElement()),n.appendChild(this._overlayCanvas.getElement())},e.prototype.createContainer=function(){return gt("div",{margin:"0",padding:"0",position:"absolute",top:"0",overflow:"hidden",boxSizing:"border-box",zIndex:"1"})},e.prototype.updateImp=function(t,e,i){var n=e.width,o=e.height,r=e.left;t.style.left="".concat(r,"px");var a=i,s=t.clientWidth,l=t.clientHeight;switch(n===s&&o===l||(t.style.width="".concat(n,"px"),t.style.height="".concat(o,"px"),a=3),a){case 0:this._mainCanvas.update(n,o);break;case 1:this._overlayCanvas.update(n,o);break;case 3:case 4:this._mainCanvas.update(n,o),this._overlayCanvas.update(n,o)}},e.prototype.destroy=function(){this._mainCanvas.destroy(),this._overlayCanvas.destroy()},e.prototype.getImage=function(t){var e=this.getBounding(),i=e.width,n=e.height,o=gt("canvas",{width:"".concat(i,"px"),height:"".concat(n,"px"),boxSizing:"border-box"}),r=o.getContext("2d"),a=Z(o);return o.width=i*a,o.height=n*a,r.scale(a,a),r.drawImage(this._mainCanvas.getElement(),0,0,i,n),t&&r.drawImage(this._overlayCanvas.getElement(),0,0,i,n),o},e}(Ci);function Ii(t){return"transparent"===t||"none"===t||/^[rR][gG][Bb][Aa]\(([\s]*(2[0-4][0-9]|25[0-5]|[01]?[0-9][0-9]?)[\s]*,){3}[\s]*0[\s]*\)$/.test(t)||/^[hH][Ss][Ll][Aa]\(([\s]*(3603[0-5][0-9]|[012]?[0-9][0-9]?)[\s]*,)([\s]*((100|[0-9][0-9]?)%|0)[\s]*,){2}([\s]*0[\s]*)\)$/.test(t)}function Di(t,e){var i=[];i=i.concat(e);for(var n=0;n<i.length;n++){var o=i[n],r=o.x,a=o.y,s=o.r,l=t.x-r,c=t.y-a;if(!(l*l+c*c>s*s))return!0}return!1}function Ei(e,i,n){var o=[];o=o.concat(i);var r=n.style,a=void 0===r?t.PolygonType.Fill:r,s=n.color,l=void 0===s?"currentColor":s,c=n.borderSize,u=void 0===c?1:c,h=n.borderColor,d=void 0===h?"currentColor":h,p=n.borderStyle,g=void 0===p?t.LineType.Solid:p,v=n.borderDashedValue,f=void 0===v?[2,2]:v;a!==t.PolygonType.Fill&&n.style!==t.PolygonType.StrokeFill||O(l)&&Ii(l)||(e.fillStyle=l,o.forEach((function(t){var i=t.x,n=t.y,o=t.r;e.beginPath(),e.arc(i,n,o,0,2*Math.PI),e.closePath(),e.fill()}))),(a===t.PolygonType.Stroke||n.style===t.PolygonType.StrokeFill)&&u>0&&!Ii(d)&&(e.strokeStyle=d,e.lineWidth=u,g===t.LineType.Dashed?e.setLineDash(f):e.setLineDash([]),o.forEach((function(t){var i=t.x,n=t.y,o=t.r;e.beginPath(),e.arc(i,n,o,0,2*Math.PI),e.closePath(),e.stroke()})))}var Mi={name:"circle",checkEventOn:Di,draw:function(t,e,i){Ei(t,e,i)}};function ki(t,e){var i=[];i=i.concat(e);for(var n=0;n<i.length;n++){for(var o=!1,r=i[n].coordinates,a=0,s=r.length-1;a<r.length;s=a++)r[a].y>t.y!=r[s].y>t.y&&t.x<(r[s].x-r[a].x)*(t.y-r[a].y)/(r[s].y-r[a].y)+r[a].x&&(o=!o);if(o)return!0}return!1}function Ai(e,i,n){var o=[];o=o.concat(i);var r=n.style,a=void 0===r?t.PolygonType.Fill:r,s=n.color,l=void 0===s?"currentColor":s,c=n.borderSize,u=void 0===c?1:c,h=n.borderColor,d=void 0===h?"currentColor":h,p=n.borderStyle,g=void 0===p?t.LineType.Solid:p,v=n.borderDashedValue,f=void 0===v?[2,2]:v;a!==t.PolygonType.Fill&&n.style!==t.PolygonType.StrokeFill||O(l)&&Ii(l)||(e.fillStyle=l,o.forEach((function(t){var i=t.coordinates;e.beginPath(),e.moveTo(i[0].x,i[0].y);for(var n=1;n<i.length;n++)e.lineTo(i[n].x,i[n].y);e.closePath(),e.fill()}))),(a===t.PolygonType.Stroke||n.style===t.PolygonType.StrokeFill)&&u>0&&!Ii(d)&&(e.strokeStyle=d,e.lineWidth=u,g===t.LineType.Dashed?e.setLineDash(f):e.setLineDash([]),o.forEach((function(t){var i=t.coordinates;e.beginPath(),e.moveTo(i[0].x,i[0].y);for(var n=1;n<i.length;n++)e.lineTo(i[n].x,i[n].y);e.closePath(),e.stroke()})))}var Fi={name:"polygon",checkEventOn:ki,draw:function(t,e,i){Ai(t,e,i)}};function Li(t,e){var i=[];i=i.concat(e);for(var n=0;n<i.length;n++){var o=i[n],r=o.x,a=o.width;a<4&&(r-=2,a=4);var s=o.y,l=o.height;if(l<4&&(s-=2,l=4),t.x>=r&&t.x<=r+a&&t.y>=s&&t.y<=s+l)return!0}return!1}function Bi(e,i,n){var o=[];o=o.concat(i);var r=n.style,a=void 0===r?t.PolygonType.Fill:r,s=n.color,l=void 0===s?"transparent":s,c=n.borderSize,u=void 0===c?1:c,h=n.borderColor,d=void 0===h?"transparent":h,p=n.borderStyle,g=void 0===p?t.LineType.Solid:p,v=n.borderRadius,f=void 0===v?0:v,y=n.borderDashedValue,m=void 0===y?[2,2]:y;a!==t.PolygonType.Fill&&n.style!==t.PolygonType.StrokeFill||O(l)&&Ii(l)||(e.fillStyle=l,o.forEach((function(t){var i=t.x,n=t.y,o=t.width,r=t.height;e.beginPath(),e.moveTo(i+f,n),e.arcTo(i+o,n,i+o,n+r,f),e.arcTo(i+o,n+r,i,n+r,f),e.arcTo(i,n+r,i,n,f),e.arcTo(i,n,i+o,n,f),e.closePath(),e.fill()}))),(a===t.PolygonType.Stroke||n.style===t.PolygonType.StrokeFill)&&u>0&&!Ii(d)&&(e.strokeStyle=d,e.lineWidth=u,g===t.LineType.Dashed?e.setLineDash(m):e.setLineDash([]),o.forEach((function(t){var i=t.x,n=t.y,o=t.width,r=t.height;e.beginPath(),e.moveTo(i+f,n),e.arcTo(i+o,n,i+o,n+r,f),e.arcTo(i+o,n+r,i,n+r,f),e.arcTo(i,n+r,i,n,f),e.arcTo(i,n,i+o,n,f),e.closePath(),e.stroke()})))}var Ri={name:"rect",checkEventOn:Li,draw:function(t,e,i){Bi(t,e,i)}};function Vi(t,e){var i,n,o=e.size,r=void 0===o?12:o,a=e.paddingLeft,s=void 0===a?0:a,l=e.paddingTop,c=void 0===l?0:l,u=e.paddingRight,h=void 0===u?0:u,d=e.paddingBottom,p=void 0===d?0:d,g=e.weight,v=void 0===g?"normal":g,f=e.family,y=t.x,m=t.y,x=t.text,_=t.align,S=void 0===_?"left":_,w=t.baseline,b=void 0===w?"top":w,T=t.width,C=t.height,P=null!=T?T:s+Q(x,r,v,f)+h,I=null!=C?C:c+r+p;switch(S){case"left":case"start":i=y;break;case"right":case"end":i=y-P;break;default:i=y-P/2}switch(b){case"top":case"hanging":n=m;break;case"bottom":case"ideographic":case"alphabetic":n=m-I;break;default:n=m-I/2}return{x:i,y:n,width:P,height:I}}function Oi(t,e,i){var n=[];n=n.concat(e);for(var o=0;o<n.length;o++){var r=Vi(n[o],i),a=r.x,s=r.y,l=r.width,c=r.height;if(t.x>=a&&t.x<=a+l&&t.y>=s&&t.y<=s+c)return!0}return!1}function Ni(t,e,i){var o=[];o=o.concat(e);var r=i.color,a=void 0===r?"currentColor":r,s=i.size,l=void 0===s?12:s,c=i.family,u=i.weight,h=i.paddingLeft,d=void 0===h?0:h,p=i.paddingTop,g=void 0===p?0:p,v=i.paddingRight,f=void 0===v?0:v,y=o.map((function(t){return Vi(t,i)}));Bi(t,y,n(n({},i),{color:i.backgroundColor})),t.textAlign="left",t.textBaseline="top",t.font=q(l,u,c),t.fillStyle=a,o.forEach((function(e,i){var n=y[i];t.fillText(e.text,n.x+d,n.y+g,n.width-d-f)}))}var Wi={name:"text",checkEventOn:Oi,draw:function(t,e,i){Ni(t,e,i)}},zi=Ni;function Yi(t,e){var i,n,o,r,a=[];a=a.concat(e);for(var s=0;s<a.length;s++){var l=a[s];if(Math.abs((n=l,o=void 0,r=void 0,o=(i=t).x-n.x,r=i.y-n.y,Math.sqrt(o*o+r*r)-l.r))<2){var c=l.r,u=l.startAngle,h=l.endAngle,d=c*Math.cos(u)+l.x,p=c*Math.sin(u)+l.y,g=c*Math.cos(h)+l.x,v=c*Math.sin(h)+l.y;if(t.x<=Math.max(d,g)+2&&t.x>=Math.min(d,g)-2&&t.y<=Math.max(p,v)+2&&t.y>=Math.min(p,v)-2)return!0}}return!1}function Hi(e,i,n){var o=[];o=o.concat(i);var r=n.style,a=void 0===r?t.LineType.Solid:r,s=n.size,l=void 0===s?1:s,c=n.color,u=void 0===c?"currentColor":c,h=n.dashedValue,d=void 0===h?[2,2]:h;e.lineWidth=l,e.strokeStyle=u,a===t.LineType.Dashed?e.setLineDash(d):e.setLineDash([]),o.forEach((function(t){var i=t.x,n=t.y,o=t.r,r=t.startAngle,a=t.endAngle;e.beginPath(),e.arc(i,n,o,r,a),e.stroke(),e.closePath()}))}var Xi={name:"arc",checkEventOn:Yi,draw:function(t,e,i){Hi(t,e,i)}},Ui={};[Mi,Ne,Fi,Ri,Wi,Wi,Xi].forEach((function(t){Ui[t.name]=Ae.extend(t)}));var Gi=function(t){function e(e){var i=t.call(this)||this;return i._widget=e,i}return i(e,t),e.prototype.getWidget=function(){return this._widget},e.prototype.createFigure=function(t,e){var i,n,o=(i=t.name,null!==(n=Ui[i])&&void 0!==n?n:null);if(null!==o){var r=new o(t);if(R(e)){for(var a in e)e.hasOwnProperty(a)&&r.registerEvent(a,e[a]);this.addChild(r)}return r}return null},e.prototype.draw=function(t){this.clear(),this.drawImp(t)},e}(ke),ji=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.drawImp=function(t){var e,i,n=this.getWidget(),o=this.getWidget().getPane(),r=o.getChart(),a=n.getBounding(),s=r.getStyles().grid;if(s.show){t.save(),t.globalCompositeOperation="destination-over";var l=s.horizontal;if(l.show){var c=o.getAxisComponent().getTicks().map((function(t){return{coordinates:[{x:0,y:t.coord},{x:a.width,y:t.coord}]}}));null===(e=this.createFigure({name:"line",attrs:c,styles:l}))||void 0===e||e.draw(t)}var u=s.vertical;if(u.show){c=r.getXAxisPane().getAxisComponent().getTicks().map((function(t){return{coordinates:[{x:t.coord,y:0},{x:t.coord,y:a.height}]}}));null===(i=this.createFigure({name:"line",attrs:c,styles:u}))||void 0===i||i.draw(t)}t.restore()}},e}(Gi),Ki=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.eachChildren=function(t){var e=this.getWidget().getPane().getChart().getChartStore(),i=e.getVisibleDataList(),n=e.getTimeScaleStore().getBarSpace();i.forEach((function(e,i){t(e,n,i)}))},e}(Gi);var Zi=function(e){function n(){var i=null!==e&&e.apply(this,arguments)||this;return i._boundCandleBarClickEvent=function(e){return function(){return i.getWidget().getPane().getChart().getChartStore().getActionStore().execute(t.ActionType.OnCandleBarClick,e),!1}},i}return i(n,e),n.prototype.drawImp=function(e){var i=this,n=this.getWidget().getPane(),o=n.getId()===li,r=n.getChart().getChartStore(),a=this.getCandleBarOptions(r);if(null!==a){var s=n.getAxisComponent();this.eachChildren((function(n,l){var c=r.getDataList(),u=n.data,h=n.x;if(R(u)){var d=u.open,p=u.high,g=u.low,v=u.close,f=a.type,y=a.styles,m=function(t,e,i){var n=[];if(t<2)close>=open?(n[0]=i.upColor,n[1]=i.upBorderColor,n[2]=i.upWickColor):(n[0]=i.downColor,n[1]=i.downBorderColor,n[2]=i.downWickColor);else{var o=e[t],r=e[t-1],a=e[t-2];o.close===r.close?r.close>a.close?(n[0]=i.upColor,n[1]=i.upBorderColor,n[2]=i.upWickColor):(n[0]=i.downColor,n[1]=i.downBorderColor,n[2]=i.downWickColor):o.close>r.close?(n[0]=i.upColor,n[1]=i.upBorderColor,n[2]=i.upWickColor):(n[0]=i.downColor,n[1]=i.downBorderColor,n[2]=i.downWickColor)}return n}(n.dataIndex,c,y),x=s.convertToPixel(d),_=s.convertToPixel(v),S=[x,_,s.convertToPixel(p),s.convertToPixel(g)];S.sort((function(t,e){return t-e}));var w=[];switch(f){case t.CandleType.Renko:case t.CandleType.CandleSolid:w=i._createSolidBar(h,S,l,m);break;case t.CandleType.CandleStroke:w=i._createStrokeBar(h,S,l,m);break;case t.CandleType.Ohlc:var b=Math.min(Math.max(Math.round(.2*l.gapBar),1),7);w=[{name:"rect",attrs:[{x:h-b/2,y:S[0],width:b,height:S[3]-S[0]},{x:h-l.halfGapBar,y:x+b>S[3]?S[3]-b:x,width:l.halfGapBar-b/2,height:b},{x:h+b/2,y:_+b>S[3]?S[3]-b:_,width:l.halfGapBar-b/2,height:b}],styles:{color:m[0]}}]}w.forEach((function(t){var r,a;o&&(a={mouseClickEvent:i._boundCandleBarClickEvent(n)}),null===(r=i.createFigure(t,a))||void 0===r||r.draw(e)}))}}))}},n.prototype.getCandleBarOptions=function(t){var e=t.getStyles().candle;return{type:e.type,styles:e.bar}},n.prototype._createSolidBar=function(e,i,n,o){return[{name:"rect",attrs:{x:e-.5,y:i[0],width:1,height:i[3]-i[0]},styles:{color:o[2]}},{name:"rect",attrs:{x:e-n.halfGapBar+.5,y:i[1],width:n.gapBar-1,height:Math.max(1,i[2]-i[1])},styles:{style:t.PolygonType.StrokeFill,color:o[0],borderColor:o[1]}}]},n.prototype._createStrokeBar=function(e,i,n,o){return[{name:"rect",attrs:[{x:e-.5,y:i[0],width:1,height:i[1]-i[0]},{x:e-.5,y:i[2],width:1,height:i[3]-i[2]}],styles:{color:o[2]}},{name:"rect",attrs:{x:e-n.halfGapBar+.5,y:i[1],width:n.gapBar-1,height:Math.max(1,i[2]-i[1])},styles:{style:t.PolygonType.Stroke,borderColor:o[1]}}]},n}(Ki),qi=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return i(n,e),n.prototype.getCandleBarOptions=function(e){var i,n,o=this.getWidget().getPane();if(!o.getAxisComponent().isInCandle()){var r=e.getIndicatorStore().getInstances(o.getId());try{for(var s=a(r),l=s.next();!l.done;l=s.next()){var c=l.value;if(c.shouldOhlc&&c.visible){var u=c.styles,h=e.getStyles().indicator,d=H(u,"ohlc.upColor",h.ohlc.upColor),p=H(u,"ohlc.downColor",h.ohlc.downColor),g=H(u,"ohlc.noChangeColor",h.ohlc.noChangeColor);return{type:t.CandleType.Ohlc,styles:{upColor:d,downColor:p,noChangeColor:g,upBorderColor:d,downBorderColor:p,noChangeBorderColor:g,upWickColor:d,downWickColor:p,noChangeWickColor:g}}}}}catch(t){i={error:t}}finally{try{l&&!l.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}}return null},n.prototype.drawImp=function(t){var i=this;e.prototype.drawImp.call(this,t);var n=this.getWidget(),o=n.getPane(),r=o.getChart(),a=n.getBounding(),s=r.getXAxisPane().getAxisComponent(),l=o.getAxisComponent(),c=r.getChartStore(),u=c.getDataList(),h=c.getTimeScaleStore(),d=h.getVisibleRange(),p=c.getIndicatorStore().getInstances(o.getId()),g=c.getStyles().indicator;t.save(),p.forEach((function(e){var n;if(e.visible){e.zLevel<0?t.globalCompositeOperation="destination-over":t.globalCompositeOperation="source-over";var o=!1;if(null!==e.draw&&(t.save(),o=null!==(n=e.draw({ctx:t,kLineDataList:u,indicator:e,visibleRange:d,bounding:a,barSpace:h.getBarSpace(),defaultStyles:g,xAxis:s,yAxis:l}))&&void 0!==n&&n,t.restore()),!o){var r=e.result,c=[];i.eachChildren((function(n,o){var h,d,p,v=o.halfGapBar,f=o.gapBar,y=n.dataIndex,m=n.x,x=s.convertToPixel(y-1),_=s.convertToPixel(y+1),S=null!==(h=r[y-1])&&void 0!==h?h:{},w=null!==(d=r[y])&&void 0!==d?d:{},b=null!==(p=r[y+1])&&void 0!==p?p:{},T={x:x},C={x:m},P={x:_};e.figures.forEach((function(t){var e=t.key,i=S[e];B(i)&&(T[e]=l.convertToPixel(i));var n=w[e];B(n)&&(C[e]=l.convertToPixel(n));var o=b[e];B(o)&&(P[e]=l.convertToPixel(o))})),tt(u,e,y,g,(function(e,n,r){var u,h,d;if(R(w[e.key])){var p=C[e.key],g=null===(u=e.attrs)||void 0===u?void 0:u.call(e,{coordinate:{prev:T,current:C,next:P},bounding:a,barSpace:o,xAxis:s,yAxis:l});switch(e.type){case"circle":g={x:m,y:p,r:v};break;case"rect":case"bar":var y=void 0;y=(null==g?void 0:g.size)?g.size:f;var x=null!==(h=e.baseValue)&&void 0!==h?h:l.getRange().from,_=l.convertToPixel(x),S=Math.abs(_-p);x!==w[e.key]&&(S=Math.max(1,S));g={x:m-v,y:p>_?_:p,width:y,height:S};break;case"line":R(c[r])||(c[r]=[]),B(C[e.key])&&B(P[e.key])&&c[r].push({coordinates:[{x:C.x,y:C[e.key]},{x:P.x,y:P[e.key]}],styles:n})}var b=e.type;R(g)&&"line"!==b&&(null===(d=i.createFigure({name:"bar"===b?"rect":b,attrs:g,styles:n}))||void 0===d||d.draw(t))}}))})),c.forEach((function(e){if(e.length>1){for(var n=[{coordinates:[e[0].coordinates[0],e[0].coordinates[1]],styles:e[0].styles}],o=1;o<e.length;o++){var r=n[n.length-1],a=e[o],s=r.coordinates[r.coordinates.length-1];s.x===a.coordinates[0].x&&s.y===a.coordinates[0].y&&r.styles.style===a.styles.style&&r.styles.color===a.styles.color&&r.styles.size===a.styles.size&&r.styles.smooth===a.styles.smooth&&r.styles.dashedValue[0]===a.styles.dashedValue[0]&&r.styles.dashedValue[1]===a.styles.dashedValue[1]?r.coordinates.push(a.coordinates[1]):n.push({coordinates:[a.coordinates[0],a.coordinates[1]],styles:a.styles})}n.forEach((function(e){var n,o=e.coordinates,r=e.styles;null===(n=i.createFigure({name:"line",attrs:{coordinates:o},styles:r}))||void 0===n||n.draw(t)}))}}))}}})),t.restore()},n}(Zi),Qi=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.drawImp=function(t){var e=this.getWidget(),i=e.getPane(),n=e.getBounding(),o=e.getPane().getChart().getChartStore(),r=o.getTooltipStore().getCrosshair(),a=o.getStyles().crosshair;if(O(r.paneId)&&a.show){if(r.paneId===i.getId()){var s=r.y;this._drawLine(t,[{x:0,y:s},{x:n.width,y:s}],a.horizontal)}var l=r.realX;this._drawLine(t,[{x:l,y:0},{x:l,y:n.height}],a.vertical)}},e.prototype._drawLine=function(t,e,i){var n;if(i.show){var o=i.line;o.show&&(null===(n=this.createFigure({name:"line",attrs:{coordinates:e},styles:o}))||void 0===n||n.draw(t))}},e}(Gi),$i=function(e){function o(){var i=null!==e&&e.apply(this,arguments)||this;return i._boundIconClickEvent=function(e){return function(){return i.getWidget().getPane().getChart().getChartStore().getActionStore().execute(t.ActionType.OnTooltipIconClick,n({},e)),!0}},i._boundIconMouseMoveEvent=function(t){return function(){return i.getWidget().getPane().getChart().getChartStore().getTooltipStore().setActiveIcon(n({},t)),!0}},i}return i(o,e),o.prototype.drawImp=function(t){var e=this.getWidget(),i=e.getPane(),n=i.getChart().getChartStore(),o=n.getTooltipStore().getCrosshair();if(R(o.kLineData)){var r=e.getBounding(),a=n.getCustomApi(),s=n.getThousandsSeparator(),l=n.getDecimalFoldThreshold(),c=n.getIndicatorStore().getInstances(i.getId()),u=n.getTooltipStore().getActiveIcon(),h=n.getStyles().indicator,d=h.tooltip,p=d.offsetLeft,g=d.offsetTop,v=d.offsetRight;this.drawIndicatorTooltip(t,i.getId(),n.getDataList(),o,u,c,a,s,l,p,g,r.width-v,h)}},o.prototype.drawIndicatorTooltip=function(t,e,i,n,o,r,a,l,c,u,h,d,p){var g=this,v=p.tooltip;if(this.isDrawTooltip(n,v)){var f=v.text;r.forEach((function(r){var y=0,m={x:u,y:h},x=g.getIndicatorTooltipData(i,n,r,a,l,c,p),_=x.name,S=x.calcParamsText,w=x.values,b=x.icons,T=_.length>0,C=w.length>0;if(T||C){var P=s(g.classifyTooltipIcons(b),3),I=P[0],D=P[1],E=P[2];if(y=g.drawStandardTooltipIcons(t,o,I,m,e,r.name,u,y,d),T){var M=_;S.length>0&&(M="".concat(M).concat(S)),y=g.drawStandardTooltipLegends(t,[{title:{text:"",color:f.color},value:{text:M,color:f.color}}],m,u,y,d,f)}y=g.drawStandardTooltipIcons(t,o,D,m,e,r.name,u,y,d),C&&(y=g.drawStandardTooltipLegends(t,w,m,u,y,d,v.text)),y=g.drawStandardTooltipIcons(t,o,E,m,e,r.name,u,y,d),h=m.y+y}}))}return h},o.prototype.drawStandardTooltipIcons=function(t,e,i,n,o,r,a,s,l){var c=this;if(i.length>0){var u=0,h=0;i.forEach((function(e){var i=e.marginLeft,n=void 0===i?0:i,o=e.marginTop,r=void 0===o?0:o,a=e.marginRight,s=void 0===a?0:a,l=e.marginBottom,c=void 0===l?0:l,d=e.paddingLeft,p=void 0===d?0:d,g=e.paddingTop,v=void 0===g?0:g,f=e.paddingRight,y=void 0===f?0:f,m=e.paddingBottom,x=void 0===m?0:m,_=e.size,S=e.fontFamily,w=e.icon;t.font=q(_,"normal",S),u+=n+p+t.measureText(w).width+y+s,h=Math.max(h,r+v+_+x+c)})),n.x+u>l?(n.x=a,n.y+=s,s=h):s=Math.max(s,h),i.forEach((function(i){var a,s=i.marginLeft,l=void 0===s?0:s,u=i.marginTop,h=void 0===u?0:u,d=i.marginRight,p=void 0===d?0:d,g=i.paddingLeft,v=void 0===g?0:g,f=i.paddingTop,y=void 0===f?0:f,m=i.paddingRight,x=void 0===m?0:m,_=i.paddingBottom,S=void 0===_?0:_,w=i.color,b=i.activeColor,T=i.size,C=i.fontFamily,P=i.icon,I=i.backgroundColor,D=i.activeBackgroundColor,E=(null==e?void 0:e.paneId)===o&&(null==e?void 0:e.indicatorName)===r&&(null==e?void 0:e.iconId)===i.id;null===(a=c.createFigure({name:"text",attrs:{text:P,x:n.x+l,y:n.y+h},styles:{paddingLeft:v,paddingTop:y,paddingRight:x,paddingBottom:S,color:E?b:w,size:T,family:C,backgroundColor:E?D:I}},{mouseClickEvent:c._boundIconClickEvent({paneId:o,indicatorName:r,iconId:i.id}),mouseMoveEvent:c._boundIconMouseMoveEvent({paneId:o,indicatorName:r,iconId:i.id})}))||void 0===a||a.draw(t),n.x+=l+v+t.measureText(P).width+x+p}))}return s},o.prototype.drawStandardTooltipLegends=function(t,e,i,n,o,r,a){var s=this;if(e.length>0){var l=a.marginLeft,c=a.marginTop,u=a.marginRight,h=a.marginBottom,d=a.size,p=a.family,g=a.weight;t.font=q(d,g,p),e.forEach((function(e){var a,v,f=e.title,y=e.value,m=t.measureText(f.text).width,x=m+t.measureText(y.text).width,_=c+d+h;i.x+l+x+u>r?(i.x=n,i.y+=o,o=_):o=Math.max(o,_),f.text.length>0&&(null===(a=s.createFigure({name:"text",attrs:{x:i.x+l,y:i.y+c,text:f.text},styles:{color:f.color,size:d,family:p,weight:g}}))||void 0===a||a.draw(t)),null===(v=s.createFigure({name:"text",attrs:{x:i.x+l+m,y:i.y+c,text:y.text},styles:{color:y.color,size:d,family:p,weight:g}}))||void 0===v||v.draw(t),i.x+=l+x+u}))}return o},o.prototype.isDrawTooltip=function(e,i){var n=i.showRule;return n===t.TooltipShowRule.Always||n===t.TooltipShowRule.FollowCross&&O(e.paneId)},o.prototype.getIndicatorTooltipData=function(t,e,i,n,o,r,a){var s,l,c=a.tooltip,u=c.showName?i.shortName:"",h="",d=i.calcParams;d.length>0&&c.showParams&&(h="(".concat(d.join(","),")"));var p={name:u,calcParamsText:h,values:[],icons:c.icons},g=e.dataIndex,v=null!==(s=i.result)&&void 0!==s?s:[],f=[];if(i.visible){var y=null!==(l=v[g])&&void 0!==l?l:{};tt(t,i,g,a,(function(t,e){if(O(t.title)){var a=e.color,s=y[t.key];B(s)&&(s=U(s,i.precision),i.shouldFormatBigNumber&&(s=n.formatBigNumber(s))),f.push({title:{text:t.title,color:a},value:{text:K(j(null!=s?s:c.defaultValue,o),r),color:a}})}})),p.values=f}if(null!==i.createTooltipDataSource){var m=this.getWidget(),x=m.getPane(),_=x.getChart().getChartStore(),S=i.createTooltipDataSource({kLineDataList:t,indicator:i,visibleRange:_.getTimeScaleStore().getVisibleRange(),bounding:m.getBounding(),crosshair:e,defaultStyles:a,xAxis:x.getChart().getXAxisPane().getAxisComponent(),yAxis:x.getAxisComponent()}),w=S.name,b=S.calcParamsText,T=S.values,C=S.icons;if(O(w)&&c.showName&&(p.name=w),O(b)&&c.showParams&&(p.calcParamsText=b),R(C)&&(p.icons=C),R(T)&&i.visible){var P=[],I=a.tooltip.text.color;T.forEach((function(t){var e={text:"",color:I};L(t.title)?e=t.title:e.text=t.title;var i={text:"",color:I};L(t.value)?i=t.value:i.text=t.value,i.text=K(j(i.text,o),r),P.push({title:e,value:i})})),p.values=P}}return p},o.prototype.classifyTooltipIcons=function(e){var i=[],n=[],o=[];return e.forEach((function(e){switch(e.position){case t.TooltipIconPosition.Left:i.push(e);break;case t.TooltipIconPosition.Middle:n.push(e);break;case t.TooltipIconPosition.Right:o.push(e)}})),[i,n,o]},o}(Gi),Ji=function(e){function o(t){var i=e.call(this,t)||this;return i._initEvent(),i}return i(o,e),o.prototype._initEvent=function(){var t=this,e=this.getWidget().getPane(),i=e.getId(),o=e.getChart().getChartStore().getOverlayStore();this.registerEvent("mouseMoveEvent",(function(r){var a,s=o.getProgressInstanceInfo();if(null!==s){var l=s.instance,c=s.paneId;l.isStart()&&(o.updateProgressInstanceInfo(i),c=i);var u=l.points.length-1,h="".concat(rt,"point_").concat(u);if(l.isDrawing()&&c===i){var d=e.getChart().getChartStore().getDataList();l.eventMoveForDrawing(t._coordinateToPoint(s.instance,r),d),null===(a=l.onDrawing)||void 0===a||a.call(l,n({overlay:l,figureKey:h,figureIndex:u},r))}return t._figureMouseMoveEvent(l,1,h,u,0)(r)}return o.setHoverInstanceInfo({paneId:i,instance:null,figureType:0,figureKey:"",figureIndex:-1,attrsIndex:-1},r),!1})).registerEvent("mouseClickEvent",(function(r){var a,s,l=o.getProgressInstanceInfo();if(null!==l){var c=l.instance,u=l.paneId;c.isStart()&&(o.updateProgressInstanceInfo(i,!0),u=i);var h=c.points.length-1,d="".concat(rt,"point_").concat(h);if(c.isDrawing()&&u===i){var p=e.getChart().getChartStore().getDataList();c.eventMoveForDrawing(t._coordinateToPoint(c,r),p),null===(a=c.onDrawing)||void 0===a||a.call(c,n({overlay:c,figureKey:d,figureIndex:h},r)),c.nextStep(),c.isDrawing()||(o.progressInstanceComplete(),null===(s=c.onDrawEnd)||void 0===s||s.call(c,n({overlay:c,figureKey:d,figureIndex:h},r)))}return t._figureMouseClickEvent(c,1,d,h,0)(r)}return o.setClickInstanceInfo({paneId:i,instance:null,figureType:0,figureKey:"",figureIndex:-1,attrsIndex:-1},r),!1})).registerEvent("mouseDoubleClickEvent",(function(e){var r,a=o.getProgressInstanceInfo();if(null!==a){var s=a.instance,l=a.paneId;if(s.isDrawing()&&l===i&&(s.forceComplete(),!s.isDrawing())){o.progressInstanceComplete();var c=s.points.length-1,u="".concat(rt,"point_").concat(c);null===(r=s.onDrawEnd)||void 0===r||r.call(s,n({overlay:s,figureKey:u,figureIndex:c},e))}var h=s.points.length-1;return t._figureMouseClickEvent(s,1,"".concat(rt,"point_").concat(h),h,0)(e)}return!1})).registerEvent("mouseRightClickEvent",(function(e){var i=o.getProgressInstanceInfo();if(null!==i){var n=i.instance;if(n.isDrawing()){var r=n.points.length-1;return t._figureMouseRightClickEvent(n,1,"".concat(rt,"point_").concat(r),r,0)(e)}}return!1})).registerEvent("mouseUpEvent",(function(t){var e,r=o.getPressedInstanceInfo(),a=r.instance,s=r.figureIndex,l=r.figureKey;return null!==a&&(null===(e=a.onPressedMoveEnd)||void 0===e||e.call(a,n({overlay:a,figureKey:l,figureIndex:s},t))),o.setPressedInstanceInfo({paneId:i,instance:null,figureType:0,figureKey:"",figureIndex:-1,attrsIndex:-1}),!1})).registerEvent("pressedMouseMoveEvent",(function(i){var r,a,s=o.getPressedInstanceInfo(),l=s.instance,c=s.figureType,u=s.figureIndex,h=s.figureKey;if(null!==l){if(!(l.lock||null!==(a=null===(r=l.onPressedMoving)||void 0===r?void 0:r.call(l,n({overlay:l,figureIndex:u,figureKey:h},i)))&&void 0!==a&&a)){var d=t._coordinateToPoint(l,i);if(1===c){var p=e.getChart().getChartStore().getDataList();l.eventPressedPointMove(d,u,p)}else l.eventPressedOtherMove(d,t.getWidget().getPane().getChart().getChartStore().getTimeScaleStore())}return!0}return!1}))},o.prototype._createFigureEvents=function(t,e,i,n,o,r){var a;if(!t.isDrawing()){var s=[];if(R(r)&&(V(r)?r&&(s=["mouseClickEvent","mouseDoubleClickEvent","mouseRightClickEvent","tapEvent","doubleTapEvent","mouseDownEvent","touchStartEvent","mouseMoveEvent","touchMoveEvent"]):s=r),0===s.length)return{mouseMoveEvent:this._figureMouseMoveEvent(t,e,i,n,o),mouseDownEvent:this._figureMouseDownEvent(t,e,i,n,o),mouseClickEvent:this._figureMouseClickEvent(t,e,i,n,o),mouseRightClickEvent:this._figureMouseRightClickEvent(t,e,i,n,o),mouseDoubleClickEvent:this._figureMouseDoubleClickEvent(t,e,i,n,o)};a={},s.includes("mouseMoveEvent")||s.includes("touchMoveEvent")||(a.mouseMoveEvent=this._figureMouseMoveEvent(t,e,i,n,o)),s.includes("mouseDownEvent")||s.includes("touchStartEvent")||(a.mouseDownEvent=this._figureMouseDownEvent(t,e,i,n,o)),s.includes("mouseClickEvent")||s.includes("tapEvent")||(a.mouseClickEvent=this._figureMouseClickEvent(t,e,i,n,o)),s.includes("mouseDoubleClickEvent")||s.includes("doubleTapEvent")||(a.mouseDoubleClickEvent=this._figureMouseDoubleClickEvent(t,e,i,n,o)),s.includes("mouseRightClickEvent")||(a.mouseRightClickEvent=this._figureMouseRightClickEvent(t,e,i,n,o))}return a},o.prototype._figureMouseMoveEvent=function(t,e,i,n,o){var r=this;return function(a){var s=r.getWidget().getPane();return s.getChart().getChartStore().getOverlayStore().setHoverInstanceInfo({paneId:s.getId(),instance:t,figureType:e,figureKey:i,figureIndex:n,attrsIndex:o},a),!0}},o.prototype._figureMouseDownEvent=function(t,e,i,o,r){var a=this;return function(s){var l,c=a.getWidget().getPane(),u=c.getId(),h=c.getChart().getChartStore().getOverlayStore();return t.startPressedMove(a._coordinateToPoint(t,s)),null===(l=t.onPressedMoveStart)||void 0===l||l.call(t,n({overlay:t,figureIndex:o,figureKey:i},s)),h.setPressedInstanceInfo({paneId:u,instance:t,figureType:e,figureKey:i,figureIndex:o,attrsIndex:r}),!0}},o.prototype._figureMouseClickEvent=function(t,e,i,n,o){var r=this;return function(a){var s=r.getWidget().getPane(),l=s.getId();return s.getChart().getChartStore().getOverlayStore().setClickInstanceInfo({paneId:l,instance:t,figureType:e,figureKey:i,figureIndex:n,attrsIndex:o},a),!0}},o.prototype._figureMouseDoubleClickEvent=function(t,e,i,o,r){return function(e){var r;return null===(r=t.onDoubleClick)||void 0===r||r.call(t,n(n({},e),{figureIndex:o,figureKey:i,overlay:t})),!0}},o.prototype._figureMouseRightClickEvent=function(t,e,i,o,r){return function(e){var r;return null===(r=t.onRightClick)||void 0===r||r.call(t,n({overlay:t,figureIndex:o,figureKey:i},e)),!0}},o.prototype._coordinateToPoint=function(e,i){var n,o={},r=this.getWidget().getPane(),a=r.getChart(),s=r.getId(),l=a.getChartStore().getTimeScaleStore();if(this.coordinateToPointTimestampDataIndexFlag()){var c=a.getXAxisPane().getAxisComponent().convertFromPixel(i.x),u=null!==(n=l.dataIndexToTimestamp(c))&&void 0!==n?n:void 0;o.dataIndex=c,o.timestamp=u}if(this.coordinateToPointValueFlag()){var h=r.getAxisComponent(),d=h.convertFromPixel(i.y);if(e.mode!==t.OverlayMode.Normal&&s===li&&B(o.dataIndex)){var p=l.getDataByDataIndex(o.dataIndex);if(null!==p){var g=e.modeSensitivity;if(d>p.high)if(e.mode===t.OverlayMode.WeakMagnet){var v=h.convertToPixel(p.high);d<h.convertFromPixel(v-g)&&(d=p.high)}else d=p.high;else if(d<p.low)if(e.mode===t.OverlayMode.WeakMagnet){var f=h.convertToPixel(p.low);d>h.convertFromPixel(f-g)&&(d=p.low)}else d=p.low;else{var y=Math.max(p.open,p.close),m=Math.min(p.open,p.close);d=d>y?d-y<p.high-d?y:p.high:d<m?d-p.low<m-d?p.low:m:y-d<d-m?y:m}}}o.value=d}return o},o.prototype.coordinateToPointValueFlag=function(){return!0},o.prototype.coordinateToPointTimestampDataIndexFlag=function(){return!0},o.prototype.dispatchEvent=function(t,i,n){return this.getWidget().getPane().getChart().getChartStore().getOverlayStore().isDrawing()?this.onEvent(t,i,n):e.prototype.dispatchEvent.call(this,t,i,n)},o.prototype.checkEventOn=function(){return!0},o.prototype.drawImp=function(t){var e=this,i=this.getWidget(),o=i.getPane(),r=o.getId(),a=o.getChart(),s=o.getAxisComponent(),l=a.getXAxisPane().getAxisComponent(),c=i.getBounding(),u=a.getChartStore(),h=u.getCustomApi(),d=u.getThousandsSeparator(),p=u.getDecimalFoldThreshold(),g=u.getTimeScaleStore(),v=g.getDateTimeFormat(),f=g.getBarSpace(),y=u.getPrecision(),m=u.getStyles().overlay,x=u.getOverlayStore(),_=x.getHoverInstanceInfo(),S=x.getClickInstanceInfo(),w=this.getCompleteOverlays(x,r),b=u.getIndicatorStore().getInstances(r).reduce((function(t,e){var i=e.precision;return t[e.name]=i,t.max=Math.max(t.max,i),t.min=Math.min(t.min,i),t.excludePriceVolumeMax=Math.max(t.excludePriceVolumeMax,i),t.excludePriceVolumeMin=Math.min(t.excludePriceVolumeMin,i),t}),n(n({},y),{max:Math.max(y.price,y.volume),min:Math.min(y.price,y.volume),excludePriceVolumeMax:Number.MIN_SAFE_INTEGER,excludePriceVolumeMin:Number.MAX_SAFE_INTEGER}));w.forEach((function(i){i.visible&&e._drawOverlay(t,i,c,f,b,v,h,d,p,m,l,s,_,S,g)}));var T=x.getProgressInstanceInfo();if(null!==T){var C=this.getProgressOverlay(T,r);null!==C&&C.visible&&this._drawOverlay(t,C,c,f,b,v,h,d,p,m,l,s,_,S,g)}},o.prototype._drawOverlay=function(t,e,i,n,o,r,a,s,l,c,u,h,d,p,g){var v=e.points.map((function(t){var e,i,n=t.dataIndex;B(t.timestamp)&&(n=g.timestampToDataIndex(t.timestamp));var o={x:0,y:0};return B(n)&&(o.x=null!==(e=null==u?void 0:u.convertToPixel(n))&&void 0!==e?e:0),B(t.value)&&(o.y=null!==(i=null==h?void 0:h.convertToPixel(t.value))&&void 0!==i?i:0),o}));if(v.length>0){var f=(new Array).concat(this.getFigures(e,v,i,n,o,s,l,r,c,u,h));this.drawFigures(t,e,f,c)}this.drawDefaultFigures(t,e,v,i,o,r,a,s,l,c,u,h,d,p)},o.prototype.drawFigures=function(t,e,i,o){var r=this;i.forEach((function(i,a){var s=i.type,l=i.styles,c=i.attrs,u=i.ignoreEvent;[].concat(c).forEach((function(c,h){var d,p,g,v=r._createFigureEvents(e,2,null!==(d=i.key)&&void 0!==d?d:"",a,h,u),f=n(n(n({},o[s]),null===(p=e.styles)||void 0===p?void 0:p[s]),l);null===(g=r.createFigure({name:s,attrs:c,styles:f},v))||void 0===g||g.draw(t)}))}))},o.prototype.getCompleteOverlays=function(t,e){return t.getInstances(e)},o.prototype.getProgressOverlay=function(t,e){return t.paneId===e?t.instance:null},o.prototype.getFigures=function(t,e,i,n,o,r,a,s,l,c,u){var h,d;return null!==(d=null===(h=t.createPointFigures)||void 0===h?void 0:h.call(t,{overlay:t,coordinates:e,bounding:i,barSpace:n,precision:o,thousandsSeparator:r,decimalFoldThreshold:a,dateTimeFormat:s,defaultStyles:l,xAxis:c,yAxis:u}))&&void 0!==d?d:[]},o.prototype.drawDefaultFigures=function(t,e,i,o,r,a,s,l,c,u,h,d,p,g){var v,f,y=this;if(e.needDefaultPointFigure&&((null===(v=p.instance)||void 0===v?void 0:v.id)===e.id&&0!==p.figureType||(null===(f=g.instance)||void 0===f?void 0:f.id)===e.id&&0!==g.figureType)){var m=e.styles,x=n(n({},u.point),null==m?void 0:m.point);i.forEach((function(i,n){var o,r,a,s=i.x,l=i.y,c=x.radius,u=x.color,h=x.borderColor,d=x.borderSize;(null===(o=p.instance)||void 0===o?void 0:o.id)===e.id&&1===p.figureType&&p.figureIndex===n&&(c=x.activeRadius,u=x.activeColor,h=x.activeBorderColor,d=x.activeBorderSize),null===(r=y.createFigure({name:"circle",attrs:{x:s,y:l,r:c+d},styles:{color:h}},y._createFigureEvents(e,1,"".concat(rt,"point_").concat(n),n,0)))||void 0===r||r.draw(t),null===(a=y.createFigure({name:"circle",attrs:{x:s,y:l,r:c},styles:{color:u}}))||void 0===a||a.draw(t)}))}},o}(Gi),tn=function(t){function e(e,i){var n=t.call(this,e,i)||this;return n._gridView=new ji(n),n._indicatorView=new qi(n),n._crosshairLineView=new Qi(n),n._tooltipView=n.createTooltipView(),n._overlayView=new Ji(n),n.addChild(n._tooltipView),n.addChild(n._overlayView),n.registerEvent("mouseMoveEvent",(function(){return i.getChart().getChartStore().getTooltipStore().setActiveIcon(),!1})),n}return i(e,t),e.prototype.getName=function(){return yi},e.prototype.updateMain=function(t){this.updateMainContent(t),this._indicatorView.draw(t),this._gridView.draw(t)},e.prototype.createTooltipView=function(){return new $i(this)},e.prototype.updateMainContent=function(t){},e.prototype.updateOverlay=function(t){this._overlayView.draw(t),this._crosshairLineView.draw(t),this._tooltipView.draw(t)},e}(Pi),en=function(){function t(t){this._options={duration:500,iterationCount:1},this._currentIterationCount=0,this._running=!1,this._time=0,M(this._options,t)}return t.prototype._loop=function(){var t=this;this._running=!0;var e=function(){var i;if(t._running){var n=(new Date).getTime()-t._time;n<t._options.duration?(null===(i=t._doFrameCallback)||void 0===i||i.call(t,n),Si(e)):(t.stop(),t._currentIterationCount++,t._currentIterationCount<t._options.iterationCount&&t.start())}};Si(e)},t.prototype.doFrame=function(t){return this._doFrameCallback=t,this},t.prototype.setDuration=function(t){return this._options.duration=t,this},t.prototype.setIterationCount=function(t){return this._options.iterationCount=t,this},t.prototype.start=function(){this._running||(this._time=(new Date).getTime(),this._loop())},t.prototype.stop=function(){var t;this._running&&(null===(t=this._doFrameCallback)||void 0===t||t.call(this,this._options.duration)),this._running=!1},t}(),nn=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._ripplePoint=e.createFigure({name:"circle",attrs:{x:0,y:0,r:0},styles:{style:"fill"}}),e._animationFrameTime=0,e._animation=new en({iterationCount:1/0}).doFrame((function(t){e._animationFrameTime=t;var i=e.getWidget().getPane();i.getChart().updatePane(0,i.getId())})),e}return i(e,t),e.prototype.drawImp=function(t){var e,i,n,o=this.getWidget(),r=o.getPane(),a=r.getChart(),s=a.getDataList().length-1,l=o.getBounding(),c=r.getAxisComponent(),u=a.getStyles().candle.area,h=[],d=Number.MAX_SAFE_INTEGER,p=Number.MIN_SAFE_INTEGER,g=null;if(this.eachChildren((function(t){var e=t.data,i=t.x,n=null==e?void 0:e[u.value];if(B(n)){var o=c.convertToPixel(n);p===Number.MIN_SAFE_INTEGER&&(p=i),h.push({x:i,y:o}),d=Math.min(d,o),t.dataIndex===s&&(g={x:i,y:o})}})),h.length>0){null===(e=this.createFigure({name:"line",attrs:{coordinates:h},styles:{color:u.lineColor,size:u.lineSize,smooth:u.smooth}}))||void 0===e||e.draw(t);var v=u.backgroundColor,f=void 0;if(A(v)){var y=t.createLinearGradient(0,l.height,0,d);try{v.forEach((function(t){var e=t.offset,i=t.color;y.addColorStop(e,i)}))}catch(t){console.log("CandleAreaView "+t.toString())}f=y}else f=v;t.fillStyle=f,t.beginPath(),t.moveTo(p,l.height),t.lineTo(h[0].x,h[0].y),Ve(t,h,u.smooth),t.lineTo(h[h.length-1].x,l.height),t.closePath(),t.fill()}var m=u.point;if(m.show&&R(g)){null===(i=this.createFigure({name:"circle",attrs:{x:g.x,y:g.y,r:m.radius},styles:{style:"fill",color:m.color}}))||void 0===i||i.draw(t);var x=m.rippleRadius;m.animation&&(x=m.radius+this._animationFrameTime/m.animationDuration*(m.rippleRadius-m.radius),this._animation.setDuration(m.animationDuration).start()),null===(n=this._ripplePoint)||void 0===n||n.setAttrs({x:g.x,y:g.y,r:x}).setStyles({style:"fill",color:m.rippleColor}).draw(t)}else this.stopAnimation()},e.prototype.stopAnimation=function(){this._animation.stop()},e}(Ki),on=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.drawImp=function(t){var e=this.getWidget().getPane(),i=e.getChart().getChartStore(),n=i.getStyles().candle.priceMark,o=n.high,r=n.low;if(n.show&&(o.show||r.show)){var a=i.getThousandsSeparator(),s=i.getDecimalFoldThreshold(),l=i.getPrecision(),c=e.getAxisComponent(),u=Number.MIN_SAFE_INTEGER,h=0,d=Number.MAX_SAFE_INTEGER,p=0;this.eachChildren((function(t){var e=t.data,i=t.x;R(e)&&(u<e.high&&(u=e.high,h=i),d>e.low&&(d=e.low,p=i))}));var g=c.convertToPixel(u),v=c.convertToPixel(d);o.show&&u!==Number.MIN_SAFE_INTEGER&&this._drawMark(t,K(j(U(u,l.price),a),s),{x:h,y:g},g<v?[-2,-5]:[2,5],o),r.show&&d!==Number.MAX_SAFE_INTEGER&&this._drawMark(t,K(j(U(d,l.price),a),s),{x:p,y:v},g<v?[2,5]:[-2,-5],r)}},e.prototype._drawMark=function(t,e,i,n,o){var r,a,s,l,c,u,h=i.x,d=i.y+n[0];null===(r=this.createFigure({name:"line",attrs:{coordinates:[{x:h-2,y:d+n[0]},{x:h,y:d},{x:h+2,y:d+n[0]}]},styles:{color:o.color}}))||void 0===r||r.draw(t),h>this.getWidget().getBounding().width/2?(c=(l=h-5)-o.textOffset,u="right"):(u="left",c=(l=h+5)+o.textOffset);var p=d+n[1];null===(a=this.createFigure({name:"line",attrs:{coordinates:[{x:h,y:d},{x:h,y:p},{x:l,y:p}]},styles:{color:o.color}}))||void 0===a||a.draw(t),null===(s=this.createFigure({name:"text",attrs:{x:c,y:p,text:e,align:u,baseline:"middle"},styles:{color:o.color,size:o.textSize,family:o.textFamily,weight:o.textWeight}}))||void 0===s||s.draw(t)},e}(Ki),rn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.drawImp=function(t){var e,i=this.getWidget(),n=i.getPane(),o=i.getBounding(),r=n.getChart().getChartStore(),a=r.getStyles().candle.priceMark,s=a.last,l=s.line;if(a.show&&s.show&&l.show){var c=n.getAxisComponent(),u=r.getDataList(),h=u[u.length-1];if(null!=h){var d=h.close,p=h.open,g=c.convertToNicePixel(d),v=void 0;v=d>p?s.upColor:d<p?s.downColor:s.noChangeColor,null===(e=this.createFigure({name:"line",attrs:{coordinates:[{x:0,y:g},{x:o.width,y:g}]},styles:{style:l.style,color:v,size:l.size,dashedValue:l.dashedValue}}))||void 0===e||e.draw(t)}}},e}(Gi),an={"zh-CN":{time:"",open:"",high:"",low:"",close:"",volume:"",turnover:"",change:""},"en-US":{time:"Time: ",open:"Open: ",high:"High: ",low:"Low: ",close:"Close: ",volume:"Volume: ",turnover:"Turnover: ",change:"Change: "}};var sn=function(e){function o(){return null!==e&&e.apply(this,arguments)||this}return i(o,e),o.prototype.drawImp=function(e){var i=this.getWidget(),n=i.getPane(),o=n.getId(),r=n.getChart().getChartStore(),a=r.getTooltipStore().getCrosshair();if(R(a.kLineData)){var s=i.getBounding(),l=n.getYAxisWidget().getBounding(),c=r.getDataList(),u=r.getPrecision(),h=r.getLocale(),d=r.getCustomApi(),p=r.getThousandsSeparator(),g=r.getDecimalFoldThreshold(),v=r.getTooltipStore().getActiveIcon(),f=r.getIndicatorStore().getInstances(n.getId()),y=r.getTimeScaleStore().getDateTimeFormat(),m=r.getStyles(),x=m.candle,_=m.indicator;if(x.tooltip.showType===t.TooltipShowType.Rect&&_.tooltip.showType===t.TooltipShowType.Rect){var S=this.isDrawTooltip(a,x.tooltip),w=this.isDrawTooltip(a,_.tooltip);this._drawRectTooltip(e,c,f,s,l,a,u,y,h,d,p,g,S,w,x.tooltip.offsetTop,m)}else if(x.tooltip.showType===t.TooltipShowType.Standard&&_.tooltip.showType===t.TooltipShowType.Standard){var b=x.tooltip,T=b.offsetLeft,C=b.offsetTop,P=b.offsetRight,I=s.width-P,D=this._drawCandleStandardTooltip(e,c,o,a,v,u,y,h,d,p,g,T,C,I,x);this.drawIndicatorTooltip(e,o,c,a,v,f,d,p,g,T,D,I,_)}else if(x.tooltip.showType===t.TooltipShowType.Rect&&_.tooltip.showType===t.TooltipShowType.Standard){var E=x.tooltip,M=(T=E.offsetLeft,C=E.offsetTop,P=E.offsetRight,I=s.width-P,this.drawIndicatorTooltip(e,o,c,a,v,f,d,p,g,T,C,I,_));S=this.isDrawTooltip(a,x.tooltip);this._drawRectTooltip(e,c,f,s,l,a,u,y,h,d,p,g,S,!1,M,m)}else{var k=x.tooltip,A=(T=k.offsetLeft,C=k.offsetTop,P=k.offsetRight,I=s.width-P,this._drawCandleStandardTooltip(e,c,o,a,v,u,y,h,d,p,g,T,C,I,x));w=this.isDrawTooltip(a,_.tooltip);this._drawRectTooltip(e,c,f,s,l,a,u,y,h,d,p,g,!1,w,A,m)}}},o.prototype._drawCandleStandardTooltip=function(t,e,i,n,o,r,a,l,c,u,h,d,p,g,v){var f,y,m,x=v.tooltip,_=x.text,S=0,w={x:d,y:p};if(this.isDrawTooltip(n,x)){var b=null!==(f=n.dataIndex)&&void 0!==f?f:0,T=this._getCandleTooltipLegends({prev:null!==(y=e[b-1])&&void 0!==y?y:null,current:n.kLineData,next:null!==(m=e[b+1])&&void 0!==m?m:null},r,a,l,c,u,h,v),C=s(this.classifyTooltipIcons(x.icons),3),P=C[0],I=C[1],D=C[2];S=this.drawStandardTooltipIcons(t,o,P,w,i,"",d,S,g),S=this.drawStandardTooltipIcons(t,o,I,w,i,"",d,S,g),T.length>0&&(S=this.drawStandardTooltipLegends(t,T,w,d,S,g,_)),S=this.drawStandardTooltipIcons(t,o,D,w,i,"",d,S,g)}return w.y+S},o.prototype._drawRectTooltip=function(e,i,n,o,r,a,s,l,c,u,h,d,p,v,f,y){var m,x,_,S,w,b=this,T=y.candle,C=y.indicator,P=T.tooltip,I=C.tooltip;if(p||v){var D=null!==(m=a.dataIndex)&&void 0!==m?m:0,E=this._getCandleTooltipLegends({prev:null!==(x=i[D-1])&&void 0!==x?x:null,current:a.kLineData,next:null!==(_=i[D+1])&&void 0!==_?_:null},s,l,c,u,h,d,T),M=P.offsetLeft,k=P.offsetTop,A=P.offsetRight,F=P.offsetBottom,L=P.text,B=L.marginLeft,R=L.marginRight,V=L.marginTop,O=L.marginBottom,N=L.size,W=L.weight,z=L.family,Y=P.rect,H=Y.position,X=Y.paddingLeft,U=Y.paddingRight,G=Y.paddingTop,j=Y.paddingBottom,K=Y.offsetLeft,Z=Y.offsetRight,Q=Y.offsetTop,$=Y.offsetBottom,J=Y.borderSize,tt=Y.borderRadius,et=Y.borderColor,it=Y.color,nt=0,ot=0,rt=0;p&&(e.font=q(N,W,z),E.forEach((function(t){var i=t.title,n=t.value,o="".concat(i.text).concat(n.text),r=e.measureText(o).width+B+R;nt=Math.max(nt,r)})),rt+=(O+V+N)*E.length);var at=I.text,st=at.marginLeft,lt=at.marginRight,ct=at.marginTop,ut=at.marginBottom,ht=at.size,dt=at.weight,pt=at.family,gt=[];if(v&&(e.font=q(ht,dt,pt),n.forEach((function(t){var n,o=null!==(n=b.getIndicatorTooltipData(i,a,t,u,h,d,C).values)&&void 0!==n?n:[];gt.push(o),o.forEach((function(t){var i=t.title,n=t.value,o="".concat(i.text).concat(n.text),r=e.measureText(o).width+st+lt;nt=Math.max(nt,r),rt+=ct+ut+ht}))}))),0!==(ot+=nt)&&0!==rt){ot+=2*J+X+U,rt+=2*J+G+j;var vt=o.width/2,ft=H===g.Pointer&&a.paneId===li,yt=(null!==(S=a.realX)&&void 0!==S?S:0)>vt,mt=0;if(ft){var xt=a.realX;mt=yt?xt-Z-ot:xt+K}else yt?(mt=K+M,y.yAxis.inside&&y.yAxis.position===t.YAxisPosition.Left&&(mt+=r.width)):(mt=o.width-Z-ot-A,y.yAxis.inside&&y.yAxis.position===t.YAxisPosition.Right&&(mt-=r.width));var _t=f+Q;if(ft)(_t=a.y-rt/2)+rt>o.height-$-F&&(_t=o.height-$-rt-F),_t<f+Q&&(_t=f+Q+k);null===(w=this.createFigure({name:"rect",attrs:{x:mt,y:_t,width:ot,height:rt},styles:{style:t.PolygonType.StrokeFill,color:it,borderColor:et,borderSize:J,borderRadius:tt}}))||void 0===w||w.draw(e);var St=mt+J+X+B,wt=_t+J+G;if(p&&E.forEach((function(t){var i,n;wt+=V;var o=t.title;null===(i=b.createFigure({name:"text",attrs:{x:St,y:wt,text:o.text},styles:{color:o.color,size:N,family:z,weight:W}}))||void 0===i||i.draw(e);var r=t.value;null===(n=b.createFigure({name:"text",attrs:{x:mt+ot-J-R-U,y:wt,text:r.text,align:"right"},styles:{color:r.color,size:N,family:z,weight:W}}))||void 0===n||n.draw(e),wt+=N+O})),v){var bt=mt+J+X+st;gt.forEach((function(t){t.forEach((function(t){var i,n;wt+=ct;var o=t.title,r=t.value;null===(i=b.createFigure({name:"text",attrs:{x:bt,y:wt,text:o.text},styles:{color:o.color,size:ht,family:pt,weight:dt}}))||void 0===i||i.draw(e),null===(n=b.createFigure({name:"text",attrs:{x:mt+ot-J-lt-U,y:wt,text:r.text,align:"right"},styles:{color:r.color,size:ht,family:pt,weight:dt}}))||void 0===n||n.draw(e),wt+=ht+ut}))}))}}}},o.prototype._getCandleTooltipLegends=function(e,i,o,r,a,s,l,c){var u,h,d,p,g,v=c.tooltip,f=v.text.color,y=e.current,m=null!==(h=null===(u=e.prev)||void 0===u?void 0:u.close)&&void 0!==h?h:y.close,x=y.close-m,_=i.price,S=i.volume,w={"{time}":a.formatDate(o,y.timestamp,"YYYY-MM-DD HH:mm",t.FormatDateType.Tooltip),"{open}":K(j(U(y.open,_),s),l),"{high}":K(j(U(y.high,_),s),l),"{low}":K(j(U(y.low,_),s),l),"{close}":K(j(U(y.close,_),s),l),"{volume}":K(j(a.formatBigNumber(U(null!==(d=y.volume)&&void 0!==d?d:v.defaultValue,S)),s),l),"{turnover}":K(j(U(null!==(p=y.turnover)&&void 0!==p?p:v.defaultValue,_),s),l),"{change}":0===m?v.defaultValue:"".concat(j(U(x/m*100),s),"%")};return(null!==(g=F(v.custom)?v.custom(e,c):v.custom)&&void 0!==g?g:[]).map((function(t){var e,i=t.title,o=t.value,a={text:"",color:""};L(i)?a=n({},i):(a.text=i,a.color=f),a.text=function(t,e){var i,n;return null!==(n=null===(i=an[e])||void 0===i?void 0:i[t])&&void 0!==n?n:t}(a.text,r);var s={text:v.defaultValue,color:""};L(o)?s=n({},o):(s.text=o,s.color=f);var l=s.text.match(/{(\S*)}/);if(null!==l&&l.length>1){var u="{".concat(l[1],"}");s.text=s.text.replace(u,null!==(e=w[u])&&void 0!==e?e:v.defaultValue),"{change}"===u&&(s.color=0===x?c.priceMark.last.noChangeColor:x>0?c.priceMark.last.upColor:c.priceMark.last.downColor)}return{title:a,value:s}}))},o}($i),ln=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.drawImp=function(t){var e=this,i=this.getWidget(),n=i.getPane().getChart().getChartStore(),o=i.getBounding(),r=n.getStyles().sessionBreak;this.eachChildren((function(i){var n,a=i.data;(i.x,R(a))&&(a.isStartOfSession&&(null===(n=e.createFigure({name:"line",attrs:{coordinates:[{x:i.x,y:0},{x:i.x,y:o.height}]},styles:{style:r.style,color:r.color,size:1,dashedValue:r.dashedValue}}))||void 0===n||n.draw(t)))}))},e}(Ki),cn=function(e){function n(t,i){var n=e.call(this,t,i)||this;return n._candleBarView=new Zi(n),n._candleAreaView=new nn(n),n._candleHighLowPriceView=new on(n),n._candleLastPriceLineView=new rn(n),n._sessionBreakView=new ln(n),n.addChild(n._candleBarView),n}return i(n,e),n.prototype.updateMainContent=function(e){var i=this.getPane().getChart().getStyles().candle,n=this.getPane().getChart().getChartStore(),o=n.getTradingSettings(),r=n.getTimeframeDuration();i.type!==t.CandleType.Area?(this._candleBarView.draw(e),this._candleHighLowPriceView.draw(e),this._candleAreaView.stopAnimation()):this._candleAreaView.draw(e),this._candleLastPriceLineView.draw(e),o.drawSessionBreak&&r>0&&this._sessionBreakView.draw(e)},n.prototype.createTooltipView=function(){return new sn(this)},n}(tn),un=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.drawImp=function(t){var e,i,n=this,o=this.getWidget(),r=o.getPane(),a=o.getBounding(),s=r.getAxisComponent(),l=this.getAxisStyles(r.getChart().getStyles());if(l.show){l.axisLine.show&&(null===(e=this.createFigure({name:"line",attrs:this.createAxisLine(a,l),styles:l.axisLine}))||void 0===e||e.draw(t));var c=s.getTicks();if(l.tickLine.show)this.createTickLines(c,a,l).forEach((function(e){var i;null===(i=n.createFigure({name:"line",attrs:e,styles:l.tickLine}))||void 0===i||i.draw(t)}));if(l.tickText.show){var u=this.createTickTexts(c,a,l);null===(i=this.createFigure({name:"text",attrs:u,styles:l.tickText}))||void 0===i||i.draw(t)}}},e}(Gi),hn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.getAxisStyles=function(t){return t.yAxis},e.prototype.createAxisLine=function(t,e){var i,n=this.getWidget().getPane().getAxisComponent(),o=e.axisLine.size;return{coordinates:[{x:i=n.isFromZero()?o/2:t.width-o,y:0},{x:i,y:t.height}]}},e.prototype.createTickLines=function(t,e,i){var n=this.getWidget().getPane().getAxisComponent(),o=i.axisLine,r=i.tickLine,a=0,s=0;return n.isFromZero()?(a=0,o.show&&(a+=o.size),s=a+r.length):(a=e.width,o.show&&(a-=o.size),s=a-r.length),t.map((function(t){return{coordinates:[{x:a,y:t.coord},{x:s,y:t.coord}]}}))},e.prototype.createTickTexts=function(t,e,i){var n=this.getWidget().getPane().getAxisComponent(),o=i.axisLine,r=i.tickLine,a=i.tickText,s=0;n.isFromZero()?(s=a.marginStart,o.show&&(s+=o.size),r.show&&(s+=r.length)):(s=e.width-a.marginEnd,o.show&&(s-=o.size),r.show&&(s-=r.length));var l=this.getWidget().getPane().getAxisComponent().isFromZero()?"left":"right";return t.map((function(t){return{x:s,y:t.coord,text:t.text,align:l,baseline:"middle"}}))},e}(un),dn=function(e){function o(){return null!==e&&e.apply(this,arguments)||this}return i(o,e),o.prototype.drawImp=function(e){var i,o=this.getWidget(),r=o.getPane(),a=o.getBounding(),s=r.getChart().getChartStore(),l=s.getStyles().candle.priceMark,c=l.last,u=c.text;if(l.show&&c.show&&u.show){var h=s.getPrecision(),d=r.getAxisComponent(),p=s.getDataList(),g=s.getVisibleDataList(),v=p[p.length-1];if(R(v)){var f=v.close,y=v.open,m=d.convertToNicePixel(f),x=void 0;x=f>y?c.upColor:f<y?c.downColor:c.noChangeColor;var _=void 0;if(d.getType()===t.YAxisType.Percentage){var S=g[0].data.close;_="".concat(((f-S)/S*100).toFixed(2),"%")}else _=U(f,h.price);_=K(j(_,s.getThousandsSeparator()),s.getDecimalFoldThreshold());var w=void 0,b=void 0;d.isFromZero()?(w=0,b="left"):(w=a.width,b="right"),null===(i=this.createFigure({name:"text",attrs:{x:w,y:m,text:_,align:b,baseline:"middle"},styles:n(n({},u),{backgroundColor:x})}))||void 0===i||i.draw(e)}}},o}(Gi),pn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.drawImp=function(t){var e=this,i=this.getWidget(),o=i.getPane(),r=i.getBounding(),a=o.getChart().getChartStore(),s=a.getCustomApi(),l=a.getStyles().indicator,c=l.lastValueMark,u=c.text;if(c.show){var h=o.getAxisComponent(),d=a.getDataList(),p=d.length-1,g=a.getIndicatorStore().getInstances(o.getId()),v=a.getThousandsSeparator(),f=a.getDecimalFoldThreshold();g.forEach((function(i){var o=i.result[p];if(R(o)&&i.visible){var a=i.precision;tt(d,i,p,l,(function(l,c){var d,p=o[l.key];if(B(p)){var g=h.convertToNicePixel(p),y=U(p,a);i.shouldFormatBigNumber&&(y=s.formatBigNumber(y)),y=K(j(y,v),f);var m=void 0,x=void 0;h.isFromZero()?(m=0,x="left"):(m=r.width,x="right"),null===(d=e.createFigure({name:"text",attrs:{x:m,y:g,text:y,align:x,baseline:"middle"},styles:n(n({},u),{backgroundColor:c.color})}))||void 0===d||d.draw(t)}}))}}))}},e}(Gi),gn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.coordinateToPointTimestampDataIndexFlag=function(){return!1},e.prototype.drawDefaultFigures=function(t,e,i,n,o,r,a,s,l,c,u,h,d,p){this.drawFigures(t,e,this.getDefaultFigures(e,i,n,o,r,a,s,l,u,h,p),c)},e.prototype.getDefaultFigures=function(t,e,i,n,o,r,a,s,l,c,u){var h,d,p=[];if(t.needDefaultYAxisFigure&&t.id===(null===(h=u.instance)||void 0===h?void 0:h.id)&&u.paneId===this.getWidget().getPane().getId()){var g,v,f=Number.MAX_SAFE_INTEGER,y=Number.MIN_SAFE_INTEGER;null!==(d=null==c?void 0:c.isFromZero())&&void 0!==d&&d?(g="left",v=0):(g="right",v=i.width),e.forEach((function(e,i){var o=t.points[i];if(B(o.value)){f=Math.min(f,e.y),y=Math.max(y,e.y);var r=K(j(U(o.value,n.price),a),s);p.push({type:"text",attrs:{x:v,y:e.y,text:r,align:g,baseline:"middle"},ignoreEvent:!0})}})),e.length>1&&p.unshift({type:"rect",attrs:{x:0,y:f,width:i.width,height:y-f},ignoreEvent:!0})}return p},e.prototype.getFigures=function(t,e,i,n,o,r,a,s,l,c,u){var h,d;return null!==(d=null===(h=t.createYAxisFigures)||void 0===h?void 0:h.call(t,{overlay:t,coordinates:e,bounding:i,barSpace:n,precision:o,thousandsSeparator:r,decimalFoldThreshold:a,dateTimeFormat:s,defaultStyles:l,xAxis:c,yAxis:u}))&&void 0!==d?d:[]},e}(Ji),vn=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return i(n,e),n.prototype.drawImp=function(t){var e,i=this.getWidget(),n=i.getPane(),o=i.getBounding(),r=i.getPane().getChart().getChartStore(),a=r.getTooltipStore().getCrosshair(),s=r.getStyles().crosshair;if(O(a.paneId)&&this.compare(a,n.getId())&&s.show){var l=this.getDirectionStyles(s),c=l.text;if(l.show&&c.show){var u=n.getAxisComponent(),h=this.getText(a,r,u);t.font=q(c.size,c.weight,c.family),null===(e=this.createFigure({name:"text",attrs:this.getTextAttrs(h,t.measureText(h).width,a,o,u,c),styles:c}))||void 0===e||e.draw(t)}}},n.prototype.compare=function(t,e){return t.paneId===e},n.prototype.getDirectionStyles=function(t){return t.horizontal},n.prototype.getText=function(e,i,n){var o,r,a=n,s=n.convertFromPixel(e.y);if(a.getType()===t.YAxisType.Percentage){var l=null===(o=i.getVisibleDataList()[0])||void 0===o?void 0:o.data;r="".concat(((s-l.close)/l.close*100).toFixed(2),"%")}else{var c=i.getIndicatorStore().getInstances(e.paneId),u=0,h=!1;a.isInCandle()?u=i.getPrecision().price:c.forEach((function(t){u=Math.max(t.precision,u),h||(h=t.shouldFormatBigNumber)})),r=U(s,u),h&&(r=i.getCustomApi().formatBigNumber(r))}return K(j(r,i.getThousandsSeparator()),i.getDecimalFoldThreshold())},n.prototype.getTextAttrs=function(t,e,i,n,o,r){var a,s;return o.isFromZero()?(a=0,s="left"):(a=n.width,s="right"),{x:a,y:i.y,text:t,align:s,baseline:"middle"}},n}(Gi),fn=function(t){function e(e,i){var n=t.call(this,e,i)||this;return n._yAxisView=new hn(n),n._candleLastPriceLabelView=new dn(n),n._indicatorLastValueView=new pn(n),n._overlayYAxisView=new gn(n),n._crosshairHorizontalLabelView=new vn(n),n.getContainer().style.cursor="ns-resize",n.addChild(n._overlayYAxisView),n}return i(e,t),e.prototype.getName=function(){return xi},e.prototype.updateMain=function(t){this._yAxisView.draw(t),this.getPane().getAxisComponent().isInCandle()&&this._candleLastPriceLabelView.draw(t),this._indicatorLastValueView.draw(t)},e.prototype.updateOverlay=function(t){this._overlayYAxisView.draw(t),this._crosshairHorizontalLabelView.draw(t)},e}(Pi),yn=function(){function t(t){this._defaultRange={from:0,to:0,range:0,realFrom:0,realTo:0,realRange:0},this._range={from:0,to:0,range:0,realFrom:0,realTo:0,realRange:0},this._prevRange={from:0,to:0,range:0,realFrom:0,realTo:0,realRange:0},this._ticks=[],this._autoCalcTickFlag=!0,this._parent=t}return t.prototype.getParent=function(){return this._parent},t.prototype.buildTicks=function(t){if(this._autoCalcTickFlag&&(this._range=this.calcRange()),this._prevRange.from!==this._range.from||this._prevRange.to!==this._range.to||t){this._prevRange=this._range;var e=this.optimalTicks(this._calcTicks());return this._ticks=this.createTicks({range:this._range,bounding:this.getSelfBounding(),defaultTicks:e}),!0}return!1},t.prototype.getTicks=function(){return this._ticks},t.prototype.getScrollZoomEnabled=function(){var t;return null===(t=this.getParent().getOptions().axisOptions.scrollZoomEnabled)||void 0===t||t},t.prototype.setRange=function(t){this._autoCalcTickFlag=!1,this._range=t},t.prototype.getRange=function(){return this._range},t.prototype.setAutoCalcTickFlag=function(t){this._autoCalcTickFlag=t},t.prototype.getAutoCalcTickFlag=function(){return this._autoCalcTickFlag},t.prototype._calcTicks=function(){var t=this._range,e=t.realFrom,i=t.realTo,n=t.realRange,o=[];if(n>=0){var r=s(this._calcTickInterval(n),2),a=r[0],l=r[1],c=ft(Math.ceil(e/a)*a,l),u=ft(Math.floor(i/a)*a,l),h=0,d=c;if(0!==a)for(;d<=u;){var p=d.toFixed(l);o[h]={text:p,coord:0,value:p},++h,d+=a}}return o},t.prototype._calcTickInterval=function(t){var e,i,n,o,r=(e=t/8,i=Math.floor(mt(e)),n=xt(i),e=((o=e/n)<1.5?1:o<2.5?2:o<3.5?3:o<4.5?4:o<5.5?5:o<6.5?6:8)*n,i>=-20?+e.toFixed(i<0?-i:0):e),a=function(t){var e=t.toString(),i=e.indexOf("e");if(i>0){var n=+e.slice(i+1);return n<0?-n:0}var o=e.indexOf(".");return o<0?0:e.length-1-o}(r);return[r,a]},t.prototype.reset=function(){this._range=this._defaultRange,this._autoCalcTickFlag=!0},t}(),mn=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return i(n,e),n.prototype.resetRange=function(){this.reset()},n.prototype.calcRange=function(){var e,i,n,o,r,a=this.getParent(),s=a.getChart(),l=s.getChartStore(),c=Number.MAX_SAFE_INTEGER,u=Number.MIN_SAFE_INTEGER,h=[],d=!1,p=Number.MAX_SAFE_INTEGER,g=Number.MIN_SAFE_INTEGER,v=Number.MAX_SAFE_INTEGER;l.getIndicatorStore().getInstances(a.getId()).forEach((function(t){var e,i,n;d||(d=null!==(e=t.shouldOhlc)&&void 0!==e&&e),v=Math.min(v,t.precision),B(t.minValue)&&(p=Math.min(p,t.minValue)),B(t.maxValue)&&(g=Math.max(g,t.maxValue)),h.push({figures:null!==(i=t.figures)&&void 0!==i?i:[],result:null!==(n=t.result)&&void 0!==n?n:[]})}));var f=4,y=this.isInCandle();if(y){var m=l.getPrecision().price;f=v!==Number.MAX_SAFE_INTEGER?Math.min(v,m):m}else v!==Number.MAX_SAFE_INTEGER&&(f=v);var x=l.getVisibleDataList(),_=s.getStyles().candle,S=_.type===t.CandleType.Area,w=_.area.value,b=y&&!S||!y&&d;x.forEach((function(t){var e=t.dataIndex,i=t.data;if(R(i)&&(b&&(c=Math.min(c,i.low),u=Math.max(u,i.high)),y&&S)){var n=i[w];B(n)&&(c=Math.min(c,n),u=Math.max(u,n))}h.forEach((function(t){var i,n=t.figures,o=null!==(i=t.result[e])&&void 0!==i?i:{};n.forEach((function(t){var e=o[t.key];B(e)&&(c=Math.min(c,e),u=Math.max(u,e))}))}))})),c!==Number.MAX_SAFE_INTEGER&&u!==Number.MIN_SAFE_INTEGER?(c=Math.min(p,c),u=Math.max(g,u)):(c=0,u=10);var T,C=this.getType();switch(C){case t.YAxisType.Percentage:var P=null===(e=x[0])||void 0===e?void 0:e.data;R(P)&&B(P.close)&&(c=(c-P.close)/P.close*100,u=(u-P.close)/P.close*100),T=Math.pow(10,-2);break;case t.YAxisType.Log:c=mt(c),u=mt(u),T=.05*xt(-f);break;default:T=xt(-f)}if(c===u||Math.abs(c-u)<T){var I=p===c,D=g===u;c=I?c:D?c-8*T:c-4*T,u=D?u:I?u+8*T:u+4*T}var E=null!==(n=null===(i=this.getParent().getYAxisWidget())||void 0===i?void 0:i.getBounding().height)&&void 0!==n?n:0,M=a.getOptions().gap,k=null!==(o=null==M?void 0:M.top)&&void 0!==o?o:.2;k>=1&&(k/=E);var A=null!==(r=null==M?void 0:M.bottom)&&void 0!==r?r:.1;A>=1&&(A/=E);var F,L,V,O=Math.abs(u-c);return c-=O*A,u+=O*k,O=Math.abs(u-c),C===t.YAxisType.Log?(F=xt(c),L=xt(u),V=Math.abs(L-F)):(F=c,L=u,V=O),this._defaultRange={from:c,to:u,range:O,realFrom:F,realTo:L,realRange:V},this._defaultRange},n.prototype._innerConvertToPixel=function(t){var e,i,n=null!==(i=null===(e=this.getParent().getYAxisWidget())||void 0===e?void 0:e.getBounding().height)&&void 0!==i?i:0,o=this.getRange(),r=(t-o.from)/o.range;return this.isReverse()?Math.round(r*n):Math.round((1-r)*n)},n.prototype.isInCandle=function(){return this.getParent().getId()===li},n.prototype.getType=function(){return this.isInCandle()?this.getParent().getChart().getStyles().yAxis.type:t.YAxisType.Normal},n.prototype.getPosition=function(){return this.getParent().getChart().getStyles().yAxis.position},n.prototype.isReverse=function(){return!!this.isInCandle()&&this.getParent().getChart().getStyles().yAxis.reverse},n.prototype.isFromZero=function(){var e=this.getParent().getChart().getStyles().yAxis,i=e.inside;return e.position===t.YAxisPosition.Left&&i||e.position===t.YAxisPosition.Right&&!i},n.prototype.optimalTicks=function(e){var i,n,o=this,r=this.getParent(),a=null!==(n=null===(i=r.getYAxisWidget())||void 0===i?void 0:i.getBounding().height)&&void 0!==n?n:0,s=r.getChart().getChartStore(),l=s.getCustomApi(),c=[],u=this.getType(),h=s.getIndicatorStore().getInstances(r.getId()),d=s.getThousandsSeparator(),p=s.getDecimalFoldThreshold(),g=0,v=!1;this.isInCandle()?g=s.getPrecision().price:h.forEach((function(t){g=Math.max(g,t.precision),v||(v=t.shouldFormatBigNumber)}));var f,y=s.getStyles().xAxis.tickText.size;return e.forEach((function(e){var i,n=e.value,r=o._innerConvertToPixel(+n);switch(u){case t.YAxisType.Percentage:i="".concat(U(n,2),"%");break;case t.YAxisType.Log:r=o._innerConvertToPixel(mt(+n)),i=U(n,g);break;default:i=U(n,g),v&&(i=l.formatBigNumber(n))}i=K(j(i,d),p);var s=B(f);r>y&&r<a-y&&(s&&Math.abs(f-r)>2*y||!s)&&(c.push({text:i,coord:r,value:n}),f=r)})),c},n.prototype.getAutoSize=function(){var e=this.getParent(),i=e.getChart(),n=i.getStyles(),o=n.yAxis,r=o.size;if("auto"!==r)return r;var a=i.getChartStore(),s=a.getCustomApi(),l=0;if(o.show&&(o.axisLine.show&&(l+=o.axisLine.size),o.tickLine.show&&(l+=o.tickLine.length),o.tickText.show)){var c=0;this.getTicks().forEach((function(t){c=Math.max(c,Q(t.text,o.tickText.size,o.tickText.weight,o.tickText.family))})),l+=o.tickText.marginStart+o.tickText.marginEnd+c}var u=n.crosshair,h=0;if(u.show&&u.horizontal.show&&u.horizontal.text.show){var d=a.getIndicatorStore().getInstances(e.getId()),p=0,g=!1;d.forEach((function(t){p=Math.max(t.precision,p),g||(g=t.shouldFormatBigNumber)}));var v=2;if(this.getType()!==t.YAxisType.Percentage)if(this.isInCandle()){var f=a.getPrecision().price,y=n.indicator.lastValueMark;v=y.show&&y.text.show?Math.max(p,f):f}else v=p;var m=U(this.getRange().to,v);g&&(m=s.formatBigNumber(m)),m=K(m,a.getDecimalFoldThreshold()),h+=u.horizontal.text.paddingLeft+u.horizontal.text.paddingRight+2*u.horizontal.text.borderSize+Q(m,u.horizontal.text.size,u.horizontal.text.weight,u.horizontal.text.family)}return Math.max(l,h)},n.prototype.getSelfBounding=function(){return this.getParent().getYAxisWidget().getBounding()},n.prototype.convertFromPixel=function(e){var i,n,o,r=null!==(n=null===(i=this.getParent().getYAxisWidget())||void 0===i?void 0:i.getBounding().height)&&void 0!==n?n:0,a=this.getRange(),s=a.from,l=a.range,c=(this.isReverse()?e/r:1-e/r)*l+s;switch(this.getType()){case t.YAxisType.Percentage:var u=null===(o=this.getParent().getChart().getChartStore().getVisibleDataList()[0])||void 0===o?void 0:o.data;return R(u)&&B(u.close)?u.close*c/100+u.close:0;case t.YAxisType.Log:return xt(c);default:return c}},n.prototype.convertToRealValue=function(e){var i=e;return this.getType()===t.YAxisType.Log&&(i=xt(e)),i},n.prototype.convertToPixel=function(e){var i,n=e;switch(this.getType()){case t.YAxisType.Percentage:var o=null===(i=this.getParent().getChart().getChartStore().getVisibleDataList()[0])||void 0===i?void 0:i.data;R(o)&&B(o.close)&&(n=(e-o.close)/o.close*100);break;case t.YAxisType.Log:n=mt(e);break;default:n=e}return this._innerConvertToPixel(n)},n.prototype.convertToNicePixel=function(t){var e,i,n=null!==(i=null===(e=this.getParent().getYAxisWidget())||void 0===e?void 0:e.getBounding().height)&&void 0!==i?i:0,o=this.convertToPixel(t);return Math.round(Math.max(.05*n,Math.min(o,.98*n)))},n.extend=function(t){var e=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return i(n,e),n.prototype.createTicks=function(e){return t.createTicks(e)},n}(n);return e},n}(yn),xn={default:mn.extend({name:"default",createTicks:function(t){return t.defaultTicks}})};var _n=function(){function t(t,e,i,n){this._bounding=Ti(),this._chart=i,this._id=n,this._init(t,e)}return t.prototype._init=function(t,e){this._rootContainer=t,this._container=gt("div",{width:"100%",margin:"0",padding:"0",position:"relative",overflow:"hidden",boxSizing:"border-box"}),null!==e?t.insertBefore(this._container,e):t.appendChild(this._container)},t.prototype.getContainer=function(){return this._container},t.prototype.getId=function(){return this._id},t.prototype.getChart=function(){return this._chart},t.prototype.getBounding=function(){return this._bounding},t.prototype.update=function(t){this._bounding.height!==this._container.clientHeight&&(this._container.style.height="".concat(this._bounding.height,"px")),this.updateImp(null!=t?t:3,this._container,this._bounding)},t.prototype.destroy=function(){this._rootContainer.removeChild(this._container)},t}(),Sn=function(t){function e(e,i,n,o,r){var a=t.call(this,e,i,n,o)||this;a._yAxisWidget=null,a._options={minHeight:30,dragEnabled:!0,gap:{top:.2,bottom:.1},axisOptions:{name:"default",scrollZoomEnabled:!0}};var s=a.getContainer();return a._mainWidget=a.createMainWidget(s),a._yAxisWidget=a.createYAxisWidget(s),a.setOptions(r),a}return i(e,t),e.prototype.setOptions=function(t){var e,i,n,o,r,a=null===(e=t.axisOptions)||void 0===e?void 0:e.name;return(this._options.axisOptions.name!==a&&O(a)||!R(this._axis))&&(this._axis=this.createAxisComponent(null!=a?a:"default")),M(this._options,t),this.getId()===ui?(o=this.getMainWidget().getContainer(),r="ew-resize"):(o=this.getYAxisWidget().getContainer(),r="ns-resize"),null===(n=null===(i=t.axisOptions)||void 0===i?void 0:i.scrollZoomEnabled)||void 0===n||n?o.style.cursor=r:o.style.cursor="default",this},e.prototype.getOptions=function(){return this._options},e.prototype.getAxisComponent=function(){return this._axis},e.prototype.setBounding=function(t,e,i){var n,o;M(this.getBounding(),t);var r={};return R(t.height)&&(r.height=t.height),R(t.top)&&(r.top=t.top),this._mainWidget.setBounding(r),null===(n=this._yAxisWidget)||void 0===n||n.setBounding(r),R(e)&&this._mainWidget.setBounding(e),R(i)&&(null===(o=this._yAxisWidget)||void 0===o||o.setBounding(i)),this},e.prototype.getMainWidget=function(){return this._mainWidget},e.prototype.getYAxisWidget=function(){return this._yAxisWidget},e.prototype.updateImp=function(t){var e;this._mainWidget.update(t),null===(e=this._yAxisWidget)||void 0===e||e.update(t)},e.prototype.destroy=function(){var e;t.prototype.destroy.call(this),this._mainWidget.destroy(),null===(e=this._yAxisWidget)||void 0===e||e.destroy()},e.prototype.getImage=function(t){var e=this.getBounding(),i=e.width,n=e.height,o=gt("canvas",{width:"".concat(i,"px"),height:"".concat(n,"px"),boxSizing:"border-box"}),r=o.getContext("2d"),a=Z(o);o.width=i*a,o.height=n*a,r.scale(a,a);var s=this._mainWidget.getBounding();if(r.drawImage(this._mainWidget.getImage(t),s.left,0,s.width,s.height),null!==this._yAxisWidget){var l=this._yAxisWidget.getBounding();r.drawImage(this._yAxisWidget.getImage(t),l.left,0,l.width,l.height)}return o},e.prototype.createYAxisWidget=function(t){return null},e}(_n),wn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.createAxisComponent=function(t){var e=function(t){var e;return null!==(e=xn[t])&&void 0!==e?e:xn.default}(null!=t?t:"default");return new e(this)},e.prototype.createMainWidget=function(t){return new tn(t,this)},e.prototype.createYAxisWidget=function(t){return new fn(t,this)},e}(Sn),bn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.createMainWidget=function(t){return new cn(t,this)},e}(wn),Tn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.getAxisStyles=function(t){return t.xAxis},e.prototype.createAxisLine=function(t,e){var i=e.axisLine.size/2;return{coordinates:[{x:0,y:i},{x:t.width,y:i}]}},e.prototype.createTickLines=function(t,e,i){var n=i.tickLine,o=i.axisLine.size;return t.map((function(t){return{coordinates:[{x:t.coord,y:0},{x:t.coord,y:o+n.length}]}}))},e.prototype.createTickTexts=function(t,e,i){var n=i.tickText,o=i.axisLine.size,r=i.tickLine.length;return t.map((function(t){return{x:t.coord,y:o+r+n.marginStart,text:t.text,align:"center",baseline:"top"}}))},e}(un),Cn=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return i(n,e),n.prototype.coordinateToPointTimestampDataIndexFlag=function(){return!0},n.prototype.coordinateToPointValueFlag=function(){return!1},n.prototype.getCompleteOverlays=function(t){return t.getInstances()},n.prototype.getProgressOverlay=function(t){return t.instance},n.prototype.getDefaultFigures=function(e,i,n,o,r,a,s,l,c,u,h){var d,p=[];if(e.needDefaultXAxisFigure&&e.id===(null===(d=h.instance)||void 0===d?void 0:d.id)){var g=Number.MAX_SAFE_INTEGER,v=Number.MIN_SAFE_INTEGER;i.forEach((function(i,n){g=Math.min(g,i.x),v=Math.max(v,i.x);var o=e.points[n];if(B(o.timestamp)){var s=a.formatDate(r,o.timestamp,"YYYY-MM-DD HH:mm",t.FormatDateType.Crosshair);p.push({type:"text",attrs:{x:i.x,y:0,text:s,align:"center"},ignoreEvent:!0})}})),i.length>1&&p.unshift({type:"rect",attrs:{x:g,y:0,width:v-g,height:n.height},ignoreEvent:!0})}return p},n.prototype.getFigures=function(t,e,i,n,o,r,a,s,l,c,u){var h,d;return null!==(d=null===(h=t.createXAxisFigures)||void 0===h?void 0:h.call(t,{overlay:t,coordinates:e,bounding:i,barSpace:n,precision:o,thousandsSeparator:r,decimalFoldThreshold:a,dateTimeFormat:s,defaultStyles:l,xAxis:c,yAxis:u}))&&void 0!==d?d:[]},n}(gn),Pn=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return i(n,e),n.prototype.compare=function(t){return R(t.kLineData)&&t.dataIndex===t.realDataIndex},n.prototype.getDirectionStyles=function(t){return t.vertical},n.prototype.getText=function(e,i){var n,o=null===(n=e.kLineData)||void 0===n?void 0:n.timestamp;return i.getCustomApi().formatDate(i.getTimeScaleStore().getDateTimeFormat(),o,"YYYY-MM-DD HH:mm",t.FormatDateType.Crosshair)},n.prototype.getTextAttrs=function(t,e,i,n,o,r){var a,s=i.realX,l="center";return s-e/2-r.paddingLeft<0?(a=0,l="left"):s+e/2+r.paddingRight>n.width?(a=n.width,l="right"):a=s,{x:a,y:0,text:t,align:l,baseline:"top"}},n}(vn),In=function(t){function e(e,i){var n=t.call(this,e,i)||this;return n._xAxisView=new Tn(n),n._overlayXAxisView=new Cn(n),n._crosshairVerticalLabelView=new Pn(n),n.getContainer().style.cursor="ew-resize",n.addChild(n._overlayXAxisView),n}return i(e,t),e.prototype.getName=function(){return mi},e.prototype.updateMain=function(t){this._xAxisView.draw(t)},e.prototype.updateOverlay=function(t){this._overlayXAxisView.draw(t),this._crosshairVerticalLabelView.draw(t)},e}(Pi),Dn=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return i(n,e),n.prototype.calcRange=function(){var t=this.getParent().getChart().getChartStore().getTimeScaleStore().getVisibleRange(),e=t.from,i=t.to,n=i-1,o=i-e;return{from:e,to:n,range:o,realFrom:e,realTo:n,realRange:o}},n.prototype.optimalTicks=function(e){var i,n,o=this.getParent().getChart(),r=o.getChartStore(),a=r.getCustomApi().formatDate,s=[],l=e.length,c=r.getDataList();if(l>0){var u=r.getTimeScaleStore().getDateTimeFormat(),h=o.getStyles().xAxis.tickText,d=Q("00-00 00:00",h.size,h.weight,h.family),p=parseInt(e[0].value,10),g=this.convertToPixel(p),v=1;if(l>1){var f=parseInt(e[1].value,10),y=this.convertToPixel(f),m=Math.abs(y-g);m<d&&(v=Math.ceil(d/m))}for(var x=0;x<l;x+=v){var _=parseInt(e[x].value,10),S=c[_].timestamp,w=a(u,S,"HH:mm",t.FormatDateType.XAxis);if(0!==x){var b=c[parseInt(e[x-v].value,10)].timestamp;w=null!==(i=this._optimalTickLabel(a,u,S,b))&&void 0!==i?i:w}var T=this.convertToPixel(_);s.push({text:w,coord:T,value:S})}if(1===s.length)s[0].text=a(u,s[0].value,"YYYY-MM-DD HH:mm",t.FormatDateType.XAxis);else{var C=s[0].value,P=s[1].value;if(R(s[2])){var I=s[2].text;/^[0-9]{2}-[0-9]{2}$/.test(I)?s[0].text=a(u,C,"MM-DD",t.FormatDateType.XAxis):/^[0-9]{4}-[0-9]{2}$/.test(I)?s[0].text=a(u,C,"YYYY-MM",t.FormatDateType.XAxis):/^[0-9]{4}$/.test(I)&&(s[0].text=a(u,C,"YYYY",t.FormatDateType.XAxis))}else s[0].text=null!==(n=this._optimalTickLabel(a,u,C,P))&&void 0!==n?n:s[0].text}}return s},n.prototype._optimalTickLabel=function(e,i,n,o){var r=e(i,n,"YYYY",t.FormatDateType.XAxis),a=e(i,n,"YYYY-MM",t.FormatDateType.XAxis),s=e(i,n,"MM-DD",t.FormatDateType.XAxis);return r!==e(i,o,"YYYY",t.FormatDateType.XAxis)?r:a!==e(i,o,"YYYY-MM",t.FormatDateType.XAxis)?a:s!==e(i,o,"MM-DD",t.FormatDateType.XAxis)?s:null},n.prototype.getAutoSize=function(){var t=this.getParent().getChart().getStyles(),e=t.xAxis,i=e.size;if("auto"!==i)return i;var n=t.crosshair,o=0;e.show&&(e.axisLine.show&&(o+=e.axisLine.size),e.tickLine.show&&(o+=e.tickLine.length),e.tickText.show&&(o+=e.tickText.marginStart+e.tickText.marginEnd+e.tickText.size));var r=0;return n.show&&n.vertical.show&&n.vertical.text.show&&(r+=n.vertical.text.paddingTop+n.vertical.text.paddingBottom+2*n.vertical.text.borderSize+n.vertical.text.size),Math.max(o,r)},n.prototype.getSelfBounding=function(){return this.getParent().getMainWidget().getBounding()},n.prototype.convertTimestampFromPixel=function(t){var e=this.getParent().getChart().getChartStore().getTimeScaleStore(),i=e.coordinateToDataIndex(t);return e.dataIndexToTimestamp(i)},n.prototype.convertTimestampToPixel=function(t){var e=this.getParent().getChart().getChartStore().getTimeScaleStore(),i=e.timestampToDataIndex(t);return e.dataIndexToCoordinate(i)},n.prototype.convertFromPixel=function(t){return this.getParent().getChart().getChartStore().getTimeScaleStore().coordinateToDataIndex(t)},n.prototype.convertToPixel=function(t){return this.getParent().getChart().getChartStore().getTimeScaleStore().dataIndexToCoordinate(t)},n.extend=function(t){var e=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return i(n,e),n.prototype.createTicks=function(e){return t.createTicks(e)},n}(n);return e},n}(yn),En={default:Dn.extend({name:"default",createTicks:function(t){return t.defaultTicks}})};var Mn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.createAxisComponent=function(t){var e=function(t){var e;return null!==(e=En[t])&&void 0!==e?e:En.default}(t);return new e(this)},e.prototype.createMainWidget=function(t){return new In(t,this)},e}(Sn);var kn=function(e){function n(t,i){var n,o,r,a=e.call(this,t,i)||this;return a._dragFlag=!1,a._dragStartY=0,a._topPaneHeight=0,a._bottomPaneHeight=0,a._pressedMouseMoveEvent=(n=a._pressedTouchMouseMoveEvent,o=20,r=0,function(){var t=Date.now();t-r>o&&(n.apply(this,arguments),r=t)}),a.registerEvent("touchStartEvent",a._mouseDownEvent.bind(a)).registerEvent("touchMoveEvent",a._pressedMouseMoveEvent.bind(a)).registerEvent("touchEndEvent",a._mouseUpEvent.bind(a)).registerEvent("mouseDownEvent",a._mouseDownEvent.bind(a)).registerEvent("mouseUpEvent",a._mouseUpEvent.bind(a)).registerEvent("pressedMouseMoveEvent",a._pressedMouseMoveEvent.bind(a)).registerEvent("mouseEnterEvent",a._mouseEnterEvent.bind(a)).registerEvent("mouseLeaveEvent",a._mouseLeaveEvent.bind(a)),a}return i(n,e),n.prototype.getName=function(){return _i},n.prototype.checkEventOn=function(){return!0},n.prototype._mouseDownEvent=function(t){this._dragFlag=!0,this._dragStartY=t.pageY;var e=this.getPane();return this._topPaneHeight=e.getTopPane().getBounding().height,this._bottomPaneHeight=e.getBottomPane().getBounding().height,!0},n.prototype._mouseUpEvent=function(){return this._dragFlag=!1,this._mouseLeaveEvent()},n.prototype._pressedTouchMouseMoveEvent=function(e){var i=e.pageY-this._dragStartY,n=this.getPane(),o=n.getTopPane(),r=n.getBottomPane(),a=i<0;if(null!==o&&(null==r?void 0:r.getOptions().dragEnabled)){var s=void 0,l=void 0,c=void 0,u=void 0;a?(s=o,l=r,c=this._topPaneHeight,u=this._bottomPaneHeight):(s=r,l=o,c=this._bottomPaneHeight,u=this._topPaneHeight);var h=s.getOptions().minHeight;if(c>h){var d=Math.max(c-Math.abs(i),h),p=c-d;s.setBounding({height:d}),l.setBounding({height:u+p});var g=n.getChart();g.getChartStore().getActionStore().execute(t.ActionType.OnPaneDrag,{paneId:n.getId()}),g.adjustPaneViewport(!0,!0,!0,!0,!0)}}return!0},n.prototype._mouseEnterEvent=function(){var t,e=this.getPane(),i=e.getBottomPane();if(null!==(t=null==i?void 0:i.getOptions().dragEnabled)&&void 0!==t&&t){var n=e.getChart().getStyles().separator;return this.getContainer().style.background=n.activeBackgroundColor,!0}return!1},n.prototype._mouseLeaveEvent=function(){return!this._dragFlag&&(this.getContainer().style.background="",!0)},n.prototype.createContainer=function(){return gt("div",{width:"100%",height:"".concat(7,"px"),margin:"0",padding:"0",position:"absolute",top:"-3px",zIndex:"20",boxSizing:"border-box",cursor:"ns-resize"})},n.prototype.updateImp=function(t,e,i){if(4===i||2===i){var n=this.getPane().getChart().getStyles().separator;t.style.top="".concat(-Math.floor((7-n.size)/2),"px"),t.style.height="".concat(7,"px")}},n}(Ci),An=function(t){function e(e,i,n,o,r,a){var s=t.call(this,e,i,n,o)||this;return s.getContainer().style.overflow="",s._topPane=r,s._bottomPane=a,s._separatorWidget=new kn(s.getContainer(),s),s}return i(e,t),e.prototype.setBounding=function(t){return M(this.getBounding(),t),this},e.prototype.getTopPane=function(){return this._topPane},e.prototype.setTopPane=function(t){return this._topPane=t,this},e.prototype.getBottomPane=function(){return this._bottomPane},e.prototype.setBottomPane=function(t){return this._bottomPane=t,this},e.prototype.getWidget=function(){return this._separatorWidget},e.prototype.getImage=function(t){var e=this.getBounding(),i=e.width,n=e.height,o=this.getChart().getStyles().separator,r=gt("canvas",{width:"".concat(i,"px"),height:"".concat(n,"px"),boxSizing:"border-box"}),a=r.getContext("2d"),s=Z(r);return r.width=i*s,r.height=n*s,a.scale(s,s),a.fillStyle=o.color,a.fillRect(0,0,i,n),r},e.prototype.updateImp=function(t,e,i){if(4===t||2===t){var n=this.getChart().getStyles().separator;e.style.backgroundColor=n.color,e.style.height="".concat(i.height,"px"),e.style.marginLeft="".concat(i.left,"px"),e.style.width="".concat(i.width,"px"),this._separatorWidget.update(t)}},e}(_n);function Fn(){var t;return"undefined"!=typeof window&&(null!==(t=window.navigator.userAgent.toLowerCase().indexOf("firefox"))&&void 0!==t?t:-1)>-1}function Ln(){return"undefined"!=typeof window&&/iPhone|iPad|iPod/.test(window.navigator.platform)}var Bn,Rn=function(){function t(t,e,i){var n=this;this._clickCount=0,this._clickTimeoutId=null,this._clickCoordinate={x:Number.NEGATIVE_INFINITY,y:Number.POSITIVE_INFINITY},this._tapCount=0,this._tapTimeoutId=null,this._tapCoordinate={x:Number.NEGATIVE_INFINITY,y:Number.POSITIVE_INFINITY},this._longTapTimeoutId=null,this._longTapActive=!1,this._mouseMoveStartCoordinate=null,this._touchMoveStartCoordinate=null,this._touchMoveExceededManhattanDistance=!1,this._cancelClick=!1,this._cancelTap=!1,this._unsubscribeOutsideMouseEvents=null,this._unsubscribeOutsideTouchEvents=null,this._unsubscribeMobileSafariEvents=null,this._unsubscribeMousemove=null,this._unsubscribeMouseWheel=null,this._unsubscribeContextMenu=null,this._unsubscribeRootMouseEvents=null,this._unsubscribeRootTouchEvents=null,this._startPinchMiddleCoordinate=null,this._startPinchDistance=0,this._pinchPrevented=!1,this._preventTouchDragProcess=!1,this._mousePressed=!1,this._lastTouchEventTimeStamp=0,this._activeTouchId=null,this._acceptMouseLeave=!Ln(),this._onFirefoxOutsideMouseUp=function(t){n._mouseUpHandler(t)},this._onMobileSafariDoubleClick=function(t){n._firesTouchEvents(t)?(++n._tapCount,null!==n._tapTimeoutId&&n._tapCount>1&&(n._mouseTouchMoveWithDownInfo(n._getCoordinate(t),n._tapCoordinate).manhattanDistance<30&&!n._cancelTap&&n._processEvent(n._makeCompatEvent(t),n._handler.doubleTapEvent),n._resetTapTimeout())):(++n._clickCount,null!==n._clickTimeoutId&&n._clickCount>1&&(n._mouseTouchMoveWithDownInfo(n._getCoordinate(t),n._clickCoordinate).manhattanDistance<5&&!n._cancelClick&&n._processEvent(n._makeCompatEvent(t),n._handler.mouseDoubleClickEvent),n._resetClickTimeout()))},this._target=t,this._handler=e,this._options=i,this._init()}return t.prototype.destroy=function(){null!==this._unsubscribeOutsideMouseEvents&&(this._unsubscribeOutsideMouseEvents(),this._unsubscribeOutsideMouseEvents=null),null!==this._unsubscribeOutsideTouchEvents&&(this._unsubscribeOutsideTouchEvents(),this._unsubscribeOutsideTouchEvents=null),null!==this._unsubscribeMousemove&&(this._unsubscribeMousemove(),this._unsubscribeMousemove=null),null!==this._unsubscribeMouseWheel&&(this._unsubscribeMouseWheel(),this._unsubscribeMouseWheel=null),null!==this._unsubscribeContextMenu&&(this._unsubscribeContextMenu(),this._unsubscribeContextMenu=null),null!==this._unsubscribeRootMouseEvents&&(this._unsubscribeRootMouseEvents(),this._unsubscribeRootMouseEvents=null),null!==this._unsubscribeRootTouchEvents&&(this._unsubscribeRootTouchEvents(),this._unsubscribeRootTouchEvents=null),null!==this._unsubscribeMobileSafariEvents&&(this._unsubscribeMobileSafariEvents(),this._unsubscribeMobileSafariEvents=null),this._clearLongTapTimeout(),this._resetClickTimeout()},t.prototype._mouseEnterHandler=function(t){var e,i,n,o=this;null===(e=this._unsubscribeMousemove)||void 0===e||e.call(this),null===(i=this._unsubscribeMouseWheel)||void 0===i||i.call(this),null===(n=this._unsubscribeContextMenu)||void 0===n||n.call(this);var r=this._mouseMoveHandler.bind(this);this._unsubscribeMousemove=function(){o._target.removeEventListener("mousemove",r)},this._target.addEventListener("mousemove",r);var a=this._mouseWheelHandler.bind(this);this._unsubscribeMouseWheel=function(){o._target.removeEventListener("wheel",a)},this._target.addEventListener("wheel",a,{passive:!1});var s=this._contextMenuHandler.bind(this);this._unsubscribeContextMenu=function(){o._target.removeEventListener("contextmenu",s)},this._target.addEventListener("contextmenu",s,{passive:!1}),this._firesTouchEvents(t)||(this._processEvent(this._makeCompatEvent(t),this._handler.mouseEnterEvent),this._acceptMouseLeave=!0)},t.prototype._resetClickTimeout=function(){null!==this._clickTimeoutId&&clearTimeout(this._clickTimeoutId),this._clickCount=0,this._clickTimeoutId=null,this._clickCoordinate={x:Number.NEGATIVE_INFINITY,y:Number.POSITIVE_INFINITY}},t.prototype._resetTapTimeout=function(){null!==this._tapTimeoutId&&clearTimeout(this._tapTimeoutId),this._tapCount=0,this._tapTimeoutId=null,this._tapCoordinate={x:Number.NEGATIVE_INFINITY,y:Number.POSITIVE_INFINITY}},t.prototype._mouseMoveHandler=function(t){this._mousePressed||null!==this._touchMoveStartCoordinate||this._firesTouchEvents(t)||(this._processEvent(this._makeCompatEvent(t),this._handler.mouseMoveEvent),this._acceptMouseLeave=!0)},t.prototype._mouseWheelHandler=function(t){if(Math.abs(t.deltaX)>Math.abs(t.deltaY)){if(!R(this._handler.mouseWheelHortEvent))return;if(this._preventDefault(t),0===Math.abs(t.deltaX))return;this._handler.mouseWheelHortEvent(this._makeCompatEvent(t),-t.deltaX)}else{if(!R(this._handler.mouseWheelVertEvent))return;var e=-t.deltaY/100;if(0===e)return;switch(this._preventDefault(t),t.deltaMode){case t.DOM_DELTA_PAGE:e*=120;break;case t.DOM_DELTA_LINE:e*=32}if(0!==e){var i=Math.sign(e)*Math.min(1,Math.abs(e));this._handler.mouseWheelVertEvent(this._makeCompatEvent(t),i)}}},t.prototype._contextMenuHandler=function(t){this._preventDefault(t)},t.prototype._touchMoveHandler=function(t){var e=this._touchWithId(t.changedTouches,this._activeTouchId);if(null!==e&&(this._lastTouchEventTimeStamp=this._eventTimeStamp(t),null===this._startPinchMiddleCoordinate&&!this._preventTouchDragProcess)){this._pinchPrevented=!0;var i=this._mouseTouchMoveWithDownInfo(this._getCoordinate(e),this._touchMoveStartCoordinate),n=i.xOffset,o=i.yOffset,r=i.manhattanDistance;if(this._touchMoveExceededManhattanDistance||!(r<5)){if(!this._touchMoveExceededManhattanDistance){var a=.5*n,s=o>=a&&!this._options.treatVertDragAsPageScroll(),l=a>o&&!this._options.treatHorzDragAsPageScroll();s||l||(this._preventTouchDragProcess=!0),this._touchMoveExceededManhattanDistance=!0,this._cancelTap=!0,this._clearLongTapTimeout(),this._resetTapTimeout()}this._preventTouchDragProcess||this._processEvent(this._makeCompatEvent(t,e),this._handler.touchMoveEvent)}}},t.prototype._mouseMoveWithDownHandler=function(t){0===t.button&&(this._mouseTouchMoveWithDownInfo(this._getCoordinate(t),this._mouseMoveStartCoordinate).manhattanDistance>=5&&(this._cancelClick=!0,this._resetClickTimeout()),this._cancelClick&&this._processEvent(this._makeCompatEvent(t),this._handler.pressedMouseMoveEvent))},t.prototype._mouseTouchMoveWithDownInfo=function(t,e){var i=Math.abs(e.x-t.x),n=Math.abs(e.y-t.y);return{xOffset:i,yOffset:n,manhattanDistance:i+n}},t.prototype._touchEndHandler=function(t){var e=this._touchWithId(t.changedTouches,this._activeTouchId);if(null===e&&0===t.touches.length&&(e=t.changedTouches[0]),null!==e){this._activeTouchId=null,this._lastTouchEventTimeStamp=this._eventTimeStamp(t),this._clearLongTapTimeout(),this._touchMoveStartCoordinate=null,null!==this._unsubscribeRootTouchEvents&&(this._unsubscribeRootTouchEvents(),this._unsubscribeRootTouchEvents=null);var i=this._makeCompatEvent(t,e);if(this._processEvent(i,this._handler.touchEndEvent),++this._tapCount,null!==this._tapTimeoutId&&this._tapCount>1)this._mouseTouchMoveWithDownInfo(this._getCoordinate(e),this._tapCoordinate).manhattanDistance<30&&!this._cancelTap&&this._processEvent(i,this._handler.doubleTapEvent),this._resetTapTimeout();else this._cancelTap||(this._processEvent(i,this._handler.tapEvent),R(this._handler.tapEvent)&&this._preventDefault(t));0===this._tapCount&&this._preventDefault(t),0===t.touches.length&&this._longTapActive&&(this._longTapActive=!1,this._preventDefault(t))}},t.prototype._mouseUpHandler=function(t){if(0===t.button){var e=this._makeCompatEvent(t);if(this._mouseMoveStartCoordinate=null,this._mousePressed=!1,null!==this._unsubscribeRootMouseEvents&&(this._unsubscribeRootMouseEvents(),this._unsubscribeRootMouseEvents=null),Fn())this._target.ownerDocument.documentElement.removeEventListener("mouseleave",this._onFirefoxOutsideMouseUp);if(!this._firesTouchEvents(t))if(this._processEvent(e,this._handler.mouseUpEvent),++this._clickCount,null!==this._clickTimeoutId&&this._clickCount>1)this._mouseTouchMoveWithDownInfo(this._getCoordinate(t),this._clickCoordinate).manhattanDistance<5&&!this._cancelClick&&this._processEvent(e,this._handler.mouseDoubleClickEvent),this._resetClickTimeout();else this._cancelClick||this._processEvent(e,this._handler.mouseClickEvent)}},t.prototype._clearLongTapTimeout=function(){null!==this._longTapTimeoutId&&(clearTimeout(this._longTapTimeoutId),this._longTapTimeoutId=null)},t.prototype._touchStartHandler=function(t){if(null===this._activeTouchId){var e=t.changedTouches[0];this._activeTouchId=e.identifier,this._lastTouchEventTimeStamp=this._eventTimeStamp(t);var i=this._target.ownerDocument.documentElement;this._cancelTap=!1,this._touchMoveExceededManhattanDistance=!1,this._preventTouchDragProcess=!1,this._touchMoveStartCoordinate=this._getCoordinate(e),null!==this._unsubscribeRootTouchEvents&&(this._unsubscribeRootTouchEvents(),this._unsubscribeRootTouchEvents=null);var n=this._touchMoveHandler.bind(this),o=this._touchEndHandler.bind(this);this._unsubscribeRootTouchEvents=function(){i.removeEventListener("touchmove",n),i.removeEventListener("touchend",o)},i.addEventListener("touchmove",n,{passive:!1}),i.addEventListener("touchend",o,{passive:!1}),this._clearLongTapTimeout(),this._longTapTimeoutId=setTimeout(this._longTapHandler.bind(this,t),500),this._processEvent(this._makeCompatEvent(t,e),this._handler.touchStartEvent),null===this._tapTimeoutId&&(this._tapCount=0,this._tapTimeoutId=setTimeout(this._resetTapTimeout.bind(this),500),this._tapCoordinate=this._getCoordinate(e))}},t.prototype._mouseDownHandler=function(t){if(2===t.button)return this._preventDefault(t),void this._processEvent(this._makeCompatEvent(t),this._handler.mouseRightClickEvent);if(0===t.button){var e=this._target.ownerDocument.documentElement;Fn()&&e.addEventListener("mouseleave",this._onFirefoxOutsideMouseUp),this._cancelClick=!1,this._mouseMoveStartCoordinate=this._getCoordinate(t),null!==this._unsubscribeRootMouseEvents&&(this._unsubscribeRootMouseEvents(),this._unsubscribeRootMouseEvents=null);var i=this._mouseMoveWithDownHandler.bind(this),n=this._mouseUpHandler.bind(this);this._unsubscribeRootMouseEvents=function(){e.removeEventListener("mousemove",i),e.removeEventListener("mouseup",n)},e.addEventListener("mousemove",i),e.addEventListener("mouseup",n),this._mousePressed=!0,this._firesTouchEvents(t)||(this._processEvent(this._makeCompatEvent(t),this._handler.mouseDownEvent),null===this._clickTimeoutId&&(this._clickCount=0,this._clickTimeoutId=setTimeout(this._resetClickTimeout.bind(this),500),this._clickCoordinate=this._getCoordinate(t)))}},t.prototype._init=function(){var t=this;this._target.addEventListener("mouseenter",this._mouseEnterHandler.bind(this)),this._target.addEventListener("touchcancel",this._clearLongTapTimeout.bind(this));var e=this._target.ownerDocument,i=function(e){null!=t._handler.mouseDownOutsideEvent&&(e.composed&&t._target.contains(e.composedPath()[0])||null!==e.target&&t._target.contains(e.target)||t._handler.mouseDownOutsideEvent({x:0,y:0,pageX:0,pageY:0}))};this._unsubscribeOutsideTouchEvents=function(){e.removeEventListener("touchstart",i)},this._unsubscribeOutsideMouseEvents=function(){e.removeEventListener("mousedown",i)},e.addEventListener("mousedown",i),e.addEventListener("touchstart",i,{passive:!0}),Ln()&&(this._unsubscribeMobileSafariEvents=function(){t._target.removeEventListener("dblclick",t._onMobileSafariDoubleClick)},this._target.addEventListener("dblclick",this._onMobileSafariDoubleClick)),this._target.addEventListener("mouseleave",this._mouseLeaveHandler.bind(this)),this._target.addEventListener("touchstart",this._touchStartHandler.bind(this),{passive:!0}),this._target.addEventListener("mousedown",(function(t){if(1===t.button)return t.preventDefault(),!1})),this._target.addEventListener("mousedown",this._mouseDownHandler.bind(this)),this._initPinch(),this._target.addEventListener("touchmove",(function(){}),{passive:!1})},t.prototype._initPinch=function(){var t=this;(R(this._handler.pinchStartEvent)||R(this._handler.pinchEvent)||R(this._handler.pinchEndEvent))&&(this._target.addEventListener("touchstart",(function(e){t._checkPinchState(e.touches)}),{passive:!0}),this._target.addEventListener("touchmove",(function(e){if(2===e.touches.length&&null!==t._startPinchMiddleCoordinate&&R(t._handler.pinchEvent)){var i=t._getTouchDistance(e.touches[0],e.touches[1])/t._startPinchDistance;t._handler.pinchEvent(n(n({},t._startPinchMiddleCoordinate),{pageX:0,pageY:0}),i),t._preventDefault(e)}}),{passive:!1}),this._target.addEventListener("touchend",(function(e){t._checkPinchState(e.touches)})))},t.prototype._checkPinchState=function(t){1===t.length&&(this._pinchPrevented=!1),2!==t.length||this._pinchPrevented||this._longTapActive?this._stopPinch():this._startPinch(t)},t.prototype._startPinch=function(t){var e,i=null!==(e=this._target.getBoundingClientRect())&&void 0!==e?e:{left:0,top:0};this._startPinchMiddleCoordinate={x:(t[0].clientX-i.left+(t[1].clientX-i.left))/2,y:(t[0].clientY-i.top+(t[1].clientY-i.top))/2},this._startPinchDistance=this._getTouchDistance(t[0],t[1]),R(this._handler.pinchStartEvent)&&this._handler.pinchStartEvent({x:0,y:0,pageX:0,pageY:0}),this._clearLongTapTimeout()},t.prototype._stopPinch=function(){null!==this._startPinchMiddleCoordinate&&(this._startPinchMiddleCoordinate=null,R(this._handler.pinchEndEvent)&&this._handler.pinchEndEvent({x:0,y:0,pageX:0,pageY:0}))},t.prototype._mouseLeaveHandler=function(t){var e,i,n;null===(e=this._unsubscribeMousemove)||void 0===e||e.call(this),null===(i=this._unsubscribeMouseWheel)||void 0===i||i.call(this),null===(n=this._unsubscribeContextMenu)||void 0===n||n.call(this),this._firesTouchEvents(t)||this._acceptMouseLeave&&(this._processEvent(this._makeCompatEvent(t),this._handler.mouseLeaveEvent),this._acceptMouseLeave=!Ln())},t.prototype._longTapHandler=function(t){var e=this._touchWithId(t.touches,this._activeTouchId);null!==e&&(this._processEvent(this._makeCompatEvent(t,e),this._handler.longTapEvent),this._cancelTap=!0,this._longTapActive=!0)},t.prototype._firesTouchEvents=function(t){var e;return R(null===(e=t.sourceCapabilities)||void 0===e?void 0:e.firesTouchEvents)?t.sourceCapabilities.firesTouchEvents:this._eventTimeStamp(t)<this._lastTouchEventTimeStamp+500},t.prototype._processEvent=function(t,e){null==e||e.call(this._handler,t)},t.prototype._makeCompatEvent=function(t,e){var i,n=this,o=null!=e?e:t,r=null!==(i=this._target.getBoundingClientRect())&&void 0!==i?i:{left:0,top:0};return{x:o.clientX-r.left,y:o.clientY-r.top,pageX:o.pageX,pageY:o.pageY,isTouch:!t.type.startsWith("mouse")&&"contextmenu"!==t.type&&"click"!==t.type&&"wheel"!==t.type,preventDefault:function(){"touchstart"!==t.type&&n._preventDefault(t)}}},t.prototype._getTouchDistance=function(t,e){var i=t.clientX-e.clientX,n=t.clientY-e.clientY;return Math.sqrt(i*i+n*n)},t.prototype._preventDefault=function(t){t.cancelable&&t.preventDefault()},t.prototype._getCoordinate=function(t){return{x:t.pageX,y:t.pageY}},t.prototype._eventTimeStamp=function(t){var e;return null!==(e=t.timeStamp)&&void 0!==e?e:performance.now()},t.prototype._touchWithId=function(t,e){for(var i=0;i<t.length;++i)if(t[i].identifier===e)return t[i];return null},t}(),Vn=function(){function e(t,e){var i=this;this._flingStartTime=(new Date).getTime(),this._flingScrollRequestId=null,this._startScrollCoordinate=null,this._touchCoordinate=null,this._touchCancelCrosshair=!1,this._touchZoomed=!1,this._pinchScale=1,this._mouseDownWidget=null,this._prevYAxisRange=null,this._xAxisStartScaleCoordinate=null,this._xAxisStartScaleDistance=0,this._xAxisScale=1,this._yAxisStartScaleDistance=0,this._mouseMoveTriggerWidgetInfo={pane:null,widget:null},this._boundKeyBoardDownEvent=function(t){if(t.shiftKey)switch(t.code){case"Equal":i._chart.getChartStore().getTimeScaleStore().zoom(.5);break;case"Minus":i._chart.getChartStore().getTimeScaleStore().zoom(-.5);break;case"ArrowLeft":(e=i._chart.getChartStore().getTimeScaleStore()).startScroll(),e.scroll(-3*e.getBarSpace().bar);break;case"ArrowRight":var e;(e=i._chart.getChartStore().getTimeScaleStore()).startScroll(),e.scroll(3*e.getBarSpace().bar)}},this._container=t,this._chart=e,this._event=new Rn(t,this,{treatVertDragAsPageScroll:function(){return!1},treatHorzDragAsPageScroll:function(){return!1}}),t.addEventListener("keydown",this._boundKeyBoardDownEvent)}return e.prototype.pinchStartEvent=function(){return this._touchZoomed=!0,this._pinchScale=1,!0},e.prototype.pinchEvent=function(t,e){var i=this._findWidgetByEvent(t),n=i.pane,o=i.widget;if((null==n?void 0:n.getId())!==ui&&(null==o?void 0:o.getName())===yi){var r=this._makeWidgetEvent(t,o),a=5*(e-this._pinchScale);return this._pinchScale=e,this._chart.getChartStore().getTimeScaleStore().zoom(a,{x:r.x,y:r.y}),!0}return!1},e.prototype.mouseWheelHortEvent=function(t,e){var i=this._chart.getChartStore().getTimeScaleStore();return i.startScroll(),i.scroll(e),!0},e.prototype.mouseWheelVertEvent=function(t,e){var i=this._findWidgetByEvent(t).widget,n=this._makeWidgetEvent(t,i);return(null==i?void 0:i.getName())===yi&&(this._chart.getChartStore().getTimeScaleStore().zoom(e,{x:n.x,y:n.y}),!0)},e.prototype.mouseDownEvent=function(t){var e,i,o=this._findWidgetByEvent(t),r=o.pane,a=o.widget;if(this._mouseDownWidget=a,null!==a){var s=this._makeWidgetEvent(t,a);switch(a.getName()){case _i:return a.dispatchEvent("mouseDownEvent",s);case yi:var l=null!==(e=r.getAxisComponent().getRange())&&void 0!==e?e:null;return this._prevYAxisRange=null===l?l:n({},l),this._startScrollCoordinate={x:s.x,y:s.y},this._chart.getChartStore().getTimeScaleStore().startScroll(),a.dispatchEvent("mouseDownEvent",s);case mi:return(c=a.dispatchEvent("mouseDownEvent",s))&&this._chart.updatePane(1),this._xAxisStartScaleCoordinate={x:s.x,y:s.y},this._xAxisStartScaleDistance=s.pageX,c;case xi:var c;(c=a.dispatchEvent("mouseDownEvent",s))&&this._chart.updatePane(1);l=null!==(i=r.getAxisComponent().getRange())&&void 0!==i?i:null;return this._prevYAxisRange=null===l?l:n({},l),this._yAxisStartScaleDistance=s.pageY,c}}return!1},e.prototype.mouseMoveEvent=function(t){var e,i,n,o=this._findWidgetByEvent(t),r=o.pane,a=o.widget,s=this._makeWidgetEvent(t,a);if((null===(e=this._mouseMoveTriggerWidgetInfo.pane)||void 0===e?void 0:e.getId())===(null==r?void 0:r.getId())&&(null===(i=this._mouseMoveTriggerWidgetInfo.widget)||void 0===i?void 0:i.getName())===(null==a?void 0:a.getName())||(null==a||a.dispatchEvent("mouseEnterEvent",s),null===(n=this._mouseMoveTriggerWidgetInfo.widget)||void 0===n||n.dispatchEvent("mouseLeaveEvent",s),this._mouseMoveTriggerWidgetInfo={pane:r,widget:a}),null!==a)switch(a.getName()){case yi:var l=a.dispatchEvent("mouseMoveEvent",s),c=this._chart.getChartStore(),u={x:s.x,y:s.y,paneId:null==r?void 0:r.getId()};return l&&null!==c.getTooltipStore().getActiveIcon()&&(u=void 0,null!==a&&(a.getContainer().style.cursor="pointer")),this._chart.getChartStore().getTooltipStore().setCrosshair(u),l;case _i:case mi:case xi:l=a.dispatchEvent("mouseMoveEvent",s);return this._chart.getChartStore().getTooltipStore().setCrosshair(),l}return!1},e.prototype.pressedMouseMoveEvent=function(t){var e,i,n,o,r;if(null!==this._mouseDownWidget&&this._mouseDownWidget.getName()===_i)return this._mouseDownWidget.dispatchEvent("pressedMouseMoveEvent",t);var a=this._findWidgetByEvent(t),s=a.pane,l=a.widget;if(null!==l&&(null===(e=this._mouseDownWidget)||void 0===e?void 0:e.getPane().getId())===(null==s?void 0:s.getId())&&(null===(i=this._mouseDownWidget)||void 0===i?void 0:i.getName())===l.getName()){var c=this._makeWidgetEvent(t,l);switch(l.getName()){case yi:var u=l.getBounding();if(!(w=l.dispatchEvent("pressedMouseMoveEvent",c))&&null!==this._startScrollCoordinate){var h=s.getAxisComponent();if(null!==this._prevYAxisRange&&!h.getAutoCalcTickFlag()&&h.getScrollZoomEnabled()){var d=this._prevYAxisRange,p=d.from,g=d.to,v=p+(C=(b=d.range)*(T=(null!==(n=null==h?void 0:h.isReverse())&&void 0!==n&&n?this._startScrollCoordinate.y-c.y:c.y-this._startScrollCoordinate.y)/u.height)),f=g+C,y=h.convertToRealValue(v),m=h.convertToRealValue(f);h.setRange({from:v,to:f,range:f-v,realFrom:y,realTo:m,realRange:m-y})}var x=c.x-this._startScrollCoordinate.x;this._chart.getChartStore().getTimeScaleStore().scroll(x)}return this._chart.getChartStore().getTooltipStore().setCrosshair({x:c.x,y:c.y,paneId:null==s?void 0:s.getId()}),w;case mi:if(w=l.dispatchEvent("pressedMouseMoveEvent",c))this._chart.updatePane(1);else{var _=s.getAxisComponent();if(null===(o=null==_?void 0:_.getScrollZoomEnabled())||void 0===o||o){var S=10*((T=this._xAxisStartScaleDistance/c.pageX)-this._xAxisScale);this._xAxisScale=T,this._chart.getChartStore().getTimeScaleStore().zoom(S,null!==(r=this._xAxisStartScaleCoordinate)&&void 0!==r?r:void 0)}}return w;case xi:var w;if(w=l.dispatchEvent("pressedMouseMoveEvent",c))this._chart.updatePane(1);else{h=s.getAxisComponent();if(null!==this._prevYAxisRange&&h.getScrollZoomEnabled()){var b,T,C,P=this._prevYAxisRange,I=(p=P.from,g=P.to,(b=P.range)*(T=c.pageY/this._yAxisStartScaleDistance));v=p-(C=(I-b)/2),f=g+C,y=h.convertToRealValue(v),m=h.convertToRealValue(f);h.setRange({from:v,to:f,range:I,realFrom:y,realTo:m,realRange:m-y}),this._chart.adjustPaneViewport(!1,!0,!0,!0)}}return w}}return!1},e.prototype.mouseUpEvent=function(t){var e=this._findWidgetByEvent(t).widget,i=!1;if(null!==e){var n=this._makeWidgetEvent(t,e);switch(e.getName()){case yi:case _i:case mi:case xi:i=e.dispatchEvent("mouseUpEvent",n)}i&&this._chart.updatePane(1)}return this._mouseDownWidget=null,this._startScrollCoordinate=null,this._prevYAxisRange=null,this._xAxisStartScaleCoordinate=null,this._xAxisStartScaleDistance=0,this._xAxisScale=1,this._yAxisStartScaleDistance=0,i},e.prototype.mouseClickEvent=function(t){var e=this._findWidgetByEvent(t).widget;if(null!==e){var i=this._makeWidgetEvent(t,e);return e.dispatchEvent("mouseClickEvent",i)}return!1},e.prototype.mouseRightClickEvent=function(e){var i=this._findWidgetByEvent(e).widget,n=!1;if(null!==i){var o=this._makeWidgetEvent(e,i),r=i.getName();switch(r){case yi:case mi:case xi:n=i.dispatchEvent("mouseRightClickEvent",o)}n&&this._chart.updatePane(1),this._chart.getChartStore().getActionStore().execute(t.ActionType.onRightClick,{name:r,x:e.pageX,y:e.pageY})}return!1},e.prototype.mouseDoubleClickEvent=function(t){var e=this._findWidgetByEvent(t),i=e.pane,n=e.widget;if(null!==n)switch(n.getName()){case yi:var o=this._makeWidgetEvent(t,n);return n.dispatchEvent("mouseDoubleClickEvent",o);case xi:var r=i.getAxisComponent();if(!r.getAutoCalcTickFlag())return r.setAutoCalcTickFlag(!0),this._chart.adjustPaneViewport(!1,!0,!0,!0),!0}return!1},e.prototype.mouseLeaveEvent=function(){return this._chart.getChartStore().getTooltipStore().setCrosshair(),!0},e.prototype.touchStartEvent=function(t){var e=this._findWidgetByEvent(t),i=e.pane,n=e.widget;if(null!==n){var o=this._makeWidgetEvent(t,n);switch(n.getName()){case yi:var r=this._chart.getChartStore(),a=r.getTooltipStore();if(n.dispatchEvent("mouseDownEvent",o))return this._touchCancelCrosshair=!0,this._touchCoordinate=null,a.setCrosshair(void 0,!0),this._chart.updatePane(1),!0;if(null!==this._flingScrollRequestId&&(wi(this._flingScrollRequestId),this._flingScrollRequestId=null),this._flingStartTime=(new Date).getTime(),this._startScrollCoordinate={x:o.x,y:o.y},r.getTimeScaleStore().startScroll(),this._touchZoomed=!1,null!==this._touchCoordinate){var s=o.x-this._touchCoordinate.x,l=o.y-this._touchCoordinate.y;Math.sqrt(s*s+l*l)<10?(this._touchCoordinate={x:o.x,y:o.y},a.setCrosshair({x:o.x,y:o.y,paneId:null==i?void 0:i.getId()})):(this._touchCoordinate=null,this._touchCancelCrosshair=!0,a.setCrosshair())}return!0;case mi:case xi:var c=n.dispatchEvent("mouseDownEvent",o);return c&&this._chart.updatePane(1),c}}return!1},e.prototype.touchMoveEvent=function(t){var e,i,n,o=this._findWidgetByEvent(t),r=o.pane,a=o.widget;if(null!==a){var s=this._makeWidgetEvent(t,a),l=a.getName(),c=this._chart.getChartStore(),u=c.getTooltipStore();switch(l){case yi:if(a.dispatchEvent("pressedMouseMoveEvent",s))return null===(e=s.preventDefault)||void 0===e||e.call(s),u.setCrosshair(void 0,!0),this._chart.updatePane(1),!0;if(null!==this._touchCoordinate)null===(i=s.preventDefault)||void 0===i||i.call(s),u.setCrosshair({x:s.x,y:s.y,paneId:null==r?void 0:r.getId()});else if(null!==this._startScrollCoordinate&&Math.abs(this._startScrollCoordinate.x-s.x)>this._startScrollCoordinate.y-s.y){var h=s.x-this._startScrollCoordinate.x;c.getTimeScaleStore().scroll(h)}return!0;case mi:case xi:var d=a.dispatchEvent("pressedMouseMoveEvent",s);return d&&(null===(n=s.preventDefault)||void 0===n||n.call(s),this._chart.updatePane(1)),d}}return!1},e.prototype.touchEndEvent=function(t){var e=this,i=this._findWidgetByEvent(t).widget;if(null!==i){var n=this._makeWidgetEvent(t,i);switch(i.getName()){case yi:if(i.dispatchEvent("mouseUpEvent",n),null!==this._startScrollCoordinate){var o=(new Date).getTime()-this._flingStartTime,r=(n.x-this._startScrollCoordinate.x)/(o>0?o:1)*20;if(o<200&&Math.abs(r)>0){var a=this._chart.getChartStore().getTimeScaleStore(),s=function(){e._flingScrollRequestId=Si((function(){a.startScroll(),a.scroll(r),r*=.975,Math.abs(r)<1?null!==e._flingScrollRequestId&&(wi(e._flingScrollRequestId),e._flingScrollRequestId=null):s()}))};s()}}return!0;case mi:case xi:i.dispatchEvent("mouseUpEvent",n)&&this._chart.updatePane(1)}}return!1},e.prototype.tapEvent=function(t){var e=this._findWidgetByEvent(t),i=e.pane,n=e.widget,o=!1;if(null!==n){var r=this._makeWidgetEvent(t,n),a=n.dispatchEvent("mouseClickEvent",r);if(n.getName()===yi){var s=this._makeWidgetEvent(t,n),l=this._chart.getChartStore().getTooltipStore();a?(this._touchCancelCrosshair=!0,this._touchCoordinate=null,l.setCrosshair(void 0,!0),o=!0):(this._touchCancelCrosshair||this._touchZoomed||(this._touchCoordinate={x:s.x,y:s.y},l.setCrosshair({x:s.x,y:s.y,paneId:null==i?void 0:i.getId()},!0),o=!0),this._touchCancelCrosshair=!1)}(o||a)&&this._chart.updatePane(1)}return o},e.prototype.doubleTapEvent=function(t){return this.mouseDoubleClickEvent(t)},e.prototype.longTapEvent=function(t){var e=this._findWidgetByEvent(t),i=e.pane,n=e.widget;if(null!==n&&n.getName()===yi){var o=this._makeWidgetEvent(t,n);return this._touchCoordinate={x:o.x,y:o.y},this._chart.getChartStore().getTooltipStore().setCrosshair({x:o.x,y:o.y,paneId:null==i?void 0:i.getId()}),!0}return!1},e.prototype._findWidgetByEvent=function(t){var e,i,n,o,r=t.x,l=t.y,c=this._chart.getAllSeparatorPanes(),u=this._chart.getChartStore().getStyles().separator.size;try{for(var h=a(c),d=h.next();!d.done;d=h.next()){var p=s(d.value,2)[1],g=(x=p.getBounding()).top-Math.round((7-u)/2);if(r>=x.left&&r<=x.left+x.width&&l>=g&&l<=g+7)return{pane:p,widget:p.getWidget()}}}catch(t){e={error:t}}finally{try{d&&!d.done&&(i=h.return)&&i.call(h)}finally{if(e)throw e.error}}var v=this._chart.getAllDrawPanes(),f=null;try{for(var y=a(v),m=y.next();!m.done;m=y.next()){var x,_=m.value;if(r>=(x=_.getBounding()).left&&r<=x.left+x.width&&l>=x.top&&l<=x.top+x.height){f=_;break}}}catch(t){n={error:t}}finally{try{m&&!m.done&&(o=y.return)&&o.call(y)}finally{if(n)throw n.error}}var S=null;if(null!==f){if(null===S){var w=f.getMainWidget(),b=w.getBounding();r>=b.left&&r<=b.left+b.width&&l>=b.top&&l<=b.top+b.height&&(S=w)}if(null===S){var T=f.getYAxisWidget();if(null!==T){var C=T.getBounding();r>=C.left&&r<=C.left+C.width&&l>=C.top&&l<=C.top+C.height&&(S=T)}}}return{pane:f,widget:S}},e.prototype._makeWidgetEvent=function(t,e){var i,o,r,a=null!==(i=null==e?void 0:e.getBounding())&&void 0!==i?i:null;return n(n({},t),{x:t.x-(null!==(o=null==a?void 0:a.left)&&void 0!==o?o:0),y:t.y-(null!==(r=null==a?void 0:a.top)&&void 0!==r?r:0)})},e.prototype.destroy=function(){this._container.removeEventListener("keydown",this._boundKeyBoardDownEvent),this._event.destroy()},e}();t.DomPosition=void 0,(Bn=t.DomPosition||(t.DomPosition={})).Root="root",Bn.Main="main",Bn.YAxis="yAxis";var On=function(){function e(t,e){this._drawPanes=[],this._separatorPanes=new Map,this._initContainer(t),this._chartEvent=new Vn(this._chartContainer,this),this._chartStore=new fi(this,e),this._initPanes(e),this.adjustPaneViewport(!0,!0,!0)}return e.prototype._initContainer=function(t){this._container=t,this._chartContainer=gt("div",{position:"relative",width:"100%",outline:"none",borderStyle:"none",boxSizing:"border-box",userSelect:"none",webkitUserSelect:"none",msUserSelect:"none",MozUserSelect:"none",webkitTapHighlightColor:"transparent"}),this._chartContainer.tabIndex=1,t.appendChild(this._chartContainer)},e.prototype._initPanes=function(t){var e,i=this,n=null!==(e=null==t?void 0:t.layout)&&void 0!==e?e:[{type:"candle"}],o=!1,r=!1,a=function(t){if(!r){var e=i._createPane(Mn,ui,null!=t?t:{});i._xAxisPane=e,r=!0}};n.forEach((function(t){var e,n,r;switch(t.type){case"candle":if(!o){var s=null!==(e=t.options)&&void 0!==e?e:{};M(s,{id:li}),i._candlePane=i._createPane(bn,li,s),(l=null!==(n=t.content)&&void 0!==n?n:[]).forEach((function(t){i.createIndicator(t,!0,s)})),o=!0}break;case"indicator":var l,c;if((l=null!==(r=t.content)&&void 0!==r?r:[]).length>0)l.forEach((function(e){R(c)?i.createIndicator(e,!0,{id:c}):c=i.createIndicator(e,!0,t.options)}));break;case"xAxis":a(t.options)}})),a({position:"bottom"})},e.prototype._createPane=function(t,e,i){var n,o=null,r=null;switch(null==i?void 0:i.position){case"top":var a=this._drawPanes[0];R(a)&&(r=new t(this._chartContainer,a.getContainer(),this,e,null!=i?i:{}),o=0);break;case"bottom":break;default:for(var s=this._drawPanes.length-1;s>-1;s--){var l=this._drawPanes[s],c=this._drawPanes[s-1];if("bottom"===(null==l?void 0:l.getOptions().position)&&"bottom"!==(null==c?void 0:c.getOptions().position)){r=new t(this._chartContainer,l.getContainer(),this,e,null!=i?i:{}),o=s;break}}}if(R(r)||(r=new t(this._chartContainer,null,this,e,null!=i?i:{})),B(o)?(this._drawPanes.splice(o,0,r),n=o):(this._drawPanes.push(r),n=this._drawPanes.length-1),r.getId()!==ui){var u=this._drawPanes[n+1];if(R(u)&&u.getId()===ui&&(u=this._drawPanes[n+2]),R(u))R(d=this._separatorPanes.get(u))?d.setTopPane(r):(d=new An(this._chartContainer,u.getContainer(),this,"",r,u),this._separatorPanes.set(u,d));var h=this._drawPanes[n-1];if(R(h)&&h.getId()===ui&&(h=this._drawPanes[n-2]),R(h)){var d=new An(this._chartContainer,r.getContainer(),this,"",h,r);this._separatorPanes.set(r,d)}}return r},e.prototype._measurePaneHeight=function(){var t,e=this,i=Math.floor(this._container.clientHeight),n=this._chartStore.getStyles().separator.size,o=this._xAxisPane.getAxisComponent().getAutoSize(),r=i-o-this._separatorPanes.size*n;r<0&&(r=0);var a=0;this._drawPanes.forEach((function(t){if(t.getId()!==li&&t.getId()!==ui){var e=t.getBounding().height,i=t.getOptions().minHeight;e<i&&(e=i),a+e>r?(a=r,e=Math.max(r-a,0)):a+=e,t.setBounding({height:e})}}));var s=r-a;null===(t=this._candlePane)||void 0===t||t.setBounding({height:s}),this._xAxisPane.setBounding({height:o});var l=0;this._drawPanes.forEach((function(t){var i=e._separatorPanes.get(t);R(i)&&(i.setBounding({height:n,top:l}),l+=n),t.setBounding({top:l}),l+=t.getBounding().height}))},e.prototype._measurePaneWidth=function(){var e=this,i=Math.floor(this._container.clientWidth),n=this._chartStore.getStyles(),o=n.yAxis,r=o.position===t.YAxisPosition.Left,a=!o.inside,s=0,l=0,c=0,u=0;this._drawPanes.forEach((function(t){t.getId()!==ui&&(l=Math.max(l,t.getAxisComponent().getAutoSize()))})),l>i&&(l=i),a?(s=i-l,r?(c=0,u=l):(c=i-l,u=0)):(s=i,u=0,c=r?0:i-l),this._chartStore.getTimeScaleStore().setTotalBarSpace(s);var h,d={width:i},p={width:s,left:u},g={width:l,left:c},v=n.separator.fill;h=a&&!v?p:d,this._drawPanes.forEach((function(t){var i;null===(i=e._separatorPanes.get(t))||void 0===i||i.setBounding(h),t.setBounding(d,p,g)}))},e.prototype._setPaneOptions=function(t,e){var i,n;if(O(t.id)){var o=this.getDrawPaneById(t.id),r=!1;if(null!==o){var a=e;if(t.id!==li&&B(t.height)&&t.height>0){var s=Math.max(null!==(i=t.minHeight)&&void 0!==i?i:o.getOptions().minHeight,0),l=Math.max(s,t.height);o.setBounding({height:l}),a=!0,r=!0}(O(null===(n=t.axisOptions)||void 0===n?void 0:n.name)||R(t.gap))&&(a=!0),o.setOptions(t),a&&this.adjustPaneViewport(r,!0,!0,!0,!0)}}},e.prototype.getDrawPaneById=function(t){if(t===li)return this._candlePane;if(t===ui)return this._xAxisPane;var e=this._drawPanes.find((function(e){return e.getId()===t}));return null!=e?e:null},e.prototype.getContainer=function(){return this._container},e.prototype.getChartStore=function(){return this._chartStore},e.prototype.getXAxisPane=function(){return this._xAxisPane},e.prototype.getAllDrawPanes=function(){return this._drawPanes},e.prototype.getAllSeparatorPanes=function(){return this._separatorPanes},e.prototype.adjustPaneViewport=function(t,e,i,n,o){t&&this._measurePaneHeight();var r=e,a=null!=o&&o;(null!=n&&n||a)&&this._drawPanes.forEach((function(t){var e=t.getAxisComponent().buildTicks(a);r||(r=e)})),r&&this._measurePaneWidth(),null!=i&&i&&(this._xAxisPane.getAxisComponent().buildTicks(!0),this.updatePane(4))},e.prototype.updatePane=function(t,e){if(R(e)){var i=this.getDrawPaneById(e);null==i||i.update(t)}else this._separatorPanes.forEach((function(e){e.update(t)})),this._drawPanes.forEach((function(e){e.update(t)}))},e.prototype.crosshairChange=function(e){var i=this,o=this._chartStore.getActionStore();if(o.has(t.ActionType.OnCrosshairChange)){var r={};this._drawPanes.forEach((function(t){var n=t.getId(),o={};i._chartStore.getIndicatorStore().getInstances(n).forEach((function(t){var i,n=t.result;o[t.name]=n[null!==(i=e.dataIndex)&&void 0!==i?i:n.length-1]})),r[n]=o})),O(e.paneId)&&o.execute(t.ActionType.OnCrosshairChange,n(n({},e),{indicatorData:r}))}},e.prototype.getDom=function(e,i){var n,o;if(!O(e))return this._chartContainer;var r=this.getDrawPaneById(e);if(null!==r)switch(null!=i?i:t.DomPosition.Root){case t.DomPosition.Root:return r.getContainer();case t.DomPosition.Main:return r.getMainWidget().getContainer();case t.DomPosition.YAxis:return null!==(o=null===(n=r.getYAxisWidget())||void 0===n?void 0:n.getContainer())&&void 0!==o?o:null}return null},e.prototype.getSize=function(e,i){var n,o;if(!R(e))return{width:Math.floor(this._chartContainer.clientWidth),height:Math.floor(this._chartContainer.clientHeight),left:0,top:0,right:0,bottom:0};var r=this.getDrawPaneById(e);if(null!==r)switch(null!=i?i:t.DomPosition.Root){case t.DomPosition.Root:return r.getBounding();case t.DomPosition.Main:return r.getMainWidget().getBounding();case t.DomPosition.YAxis:return null!==(o=null===(n=r.getYAxisWidget())||void 0===n?void 0:n.getBounding())&&void 0!==o?o:null}return null},e.prototype.setStyles=function(t){var e,i,n;this._chartStore.setOptions({styles:t}),R(null===(e=null==(n=O(t)?gi(t):t)?void 0:n.yAxis)||void 0===e?void 0:e.type)&&(null===(i=this._candlePane)||void 0===i||i.getAxisComponent().setAutoCalcTickFlag(!0)),t.crosshair&&(t.crosshair.show?this._chartContainer.style.cursor="crosshair":this._chartContainer.style.cursor="default"),this.adjustPaneViewport(!0,!0,!0,!0,!0)},e.prototype.getStyles=function(){return this._chartStore.getStyles()},e.prototype.setLocale=function(t){this._chartStore.setOptions({locale:t}),this.adjustPaneViewport(!0,!0,!0,!0,!0)},e.prototype.getLocale=function(){return this._chartStore.getLocale()},e.prototype.setCustomApi=function(t){this._chartStore.setOptions({customApi:t}),this.adjustPaneViewport(!0,!0,!0,!0,!0)},e.prototype.setPriceVolumePrecision=function(t,e){this._chartStore.setPrecision({price:t,volume:e})},e.prototype.getPriceVolumePrecision=function(){return this._chartStore.getPrecision()},e.prototype.setTimezone=function(t){this._chartStore.setOptions({timezone:t}),this._xAxisPane.getAxisComponent().buildTicks(!0),this._xAxisPane.update(3)},e.prototype.getTimezone=function(){return this._chartStore.getTimeScaleStore().getTimezone()},e.prototype.setOffsetRightDistance=function(t){this._chartStore.getTimeScaleStore().setOffsetRightDistance(t,!0)},e.prototype.getOffsetRightDistance=function(){return this._chartStore.getTimeScaleStore().getOffsetRightDistance()},e.prototype.setMaxOffsetLeftDistance=function(t){t<0||this._chartStore.getTimeScaleStore().setMaxOffsetLeftDistance(t)},e.prototype.setMaxOffsetRightDistance=function(t){t<0||this._chartStore.getTimeScaleStore().setMaxOffsetRightDistance(t)},e.prototype.setLeftMinVisibleBarCount=function(t){t<0||this._chartStore.getTimeScaleStore().setLeftMinVisibleBarCount(Math.ceil(t))},e.prototype.setRightMinVisibleBarCount=function(t){t<0||this._chartStore.getTimeScaleStore().setRightMinVisibleBarCount(Math.ceil(t))},e.prototype.setBarSpace=function(t){this._chartStore.getTimeScaleStore().setBarSpace(t)},e.prototype.getBarSpace=function(){return this._chartStore.getTimeScaleStore().getBarSpace().bar},e.prototype.getVisibleRange=function(){return this._chartStore.getTimeScaleStore().getVisibleRange()},e.prototype.clearData=function(){this._chartStore.clear()},e.prototype.getDataList=function(){return this._chartStore.getDataList()},e.prototype.applyNewData=function(t,e,i){var n=l([],s(t),!1);this._chartStore.addData(n,ut.Init,e).then((function(){})).catch((function(){})).finally((function(){null==i||i()}))},e.prototype.applyMoreData=function(t,e,i){var n=l([],s(t),!1);this._chartStore.addData(n,ut.Forward,null==e||e).then((function(){})).catch((function(){})).finally((function(){null==i||i()}))},e.prototype.updateData=function(t,e){this._chartStore.addData(t).then((function(){})).catch((function(){})).finally((function(){null==e||e()}))},e.prototype.loadMore=function(t){this._chartStore.setLoadMoreCallback(t)},e.prototype.setLoadDataCallback=function(t){this._chartStore.setLoadDataCallback(t)},e.prototype.createIndicator=function(t,e,i,n){var o,r=this,a=O(t)?{name:t}:t;if(null===Ie(a.name))return null;var s=null==i?void 0:i.id,l=this.getDrawPaneById(null!=s?s:"");if(null!==l)this._chartStore.getIndicatorStore().addInstance(a,null!=s?s:"",null!=e&&e).then((function(t){var e;r._setPaneOptions(null!=i?i:{},null!==(e=l.getAxisComponent().buildTicks(!0))&&void 0!==e&&e)})).catch((function(t){}));else{null!=s||(s=pt(ci));var c=this._createPane(wn,s,null!=i?i:{}),u=null!==(o=null==i?void 0:i.height)&&void 0!==o?o:100;c.setBounding({height:u}),this._chartStore.getIndicatorStore().addInstance(a,s,null!=e&&e).finally((function(){r.adjustPaneViewport(!0,!0,!0,!0,!0),null==n||n()}))}return null!=s?s:null},e.prototype.overrideIndicator=function(t,e,i){var n=this;this._chartStore.getIndicatorStore().override(t,null!=e?e:null).then((function(t){var e=s(t,2),o=e[0],r=e[1];(o||r)&&(n.adjustPaneViewport(!1,r,!0,r),null==i||i())})).catch((function(){}))},e.prototype.getIndicatorByPaneId=function(t,e){return this._chartStore.getIndicatorStore().getInstanceByPaneId(t,e)},e.prototype.removeIndicator=function(t,e){var i,n,o,r=this._chartStore.getIndicatorStore();if(r.removeInstance(t,e)){var s=!1;if(t!==li&&!r.hasInstances(t)){var l=this.getDrawPaneById(t),c=this._drawPanes.findIndex((function(e){return e.getId()===t}));if(null!==l){s=!0;var u=this._separatorPanes.get(l);if(R(u)){var h=null==u?void 0:u.getTopPane();try{for(var d=a(this._separatorPanes),p=d.next();!p.done;p=d.next()){var g=p.value;if(g[1].getTopPane().getId()===l.getId()){g[1].setTopPane(h);break}}}catch(t){i={error:t}}finally{try{p&&!p.done&&(n=d.return)&&n.call(d)}finally{if(i)throw i.error}}u.destroy(),this._separatorPanes.delete(l)}this._drawPanes.splice(c,1),l.destroy();var v=this._drawPanes[0];R(v)&&v.getId()===ui&&(v=this._drawPanes[1]),null===(o=this._separatorPanes.get(v))||void 0===o||o.destroy(),this._separatorPanes.delete(v)}}this.adjustPaneViewport(s,!0,!0,!0,!0)}},e.prototype.createOverlay=function(t,e){var i=[];if(O(t))i=[{name:t}];else if(A(t))i=t.map((function(t){return O(t)?{name:t}:t}));else{i=[t]}var n=!0;R(e)&&null!==this.getDrawPaneById(e)||(e=li,n=!1);var o=this._chartStore.getOverlayStore().addInstances(i,e,n);return A(t)?o:o[0]},e.prototype.getOverlayById=function(t){return this._chartStore.getOverlayStore().getInstanceById(t)},e.prototype.overrideOverlay=function(t){this._chartStore.getOverlayStore().override(t)},e.prototype.removeOverlay=function(t){var e;R(t)&&(e=O(t)?{id:t}:t),this._chartStore.getOverlayStore().removeInstance(e)},e.prototype.setPaneOptions=function(t){this._setPaneOptions(t,!1)},e.prototype.setZoomEnabled=function(t){this._chartStore.getTimeScaleStore().setZoomEnabled(t)},e.prototype.isZoomEnabled=function(){return this._chartStore.getTimeScaleStore().getZoomEnabled()},e.prototype.setScrollEnabled=function(t){this._chartStore.getTimeScaleStore().setScrollEnabled(t)},e.prototype.isScrollEnabled=function(){return this._chartStore.getTimeScaleStore().getScrollEnabled()},e.prototype.scrollByDistance=function(t,e){var i=B(e)&&e>0?e:0,n=this._chartStore.getTimeScaleStore();if(i>0){n.startScroll();var o=(new Date).getTime(),r=function(){var e=((new Date).getTime()-o)/i,a=e>=1,s=a?t:t*e;n.scroll(s),a||requestAnimationFrame(r)};r()}else n.startScroll(),n.scroll(t)},e.prototype.scrollToRealTime=function(t){var e=this._chartStore.getTimeScaleStore(),i=e.getBarSpace().bar,n=(e.getLastBarRightSideDiffBarCount()-e.getInitialOffsetRightDistance()/i)*i;this.scrollByDistance(n,t)},e.prototype.scrollToDataIndex=function(t,e){var i=this._chartStore.getTimeScaleStore(),n=(i.getLastBarRightSideDiffBarCount()+(this.getDataList().length-1-t))*i.getBarSpace().bar;this.scrollByDistance(n,e)},e.prototype.scrollToTimestamp=function(t,e){var i=vt(this.getDataList(),"timestamp",t);this.scrollToDataIndex(i,e)},e.prototype.zoomAtCoordinate=function(t,e,i){var n=B(i)&&i>0?i:0,o=this._chartStore.getTimeScaleStore();if(n>0){var r=o.getBarSpace().bar,a=r*t-r,s=(new Date).getTime(),l=function(){var t=((new Date).getTime()-s)/n,i=t>=1,c=i?a:a*t;o.zoom(c/r,e),i||requestAnimationFrame(l)};l()}else o.zoom(t,e)},e.prototype.zoomAtDataIndex=function(t,e,i){var n=this._chartStore.getTimeScaleStore().dataIndexToCoordinate(e);this.zoomAtCoordinate(t,{x:n,y:0},i)},e.prototype.zoomAtTimestamp=function(t,e,i){var n=vt(this.getDataList(),"timestamp",e);this.zoomAtDataIndex(t,n,i)},e.prototype.convertToPixel=function(t,e){var i,n=e.paneId,o=void 0===n?li:n,r=e.absolute,a=void 0!==r&&r,s=[];if(o!==ui){var l=this.getDrawPaneById(o);if(null!==l){var c=this._chartStore.getTimeScaleStore(),u=l.getBounding(),h=(new Array).concat(t),d=this._xAxisPane.getAxisComponent(),p=l.getAxisComponent();s=h.map((function(t){var e={},i=t.dataIndex;if(B(t.timestamp)&&(i=c.timestampToDataIndex(t.timestamp)),B(i)&&(e.x=null==d?void 0:d.convertToPixel(i)),B(t.value)){var n=null==p?void 0:p.convertToPixel(t.value);e.y=a?u.top+n:n}return e}))}}return A(t)?s:null!==(i=s[0])&&void 0!==i?i:{}},e.prototype.convertFromPixel=function(t,e){var i,n=e.paneId,o=void 0===n?li:n,r=e.absolute,a=void 0!==r&&r,s=[];if(o!==ui){var l=this.getDrawPaneById(o);if(null!==l){var c=this._chartStore.getTimeScaleStore(),u=l.getBounding(),h=(new Array).concat(t),d=this._xAxisPane.getAxisComponent(),p=l.getAxisComponent();s=h.map((function(t){var e,i,n={};if(B(t.x)){var o=null!==(e=null==d?void 0:d.convertFromPixel(t.x))&&void 0!==e?e:-1;n.dataIndex=o,n.timestamp=null!==(i=c.dataIndexToTimestamp(o))&&void 0!==i?i:void 0}if(B(t.y)){var r=a?t.y-u.top:t.y;n.value=p.convertFromPixel(r)}return n}))}}return A(t)?s:null!==(i=s[0])&&void 0!==i?i:{}},e.prototype.executeAction=function(e,i){var o;if(e===t.ActionType.OnCrosshairChange){var r=n({},i);r.paneId=null!==(o=r.paneId)&&void 0!==o?o:li,this._chartStore.getTooltipStore().setCrosshair(r)}},e.prototype.subscribeAction=function(t,e){this._chartStore.getActionStore().subscribe(t,e)},e.prototype.unsubscribeAction=function(t,e){this._chartStore.getActionStore().unsubscribe(t,e)},e.prototype.getConvertPictureUrl=function(t,e,i){var n=this,o=this._chartContainer.clientWidth,r=this._chartContainer.clientHeight,a=gt("canvas",{width:"".concat(o,"px"),height:"".concat(r,"px"),boxSizing:"border-box"}),s=a.getContext("2d"),l=Z(a);a.width=o*l,a.height=r*l,s.scale(l,l),s.fillStyle=null!=i?i:"#FFFFFF",s.fillRect(0,0,o,r);var c=null!=t&&t;return this._drawPanes.forEach((function(t){var e=n._separatorPanes.get(t);if(R(e)){var i=e.getBounding();s.drawImage(e.getImage(c),i.left,i.top,i.width,i.height)}var r=t.getBounding();s.drawImage(t.getImage(c),0,r.top,o,r.height)})),a.toDataURL("image/".concat(null!=e?e:"jpeg"))},e.prototype.resize=function(){this.adjustPaneViewport(!0,!0,!0,!0,!0)},e.prototype.resetScale=function(){var t=this;this._drawPanes.forEach((function(e){e.getId()===li&&(e.getAxisComponent().resetRange(),t.adjustPaneViewport(!1,!0,!0,!0))}))},e.prototype.setTradingSettings=function(t){var e;this._chartStore.setTradingSettings(t),this.updatePane(0,null===(e=this._candlePane)||void 0===e?void 0:e.getId())},e.prototype.setTimeframe=function(t){this._chartStore.setTimeframeDuration(function(t){if(!t.endsWith("M")&&!t.endsWith("H"))return-1;switch(t){case"1M":return 6e4;case"3M":return 18e4;case"15M":return 9e5;case"1H":return 36e5;case"4H":return 144e5;default:return 0}}(t))},e.prototype.destroy=function(){this._chartEvent.destroy(),this._drawPanes.forEach((function(t){t.destroy()})),this._drawPanes=[],this._separatorPanes.forEach((function(t){t.destroy()})),this._separatorPanes.clear(),this._container.removeChild(this._chartContainer)},e.prototype.updateDataIntraDay=function(t,e){this._chartStore.addIntradayData(t).then((function(){})).catch((function(){})).finally((function(){null==e||e()}))},e}(),Nn=new Map,Wn=1;var zn={clone:k,merge:M,isString:O,isNumber:B,isValid:R,isObject:L,isArray:A,isFunction:F,isBoolean:V,formatValue:H,formatPrecision:U,formatBigNumber:G,formatDate:X,formatThousands:j,formatFoldDecimal:K,calcTextWidth:Q,getLinearSlopeIntercept:Re,getLinearYFromSlopeIntercept:Le,getLinearYFromCoordinates:Be,checkCoordinateOnArc:Yi,checkCoordinateOnCircle:Di,checkCoordinateOnLine:Fe,checkCoordinateOnPolygon:ki,checkCoordinateOnRect:Li,checkCoordinateOnText:Oi,drawArc:Hi,drawCircle:Ei,drawLine:Oe,drawPolygon:Ai,drawRect:Bi,drawText:Ni,drawRectText:zi};t.dispose=function(t){var e,i,n;if(t instanceof On)n=t.id;else{var o=void 0;n=null!==(e=null==(o=O(t)?document.getElementById(t):t)?void 0:o.getAttribute("k-line-chart-id"))&&void 0!==e?e:null}null!==n&&(null===(i=Nn.get(n))||void 0===i||i.destroy(),Nn.delete(n))},t.getFigureClass=function(t){var e;return null!==(e=Ui[t])&&void 0!==e?e:null},t.getIndicatorCalcByName=function(t){var e,i=Ce.find((function(e){return e.name===t}));return null!==(e=null==i?void 0:i.calc)&&void 0!==e?e:null},t.getOverlayClass=function(t){var e;return null!==(e=ai[t])&&void 0!==e?e:null},t.getSupportedFigures=function(){return Object.keys(Ui)},t.getSupportedIndicators=function(){var t=[];return Ce.forEach((function(e){var i={id:e.name,name:Pe[e.name],isOverlay:void 0!==e.isOverlay};t.push(i)})),t},t.getSupportedLocales=function(){return Object.keys(an)},t.getSupportedOverlays=function(){return Object.keys(ai)},t.init=function(t,e){var i;if(null===(i=O(t)?document.getElementById(t):t))return null;var n=Nn.get(i.id);if(R(n))return n;var o="k_line_chart_".concat(Wn++);return(n=new On(i,e)).id=o,i.setAttribute("k-line-chart-id",o),Nn.set(o,n),n},t.registerFigure=function(t){Ui[t.name]=Ae.extend(t)},t.registerIndicator=function(t){Te[t.name]=it.extend(t)},t.registerLocale=function(t,e){an[t]=n(n({},an[t]),e)},t.registerOverlay=function(t){ai[t.name]=ct.extend(t)},t.registerStyles=function(t,e){pi[t]=e},t.registerXAxis=function(t){En[t.name]=Dn.extend(t)},t.registerYAxis=function(t){xn[t.name]=mn.extend(t)},t.utils=zn,t.version=function(){return"9.8.8"}}));
